<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üé∞ BingoBett - –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            background: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            font-size: 14px;
        }

        /* Telegram —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å */
        .telegram-loading {
            display: none;
            text-align: center;
            padding: 50px 20px;
            color: var(--tg-theme-hint-color, #999);
        }

        .telegram-loading.show {
            display: block;
        }

        .main-content {
            width: 100%;
            max-width: 500px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--tg-theme-accent-text-color, #ffd700);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
            font-size: 13px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .balance-info, .jackpot-info, .bet-info, .freespin-info {
            background: var(--tg-theme-secondary-bg-color, rgba(255, 255, 255, 0.1));
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 100px;
            text-align: center;
        }

        .jackpot-info {
            color: var(--tg-theme-accent-text-color, #ffd700);
        }

        .freespin-info {
            color: var(--tg-theme-subtitle-text-color, #4caf50);
        }

        /* –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ */
        .slot-machine {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            width: 100%;
            aspect-ratio: 5 / 4;
            margin: 20px 0;
            background: var(--tg-theme-secondary-bg-color, #333);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--tg-theme-accent-text-color, #ffd700);
        }

        .slot {
            background: var(--tg-theme-bg-color, #222);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: min(8vw, 32px);
            border: 1px solid var(--tg-theme-secondary-bg-color, #444);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .slot.spinning {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 300%;
            animation: spinGlow 0.5s ease-in-out infinite;
        }

        @keyframes spinGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .slot.win {
            background: var(--tg-theme-accent-text-color, #ffd700);
            color: var(--tg-theme-bg-color, #000);
            animation: winPulse 1s infinite alternate;
            transform: scale(1.05);
        }

        @keyframes winPulse {
            0% { box-shadow: 0 0 5px var(--tg-theme-accent-text-color, #ffd700); }
            100% { box-shadow: 0 0 20px var(--tg-theme-accent-text-color, #ffd700); }
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .controls, .bet-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 15px 0;
        }

        button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 25px;
            border: none;
            background: var(--tg-theme-button-color, #4caf50);
            color: var(--tg-theme-button-text-color, #ffffff);
            transition: all 0.2s ease;
            min-height: 48px;
            min-width: 120px;
            position: relative;
            overflow: hidden;
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.spin-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            font-size: 16px;
            min-width: 150px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Å Telegram —Å—Ç–∏–ª—è–º–∏ */
        .modal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--tg-theme-bg-color, #333);
            padding: 25px;
            border-radius: 20px;
            color: var(--tg-theme-text-color, #fff);
            min-width: 300px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .message {
            margin: 15px 0;
            min-height: 50px;
            text-align: center;
            color: var(--tg-theme-accent-text-color, #ffd700);
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è Telegram */
        @media (max-width: 480px) {
            .header h1 { font-size: 24px; }
            .user-info { flex-direction: column; }
            .controls { flex-direction: column; }
            button { min-width: 100%; }
        }

        /* –ú–∏–Ω–∏-–∏–≥—Ä—ã —Å—Ç–∏–ª–∏ */
        .mini-game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .mini-game-content {
            background: var(--tg-theme-bg-color, #232323);
            border-radius: 20px;
            padding: 30px;
            color: var(--tg-theme-text-color, #fff);
            min-width: 60vw;
            max-width: 90vw;
            text-align: center;
        }

        /* –î–æ–∂–¥—å –º–æ–Ω–µ—Ç —Å—Ç–∏–ª–∏ */
        #coinRainOverlay {
            background: rgba(0, 0, 0, 0.95);
        }

        #coinRainCanvas {
            width: 100%;
            height: 100%;
            cursor: pointer;
            touch-action: manipulation;
        }

        #coinRainUI {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: var(--tg-theme-accent-text-color, #ffd700);
            z-index: 1001;
            pointer-events: none;
        }

        #coinRainTitle {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            animation: titlePulse 1s infinite alternate;
        }

        @keyframes titlePulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        /* Telegram —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .tg-viewport {
            height: var(--tg-viewport-height, 100vh);
        }

        /* –°–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã */
        .hide-in-telegram {
            display: block;
        }

        .telegram-only {
            display: none;
        }

        .is-telegram .hide-in-telegram {
            display: none;
        }

        .is-telegram .telegram-only {
            display: block;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è Telegram -->
    <div class="telegram-loading" id="telegramLoading">
        <h2>üé∞ –ó–∞–≥—Ä—É–∑–∫–∞ BingoBett...</h2>
        <p>–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –¥–ª—è Telegram</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content" id="mainContent" style="display: none;">
        <div class="header">
            <h1>üé∞ BingoBett</h1>
            <div class="user-info">
                <div class="balance-info">–ë–∞–ª–∞–Ω—Å: <span id="balanceDisplay">777.00</span> ‚ÇΩ</div>
                <div class="jackpot-info">–î–∂–µ–∫–ø–æ—Ç: <span id="jackpotDisplay">2200453</span> ‚ÇΩ</div>
                <div class="bet-info">–°—Ç–∞–≤–∫–∞: <span id="betDisplay">10</span> ‚ÇΩ</div>
                <div class="freespin-info">–§—Ä–∏—Å–ø–∏–Ω—ã: <span id="freespinCount">55</span></div>
            </div>
        </div>

        <!-- –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ -->
        <div class="slot-machine" id="slotMachine">
            <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JavaScript -->
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="message" id="message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BingoBett!</div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="controls">
            <button class="spin-btn" id="spinButton">üé∞ –ö—Ä—É—Ç–∏—Ç—å</button>
            <button id="autoSpinButton">‚ö° –ê–≤—Ç–æ—Å–ø–∏–Ω</button>
        </div>

        <div class="bet-controls">
            <button id="betMinus">- –°—Ç–∞–≤–∫–∞</button>
            <span>–°—Ç–∞–≤–∫–∞: <span id="betAmountDisplay">10</span> ‚ÇΩ</span>
            <button id="betPlus">+ –°—Ç–∞–≤–∫–∞</button>
        </div>

        <div class="controls">
            <button id="rulesButton">üìã –ü—Ä–∞–≤–∏–ª–∞</button>
            <button id="withdrawBtn" class="hide-in-telegram">üí∞ –í—ã–≤–µ—Å—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ "–î–æ–∂–¥—å –º–æ–Ω–µ—Ç" -->
    <div id="coinRainOverlay" class="mini-game-overlay">
        <canvas id="coinRainCanvas"></canvas>
        <div id="coinRainUI">
            <div id="coinRainTitle">üí∞ –î–û–ñ–î–¨ –ú–û–ù–ï–¢! üí∞</div>
            <div>–ü–æ–π–º–∞–Ω–æ: <span id="coinsCaught">0</span> ‚ÇΩ</div>
            <div>–û—Å—Ç–∞–ª–æ—Å—å: <span id="timeLeft">4</span> —Å–µ–∫</div>
        </div>
        <div id="coinRainResult" style="display:none;">
            <div id="coinRainResultText"></div>
            <button id="coinRainClose">–ó–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à</button>
        </div>
    </div>

    <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ "–í—ã–±–µ—Ä–∏ –∫–æ—Ä–æ–±–∫—É" -->
    <div class="mini-game-overlay" id="miniGameOverlay">
        <div class="mini-game-content">
            <h2>üéÅ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!</h2>
            <div style="display: flex; gap: 15px; margin: 20px 0; justify-content: center;">
                <div class="box" data-box="1" style="width: 80px; height: 80px; background: var(--tg-theme-secondary-bg-color, #444); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: all 0.3s;">üéÅ</div>
                <div class="box" data-box="2" style="width: 80px; height: 80px; background: var(--tg-theme-secondary-bg-color, #444); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: all 0.3s;">üéÅ</div>
                <div class="box" data-box="3" style="width: 80px; height: 80px; background: var(--tg-theme-secondary-bg-color, #444); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: all 0.3s;">üéÅ</div>
            </div>
            <div id="miniGameMsg">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∫–æ—Ä–æ–±–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞!</div>
            <button id="closeMiniGame" style="margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª -->
    <div id="rulesModal" class="modal-bg">
        <div class="modal">
            <h3>üìã –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã BingoBett</h3>
            <div style="text-align: left; margin: 20px 0;">
                <p><b>üé∞ –ò–≥—Ä–∞:</b> –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ 5√ó4, –≤—ã–∏–≥—Ä—ã—à–∏ –ø–æ 6 –ª–∏–Ω–∏—è–º (4 –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ + 2 –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ)</p>
                <p><b>üí∞ –°—Ç–∞–≤–∫–∏:</b> –æ—Ç 10 –¥–æ 80 —Ä—É–±–ª–µ–π –∑–∞ —Å–ø–∏–Ω</p>
                <p><b>üéÅ –§—Ä–∏—Å–ø–∏–Ω—ã:</b> 55 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π –Ω–∞ 24 —á–∞—Å–∞</p>
                <p><b>üé≤ –ú–∏–Ω–∏-–∏–≥—Ä—ã:</b> 13% —à–∞–Ω—Å –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–∞—Ö</p>
                <p><b>üíé –î–æ–∂–¥—å –º–æ–Ω–µ—Ç:</b> 4 —Å–µ–∫—É–Ω–¥—ã, –¥–æ 800‚ÇΩ</p>
            </div>
            <button id="closeRulesBtn">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tg = null;
        let isTelegramApp = false;
        let gameInitialized = false;

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let balance = 777;
        let betAmount = 10;
        let jackpot = 2200453;
        let username = '–ò–≥—Ä–æ–∫';
        let isSpinning = false;
        let freespins = 55;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        let slotMachine, balanceDisplay, jackpotDisplay, betDisplay, freespinCount, message;
        let spinButton, autoSpinButton, betMinus, betPlus, rulesButton;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegram() {
            const loading = document.getElementById('telegramLoading');
            const mainContent = document.getElementById('mainContent');

            loading.classList.add('show');

            setTimeout(() => {
                try {
                    if (window.Telegram && window.Telegram.WebApp) {
                        tg = window.Telegram.WebApp;
                        isTelegramApp = true;

                        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp
                        tg.ready();
                        tg.expand();
                        tg.enableClosingConfirmation();

                        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const user = tg.initDataUnsafe?.user;
                        if (user) {
                            username = user.first_name + (user.last_name ? ` ${user.last_name}` : '');
                        }

                        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
                        if (tg.colorScheme === 'dark') {
                            document.body.classList.add('dark-theme');
                        }

                        // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
                        tg.MainButton.setText('üé∞ –ò–≥—Ä–∞—Ç—å!');
                        tg.MainButton.show();
                        tg.MainButton.onClick(() => {
                            if (!isSpinning) startSpin();
                        });

                        document.body.classList.add('is-telegram');
                        console.log('‚úÖ Telegram Web App —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

                        // Haptic feedback –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                        if (tg.HapticFeedback) {
                            tg.HapticFeedback.impactOccurred('medium');
                        }
                    } else {
                        console.log('üì± –ó–∞–ø—É—Å–∫ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                    }

                    // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
                    loading.classList.remove('show');
                    mainContent.style.display = 'block';

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
                    initGame();

                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    loading.innerHTML = '<h2>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2><p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>';
                }
            }, 1500); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É Telegram SDK
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
                slotMachine = document.getElementById('slotMachine');
                balanceDisplay = document.getElementById('balanceDisplay');
                jackpotDisplay = document.getElementById('jackpotDisplay');
                betDisplay = document.getElementById('betDisplay');
                freespinCount = document.getElementById('freespinCount');
                message = document.getElementById('message');
                spinButton = document.getElementById('spinButton');
                autoSpinButton = document.getElementById('autoSpinButton');
                betMinus = document.getElementById('betMinus');
                betPlus = document.getElementById('betPlus');
                rulesButton = document.getElementById('rulesButton');

                // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã
                createSlots();

                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                setupEventHandlers();

                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUI();

                gameInitialized = true;
                showMessage('üé∞ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞! –£–¥–∞—á–∏!');

                console.log('‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤
        function createSlots() {
            if (!slotMachine) return;

            slotMachine.innerHTML = '';
            for (let i = 0; i < 20; i++) { // 5x4 = 20 —Å–ª–æ—Ç–æ–≤
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.textContent = 'üçí';
                slotMachine.appendChild(slot);
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventHandlers() {
            if (spinButton) {
                spinButton.addEventListener('click', startSpin);
            }

            if (betMinus) {
                betMinus.addEventListener('click', () => {
                    if (betAmount > 10) {
                        betAmount -= 10;
                        updateUI();
                        hapticFeedback('light');
                    }
                });
            }

            if (betPlus) {
                betPlus.addEventListener('click', () => {
                    if (betAmount < 80) {
                        betAmount += 10;
                        updateUI();
                        hapticFeedback('light');
                    }
                });
            }

            if (rulesButton) {
                rulesButton.addEventListener('click', () => {
                    document.getElementById('rulesModal').style.display = 'flex';
                    hapticFeedback('light');
                });
            }

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.getElementById('closeRulesBtn')?.addEventListener('click', () => {
                document.getElementById('rulesModal').style.display = 'none';
            });

            // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            document.addEventListener('touchstart', function() {}, { passive: true });
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–ø–∏–Ω–∞
        async function startSpin() {
            if (isSpinning || !gameInitialized) return;

            if (balance < betAmount && freespins <= 0) {
                showMessage('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                hapticFeedback('error');
                return;
            }

            isSpinning = true;
            hapticFeedback('medium');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            if (spinButton) spinButton.disabled = true;
            if (tg && tg.MainButton) tg.MainButton.hide();

            // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
            if (freespins > 0) {
                freespins--;
                showMessage('üéÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–∏—Å–ø–∏–Ω!');
            } else {
                balance -= betAmount;
                jackpot += betAmount * 0.1;
            }

            updateUI();

            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const slots = document.querySelectorAll('.slot');
            slots.forEach(slot => slot.classList.add('spinning'));

            showMessage('üé∞ –ö—Ä—É—Ç–∏–º –±–∞—Ä–∞–±–∞–Ω—ã...');

            // –°–∏–º—É–ª—è—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            await new Promise(resolve => setTimeout(resolve, 2000));

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const symbols = ['üçí', 'üçã', 'üçä', 'üçâ', 'üçá', 'üçì', 'üçç', 'ü•ù', 'üçå', 'ü••', 'üéÅ', 'üíé'];
            const result = [];

            slots.forEach((slot, index) => {
                const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                slot.textContent = symbol;
                slot.classList.remove('spinning');
                result.push(symbol);
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à–∏
            let totalWin = 0;
            let winningSlots = [];

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let row = 0; row < 4; row++) {
                const lineStart = row * 5;
                const lineSymbols = result.slice(lineStart, lineStart + 5);
                
                let consecutiveCount = 1;
                for (let i = 1; i < lineSymbols.length; i++) {
                    if (lineSymbols[i] === lineSymbols[0]) {
                        consecutiveCount++;
                    } else {
                        break;
                    }
                }

                if (consecutiveCount >= 3) {
                    const winAmount = getWinAmount(lineSymbols[0], consecutiveCount);
                    totalWin += winAmount * betAmount;
                    
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Å–ª–æ—Ç—ã
                    for (let i = 0; i < consecutiveCount; i++) {
                        winningSlots.push(lineStart + i);
                    }
                }
            }

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–∏
            winningSlots.forEach(index => {
                slots[index].classList.add('win');
            });

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (totalWin > 0) {
                balance += totalWin;
                showMessage(`üéâ –í—ã–∏–≥—Ä—ã—à: ${totalWin.toFixed(2)} ‚ÇΩ!`);
                hapticFeedback('success');

                // –®–∞–Ω—Å –º–∏–Ω–∏-–∏–≥—Ä—ã 13%
                if (Math.random() < 0.13) {
                    setTimeout(() => {
                        if (Math.random() < 0.5) {
                            startMiniGame(totalWin);
                        } else {
                            startCoinRainGame(totalWin);
                        }
                    }, 1500);
                }
            } else {
                showMessage('üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ!');
                hapticFeedback('light');
            }

            updateUI();

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            isSpinning = false;
            if (spinButton) spinButton.disabled = false;
            if (tg && tg.MainButton) tg.MainButton.show();

            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                slots.forEach(slot => slot.classList.remove('win'));
            }, 3000);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É–º–º—ã –≤—ã–∏–≥—Ä—ã—à–∞
        function getWinAmount(symbol, count) {
            const payouts = {
                'üçí': [0, 0, 5, 10, 20],
                'üçã': [0, 0, 5, 10, 20],
                'üçä': [0, 0, 5, 10, 20],
                'üçâ': [0, 0, 7, 14, 28],
                'üçá': [0, 0, 7, 14, 28],
                'üçì': [0, 0, 10, 20, 40],
                'üçç': [0, 0, 10, 20, 40],
                'ü•ù': [0, 0, 15, 30, 60],
                'üçå': [0, 0, 15, 30, 60],
                'ü••': [0, 0, 20, 40, 80],
                'üéÅ': [0, 0, 25, 50, 100],
                'üíé': [0, 0, 50, 100, 200]
            };

            return payouts[symbol]?.[count] || 0;
        }

        // –ú–∏–Ω–∏-–∏–≥—Ä–∞ "–í—ã–±–µ—Ä–∏ –∫–æ—Ä–æ–±–∫—É"
        function startMiniGame(winAmount) {
            const overlay = document.getElementById('miniGameOverlay');
            const boxes = overlay.querySelectorAll('.box');
            const msg = document.getElementById('miniGameMsg');

            overlay.style.display = 'flex';
            hapticFeedback('medium');

            const winBox = Math.floor(Math.random() * 3);

            boxes.forEach((box, index) => {
                box.onclick = () => {
                    boxes.forEach(b => b.onclick = null);

                    if (index === winBox) {
                        box.style.background = 'var(--tg-theme-accent-text-color, #ffd700)';
                        const bonus = Math.floor(winAmount * 0.5);
                        balance += bonus;
                        msg.textContent = `üéâ –í—ã–∏–≥—Ä—ã—à: +${bonus} ‚ÇΩ!`;
                        hapticFeedback('success');
                    } else {
                        box.style.background = '#f44336';
                        msg.textContent = 'üòî –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!';
                        hapticFeedback('error');
                    }

                    updateUI();
                    setTimeout(() => overlay.style.display = 'none', 2000);
                };
            });

            document.getElementById('closeMiniGame').onclick = () => {
                overlay.style.display = 'none';
            };
        }

        // –ú–∏–Ω–∏-–∏–≥—Ä–∞ "–î–æ–∂–¥—å –º–æ–Ω–µ—Ç"
        function startCoinRainGame(winAmount) {
            const overlay = document.getElementById('coinRainOverlay');
            const canvas = document.getElementById('coinRainCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            overlay.style.display = 'flex';
            hapticFeedback('medium');

            let score = 0;
            let timeLeft = 4;
            let coins = [];
            let gameActive = true;

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('coinsCaught').textContent = score;
            document.getElementById('timeLeft').textContent = timeLeft;

            // –ö–ª–∞—Å—Å –º–æ–Ω–µ—Ç—ã
            class Coin {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = -30;
                    this.radius = 15 + Math.random() * 10;
                    this.speed = 2 + Math.random() * 3;
                    this.value = 5;
                }

                update() {
                    this.y += this.speed;
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffd700';
                    ctx.fill();
                    ctx.strokeStyle = '#ff8c00';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // –°–∏–º–≤–æ–ª —Ä—É–±–ª—è
                    ctx.fillStyle = '#000';
                    ctx.font = `${this.radius}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText('‚ÇΩ', this.x, this.y + this.radius / 3);
                }

                isClicked(x, y) {
                    const dist = Math.sqrt((x - this.x) ** 2 + (y - this.y) ** 2);
                    return dist <= this.radius;
                }
            }

            // –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç
            const spawnInterval = setInterval(() => {
                if (gameActive) {
                    coins.push(new Coin());
                }
            }, 200);

            // –ê–Ω–∏–º–∞—Ü–∏—è
            function animate() {
                if (!gameActive) return;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = coins.length - 1; i >= 0; i--) {
                    coins[i].update();
                    coins[i].draw();

                    if (coins[i].y > canvas.height) {
                        coins.splice(i, 1);
                    }
                }

                requestAnimationFrame(animate);
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤/—Ç–∞–ø–æ–≤
            function handleClick(event) {
                if (!gameActive) return;

                const rect = canvas.getBoundingClientRect();
                const x = (event.clientX || event.touches[0].clientX) - rect.left;
                const y = (event.clientY || event.touches[0].clientY) - rect.top;

                for (let i = coins.length - 1; i >= 0; i--) {
                    if (coins[i].isClicked(x, y)) {
                        score += coins[i].value;
                        coins.splice(i, 1);
                        document.getElementById('coinsCaught').textContent = score;
                        hapticFeedback('light');
                        break;
                    }
                }
            }

            canvas.addEventListener('click', handleClick);
            canvas.addEventListener('touchstart', handleClick, { passive: false });

            // –¢–∞–π–º–µ—Ä
            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').textContent = timeLeft;

                if (timeLeft <= 0) {
                    gameActive = false;
                    clearInterval(timer);
                    clearInterval(spawnInterval);

                    balance += score;
                    updateUI();

                    document.getElementById('coinRainResultText').textContent = 
                        `üéâ –í—ã –ø–æ–π–º–∞–ª–∏ ${score} ‚ÇΩ!`;
                    document.getElementById('coinRainResult').style.display = 'block';
                    
                    hapticFeedback('success');
                }
            }, 1000);

            document.getElementById('coinRainClose').onclick = () => {
                overlay.style.display = 'none';
                gameActive = false;
                clearInterval(timer);
                clearInterval(spawnInterval);
            };

            animate();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            if (balanceDisplay) balanceDisplay.textContent = balance.toFixed(2);
            if (jackpotDisplay) jackpotDisplay.textContent = jackpot.toLocaleString();
            if (betDisplay) betDisplay.textContent = betAmount;
            if (freespinCount) freespinCount.textContent = freespins;
            if (document.getElementById('betAmountDisplay')) {
                document.getElementById('betAmountDisplay').textContent = betAmount;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text) {
            if (message) {
                message.textContent = text;
                message.style.opacity = '1';
                setTimeout(() => {
                    if (message.textContent === text) {
                        message.style.opacity = '0.7';
                    }
                }, 3000);
            }
        }

        // Haptic feedback –¥–ª—è Telegram
        function hapticFeedback(type) {
            if (tg && tg.HapticFeedback) {
                switch (type) {
                    case 'light':
                        tg.HapticFeedback.impactOccurred('light');
                        break;
                    case 'medium':
                        tg.HapticFeedback.impactOccurred('medium');
                        break;
                    case 'heavy':
                        tg.HapticFeedback.impactOccurred('heavy');
                        break;
                    case 'error':
                        tg.HapticFeedback.notificationOccurred('error');
                        break;
                    case 'success':
                        tg.HapticFeedback.notificationOccurred('success');
                        break;
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initTelegram);

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
        window.addEventListener('beforeunload', (e) => {
            if (isTelegramApp) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>