<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BingoBett - –°–ª–æ—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        h1 {
            font-size: 24px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .info-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            gap: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
            text-align: center;
        }
        
        .bet-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .bet-btn {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bet-btn:active {
            transform: scale(0.9);
        }
        
        .slot-machine {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 4px;
            background: #222;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            width: 100%;
            aspect-ratio: 5/4;
        }
        
        .slot {
            background: #000;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 40px;
        }
        
        .slot.spinning {
            background: #111;
            border: 1px solid #0f0;
            animation: spin-glow 0.1s infinite alternate;
        }
        
        .slot.win {
            background: gold !important;
            color: black !important;
            animation: win-pulse 1s infinite alternate;
            box-shadow: 0 0 20px gold !important;
        }
        
        .slot.big-win {
            background: linear-gradient(45deg, gold, orange) !important;
            color: black !important;
            animation: big-win-pulse 0.5s infinite alternate;
        }
        
        @keyframes spin-glow {
            0% { box-shadow: inset 0 0 10px #0f0, 0 0 5px #0f0; }
            100% { box-shadow: inset 0 0 20px #ff0, 0 0 10px #ff0; }
        }
        
        @keyframes win-pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        @keyframes big-win-pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            width: 100%;
        }
        
        .btn {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn.secondary {
            background: #666;
        }
        
        .btn.danger {
            background: #dc3545;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .btn.warning {
            background: #ffc107;
            color: black;
        }
        
        .message {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            width: 100%;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: pre-line;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .jackpot {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: black;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            width: 100%;
        }
        
        .replenish-section {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }
        
        .replenish-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .replenish-btn:active {
            transform: scale(0.95);
        }
        
        .bot-chat {
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            background: #111;
            border: 1px solid #0f0;
            border-radius: 8px;
            padding: 8px;
            font-family: monospace;
            font-size: 11px;
            color: #0f0;
        }
        
        .bot-message {
            margin: 2px 0;
            padding: 2px 0;
            border-bottom: 1px dotted rgba(0, 255, 0, 0.3);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            border-radius: 12px;
            padding: 20px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: var(--tg-theme-text-color, white);
        }
        
        .modal input {
            width: 100%;
            max-width: 250px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #666;
            border-radius: 6px;
            background: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, white);
            font-size: 16px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .mini-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .boxes {
            display: flex;
            gap: 10px;
        }
        
        .box {
            width: 60px;
            height: 60px;
            background: #333;
            border: 2px solid #0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .box:hover {
            background: #444;
            transform: scale(1.05);
        }
        
        .box.selected {
            background: #0088cc;
            border-color: #0088cc;
        }
        
        .box.win {
            background: #28a745;
            border-color: #28a745;
        }
        
        .box.lose {
            background: #dc3545;
            border-color: #dc3545;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .info-bar {
                font-size: 12px;
                padding: 8px;
            }
            
            .slot {
                font-size: 16px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 12px;
            }
            
            .box {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ BingoBett</h1>
        
        <div class="info-bar">
            <div class="info-item">
                üë§ <span id="username">–ì–æ—Å—Ç—å</span>
            </div>
            <div class="info-item">
                üí∞ <span id="balance">555</span> ‚ÇΩ
            </div>
            <div class="info-item">
                üéÅ <span id="freeSpins">55</span> —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤
            </div>
            <div class="info-item bet-controls">
                –°—Ç–∞–≤–∫–∞: 
                <button class="bet-btn" id="betMinus">-</button>
                <span id="betAmount">10</span> ‚ÇΩ
                <button class="bet-btn" id="betPlus">+</button>
            </div>
        </div>
        
        <div class="jackpot">
            üèÜ –î–∂–µ–∫–ø–æ—Ç: <span id="jackpot">2,200,453</span> ‚ÇΩ
        </div>
        
        <div class="replenish-section">
            <button class="replenish-btn" data-amount="50">+50‚ÇΩ</button>
            <button class="replenish-btn" data-amount="300">+300‚ÇΩ</button>
            <button class="replenish-btn" data-amount="500">+500‚ÇΩ</button>
            <button class="replenish-btn" data-amount="800">+800‚ÇΩ</button>
            <button class="btn warning" id="withdrawBtn">üí≥ –í—ã–≤–µ—Å—Ç–∏</button>
        </div>
        
        <div class="slot-machine" id="slotMachine">
            <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        
        <div class="controls">
            <button class="btn" id="spinBtn">üé∞ –ö—Ä—É—Ç–∏—Ç—å</button>
            <button class="btn secondary" id="autoBtn">‚ö° –ê–≤—Ç–æ—Å–ø–∏–Ω</button>
            <button class="btn danger hidden" id="stopAutoBtn">‚èπ –°—Ç–æ–ø</button>
            <button class="btn secondary" id="rulesBtn">üìã –ü—Ä–∞–≤–∏–ª–∞</button>
        </div>
        
        <div class="message" id="message">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BingoBett! –£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã! üçÄ
        </div>
        
        <div class="bot-chat" id="botChat">
            <div class="bot-message"><strong>üéØ –ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä–æ–∫–∏:</strong></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay hidden" id="usernameModal">
        <div class="modal">
            <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
            <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:</p>
            <input type="text" id="usernameInput" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20">
            <div class="modal-buttons">
                <button class="btn" id="usernameOk">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="withdrawModal">
        <div class="modal">
            <h3>üí≥ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
            <p>–î–æ—Å—Ç—É–ø–Ω–æ –∫ –≤—ã–≤–æ–¥—É: <span id="withdrawAmount">0</span> ‚ÇΩ</p>
            <input type="text" id="cardInput" placeholder="1234 5678 9012 3456" maxlength="19">
            <div id="withdrawError" style="color: #dc3545; margin: 10px 0;"></div>
            <div class="modal-buttons">
                <button class="btn success" id="confirmWithdraw">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button class="btn secondary" id="cancelWithdraw">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="miniGameModal">
        <div class="modal">
            <div class="mini-game">
                <h3>üéÅ –ë–æ–Ω—É—Å–Ω–∞—è –∏–≥—Ä–∞!</h3>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–∑!</p>
                <div class="boxes">
                    <div class="box" data-box="1">üéÅ</div>
                    <div class="box" data-box="2">üéÅ</div>
                    <div class="box" data-box="3">üéÅ</div>
                </div>
                <div id="miniGameResult">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!</div>
                <button class="btn secondary" id="closeMiniGame">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="rulesModal">
        <div class="modal" style="text-align: left; max-width: 500px;">
            <h3 style="text-align: center;">üìã –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
            
            <h4>üé∞ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</h4>
            <ul>
                <li>–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ: 5√ó4 (20 —Å–∏–º–≤–æ–ª–æ–≤)</li>
                <li>–°—Ç–∞–≤–∫–∏: –æ—Ç 10 –¥–æ 80 —Ä—É–±–ª–µ–π</li>
                <li>4 –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –ª–∏–Ω–∏–∏ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ)</li>
                <li>–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞ –ø–æ–¥—Ä—è–¥ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–∞</li>
            </ul>
            
            <h4>üí∞ –í—ã–ø–ª–∞—Ç—ã:</h4>
            <div style="font-size: 12px; background: #333; padding: 8px; border-radius: 4px; margin: 8px 0;">
                üçíüçãüçäüçâüçá: √ó5/√ó10/√ó20<br>
                üçìüçç: √ó7/√ó14/√ó28<br>
                ü•ùüçå: √ó10/√ó20/√ó40<br>
                ü••: √ó12/√ó24/√ó48<br>
                üéÅ: √ó15/√ó30/√ó60<br>
                üíé: √ó20/√ó40/√ó80<br>
                ‚≠ê: √ó25/√ó50/√ó100<br>
                üÉè: √ó30/√ó60/√ó120<br>
                üëë: √ó50/√ó100/√ó200<br>
                üí∞: √ó100/√ó200/√ó500
            </div>
            
            <h4>üéÅ –ë–æ–Ω—É—Å—ã:</h4>
            <ul>
                <li>55 —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</li>
                <li>–§—Ä–∏—Å–ø–∏–Ω—ã –¥–µ–π—Å—Ç–≤—É—é—Ç 24 —á–∞—Å–∞</li>
                <li>–°–ª—É—á–∞–π–Ω—ã–µ –º–∏–Ω–∏-–∏–≥—Ä—ã</li>
                <li>–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –¥–∂–µ–∫–ø–æ—Ç</li>
            </ul>
            
            <h4>üí≥ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤:</h4>
            <ul>
                <li>–ú–∏–Ω–∏–º—É–º: 40,000 ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ</li>
                <li>–í—ã–≤–æ–¥–∏—Ç—Å—è —Å—É–º–º–∞ —Å–≤—ã—à–µ 40,000 ‚ÇΩ</li>
                <li>–û–±—Ä–∞–±–æ—Ç–∫–∞: –¥–æ 24 —á–∞—Å–æ–≤</li>
            </ul>
            
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn" id="closeRules">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <script>
        console.log('BingoBett –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tg = null;
        let isTelegram = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        try {
            if (typeof window !== 'undefined' && window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                isTelegram = true;
                console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
                if (tg.themeParams) {
                    const root = document.documentElement;
                    if (tg.themeParams.bg_color) root.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color);
                    if (tg.themeParams.text_color) root.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color);
                    if (tg.themeParams.button_color) root.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color);
                    if (tg.themeParams.button_text_color) root.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color);
                }
            }
        } catch (e) {
            console.log('Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e);
        }
        
        // Haptic feedback
        function vibrate() {
            try {
                if (isTelegram && tg && tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            } catch (e) {
                console.log('Haptic feedback –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        // Storage —Å fallback
        const storage = {
            get: function(key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    try {
                        return sessionStorage.getItem(key);
                    } catch (e2) {
                        return null;
                    }
                }
            },
            set: function(key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    try {
                        sessionStorage.setItem(key, value);
                    } catch (e2) {
                        console.log('Storage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                }
            }
        };
        
        // –ò–≥—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ –≤—ã–ø–ª–∞—Ç—ã
        const SYMBOLS = ['üçí','üçã','üçä','üçâ','üçá','üçì','üçç','ü•ù','üçå','ü••','üéÅ','üíé','‚≠ê','üÉè','üëë','üí∞'];
        const PAY_TABLE = {
            'üçí': [0,0,5,10,20], 'üçã': [0,0,5,10,20], 'üçä': [0,0,5,10,20], 'üçâ': [0,0,5,10,20], 'üçá': [0,0,5,10,20],
            'üçì': [0,0,7,14,28], 'üçç': [0,0,7,14,28],
            'ü•ù': [0,0,10,20,40], 'üçå': [0,0,10,20,40],
            'ü••': [0,0,12,24,48],
            'üéÅ': [0,0,15,30,60],
            'üíé': [0,0,20,40,80],
            '‚≠ê': [0,0,25,50,100],
            'üÉè': [0,0,30,60,120],
            'üëë': [0,0,50,100,200],
            'üí∞': [0,0,100,200,500]
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            balance: parseInt(storage.get('balance')) || 555,
            bet: parseInt(storage.get('bet')) || 10,
            jackpot: parseInt(storage.get('jackpot')) || 2200453,
            freeSpins: parseInt(storage.get('freeSpins')) || 55,
            username: storage.get('username') || '',
            spinning: false,
            autoSpin: false,
            autoInterval: null
        };
        
        console.log('–ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', gameState);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤
        if (!storage.get('registrationTime')) {
            storage.set('registrationTime', Date.now().toString());
            storage.set('freeSpins', '55');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤
        function checkFreeSpinsExpiry() {
            const regTime = parseInt(storage.get('registrationTime') || '0');
            const now = Date.now();
            const dayInMs = 24 * 60 * 60 * 1000;
            
            if (now - regTime > dayInMs) {
                gameState.freeSpins = 0;
                storage.set('freeSpins', '0');
            }
        }
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        function getElements() {
            return {
                username: document.getElementById('username'),
                balance: document.getElementById('balance'),
                freeSpins: document.getElementById('freeSpins'),
                betAmount: document.getElementById('betAmount'),
                jackpot: document.getElementById('jackpot'),
                message: document.getElementById('message'),
                slotMachine: document.getElementById('slotMachine'),
                botChat: document.getElementById('botChat'),
                
                betMinus: document.getElementById('betMinus'),
                betPlus: document.getElementById('betPlus'),
                spinBtn: document.getElementById('spinBtn'),
                autoBtn: document.getElementById('autoBtn'),
                stopAutoBtn: document.getElementById('stopAutoBtn'),
                withdrawBtn: document.getElementById('withdrawBtn'),
                rulesBtn: document.getElementById('rulesBtn'),
                
                usernameModal: document.getElementById('usernameModal'),
                withdrawModal: document.getElementById('withdrawModal'),
                miniGameModal: document.getElementById('miniGameModal'),
                rulesModal: document.getElementById('rulesModal')
            };
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤
        function createSlots() {
            const slotMachine = document.getElementById('slotMachine');
            if (!slotMachine) {
                console.error('–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                return;
            }
            
            slotMachine.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.textContent = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                slotMachine.appendChild(slot);
            }
            console.log('–°–ª–æ—Ç—ã —Å–æ–∑–¥–∞–Ω—ã');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            const elements = getElements();
            
            if (elements.username) elements.username.textContent = gameState.username || '–ì–æ—Å—Ç—å';
            if (elements.balance) elements.balance.textContent = gameState.balance.toLocaleString();
            if (elements.freeSpins) elements.freeSpins.textContent = gameState.freeSpins;
            if (elements.betAmount) elements.betAmount.textContent = gameState.bet;
            if (elements.jackpot) elements.jackpot.textContent = gameState.jackpot.toLocaleString();
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            storage.set('balance', gameState.balance.toString());
            storage.set('bet', gameState.bet.toString());
            storage.set('jackpot', gameState.jackpot.toString());
            storage.set('freeSpins', gameState.freeSpins.toString());
            storage.set('username', gameState.username);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, duration = 4000) {
            const messageEl = document.getElementById('message');
            if (messageEl) {
                messageEl.textContent = text;
                setTimeout(() => {
                    messageEl.textContent = '–£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã! üçÄ';
                }, duration);
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        function addBotMessage(text) {
            const botChat = document.getElementById('botChat');
            if (!botChat) return;
            
            const message = document.createElement('div');
            message.className = 'bot-message';
            message.textContent = `${new Date().toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'})} - ${text}`;
            botChat.appendChild(message);
            botChat.scrollTop = botChat.scrollHeight;
            
            while (botChat.children.length > 15) {
                botChat.removeChild(botChat.children[1]);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π
        function checkWins(grid) {
            let totalWin = 0;
            let winPositions = [];
            
            for (let row = 0; row < 4; row++) {
                const line = [];
                for (let col = 0; col < 5; col++) {
                    line.push(grid[row * 5 + col]);
                }
                
                const symbol = line[0];
                let count = 1;
                
                for (let i = 1; i < 5; i++) {
                    if (line[i] === symbol) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                if (count >= 3 && PAY_TABLE[symbol]) {
                    const multiplier = PAY_TABLE[symbol][count];
                    totalWin += multiplier;
                    
                    for (let i = 0; i < count; i++) {
                        winPositions.push(row * 5 + i);
                    }
                }
            }
            
            return { totalWin, winPositions };
        }
        
        // –°–ø–∏–Ω
        async function spin() {
            if (gameState.spinning) return;
            
            const canUseFreeSpins = gameState.freeSpins > 0;
            if (!canUseFreeSpins && gameState.balance < gameState.bet) {
                showMessage('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
                return;
            }
            
            gameState.spinning = true;
            const elements = getElements();
            if (elements.spinBtn) elements.spinBtn.disabled = true;
            if (elements.autoBtn) elements.autoBtn.disabled = true;
            
            vibrate();
            
            let usedFreeSpins = false;
            if (canUseFreeSpins && confirm(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—Ä–∏—Å–ø–∏–Ω? (–û—Å—Ç–∞–ª–æ—Å—å: ${gameState.freeSpins})`)) {
                gameState.freeSpins--;
                usedFreeSpins = true;
                showMessage('üéÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–∏—Å–ø–∏–Ω!');
            } else {
                gameState.balance -= gameState.bet;
            }
            
            gameState.jackpot += Math.floor(gameState.bet * 0.1);
            updateUI();
            
            const slotMachine = document.getElementById('slotMachine');
            const slots = slotMachine.children;
            
            for (let slot of slots) {
                slot.classList.add('spinning');
                slot.classList.remove('win', 'big-win');
            }
            
            const result = [];
            for (let i = 0; i < 20; i++) {
                result.push(SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]);
            }
            
            for (let col = 0; col < 5; col++) {
                await new Promise(resolve => setTimeout(resolve, 200 + col * 100));
                
                for (let row = 0; row < 4; row++) {
                    const index = row * 5 + col;
                    const slot = slots[index];
                    if (slot) {
                        slot.classList.remove('spinning');
                        slot.textContent = result[index];
                    }
                }
                vibrate();
            }
            
            const { totalWin, winPositions } = checkWins(result);
            
            if (totalWin > 0) {
                const winAmount = totalWin * gameState.bet;
                gameState.balance += winAmount;
                
                winPositions.forEach(pos => {
                    if (slots[pos]) {
                        if (winAmount >= gameState.bet * 20) {
                            slots[pos].classList.add('big-win');
                        } else {
                            slots[pos].classList.add('win');
                        }
                    }
                });
                
                if (winAmount >= gameState.bet * 50) {
                    showMessage(`üéâ MEGA WIN! +${winAmount.toLocaleString()} ‚ÇΩ`, 6000);
                    addBotMessage(`${gameState.username} –≤—ã–∏–≥—Ä–∞–ª ${winAmount.toLocaleString()} ‚ÇΩ!`);
                } else {
                    showMessage(`üí∞ –í—ã–∏–≥—Ä—ã—à: +${winAmount.toLocaleString()} ‚ÇΩ`);
                }
                
                if (Math.random() < 0.0005) {
                    gameState.balance += gameState.jackpot;
                    showMessage(`üèÜ –î–ñ–ï–ö–ü–û–¢! +${gameState.jackpot.toLocaleString()} ‚ÇΩ`, 8000);
                    addBotMessage(`${gameState.username} —Å–æ—Ä–≤–∞–ª –î–ñ–ï–ö–ü–û–¢ ${gameState.jackpot.toLocaleString()} ‚ÇΩ!`);
                    gameState.jackpot = 100000;
                }
                
                if (Math.random() < 0.03) {
                    setTimeout(() => startMiniGame(), 2000);
                }
            }
            
            updateUI();
            gameState.spinning = false;
            if (elements.spinBtn) elements.spinBtn.disabled = false;
            if (elements.autoBtn) elements.autoBtn.disabled = false;
        }
        
        // –ê–≤—Ç–æ—Å–ø–∏–Ω
        function toggleAutoSpin() {
            const elements = getElements();
            
            if (gameState.autoSpin) {
                gameState.autoSpin = false;
                clearInterval(gameState.autoInterval);
                if (elements.autoBtn) elements.autoBtn.classList.remove('hidden');
                if (elements.stopAutoBtn) elements.stopAutoBtn.classList.add('hidden');
                showMessage('–ê–≤—Ç–æ—Å–ø–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            } else {
                gameState.autoSpin = true;
                if (elements.autoBtn) elements.autoBtn.classList.add('hidden');
                if (elements.stopAutoBtn) elements.stopAutoBtn.classList.remove('hidden');
                showMessage('–ê–≤—Ç–æ—Å–ø–∏–Ω –∑–∞–ø—É—â–µ–Ω');
                
                gameState.autoInterval = setInterval(() => {
                    if (!gameState.spinning && (gameState.balance >= gameState.bet || gameState.freeSpins > 0)) {
                        spin();
                    } else {
                        toggleAutoSpin();
                        showMessage('–ê–≤—Ç–æ—Å–ø–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                    }
                }, 3000);
            }
            vibrate();
        }
        
        // –ú–∏–Ω–∏-–∏–≥—Ä–∞
        function startMiniGame() {
            const winningBox = Math.floor(Math.random() * 3) + 1;
            const prize = gameState.bet * (2 + Math.random() * 4);
            
            const miniGameModal = document.getElementById('miniGameModal');
            if (miniGameModal) {
                miniGameModal.classList.remove('hidden');
            }
            
            const boxes = document.querySelectorAll('.box');
            const result = document.getElementById('miniGameResult');
            
            if (result) {
                result.textContent = `–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: ${Math.floor(prize).toLocaleString()} ‚ÇΩ`;
            }
            
            boxes.forEach((box, index) => {
                box.className = 'box';
                box.onclick = () => {
                    boxes.forEach(b => b.onclick = null);
                    
                    if (index + 1 === winningBox) {
                        box.classList.add('win');
                        gameState.balance += Math.floor(prize);
                        if (result) result.textContent = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${Math.floor(prize).toLocaleString()} ‚ÇΩ!`;
                        addBotMessage(`${gameState.username} –≤—ã–∏–≥—Ä–∞–ª ${Math.floor(prize).toLocaleString()} ‚ÇΩ –≤ –±–æ–Ω—É—Å–Ω–æ–π –∏–≥—Ä–µ!`);
                    } else {
                        box.classList.add('lose');
                        boxes[winningBox - 1].classList.add('win');
                        if (result) result.textContent = `üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ! –í—ã–∏–≥—Ä—ã—à–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞ –±—ã–ª–∞ ‚Ññ${winningBox}`;
                    }
                    updateUI();
                };
            });
        }
        
        // –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
        function initWithdraw() {
            const minBalance = 40000;
            if (gameState.balance <= minBalance) {
                showMessage(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!\n–ú–∏–Ω–∏–º—É–º –¥–ª—è –≤—ã–≤–æ–¥–∞: ${minBalance.toLocaleString()} ‚ÇΩ\n–í–∞—à –±–∞–ª–∞–Ω—Å: ${gameState.balance.toLocaleString()} ‚ÇΩ`);
                return;
            }
            
            const withdrawAmount = gameState.balance - minBalance;
            const withdrawAmountEl = document.getElementById('withdrawAmount');
            if (withdrawAmountEl) {
                withdrawAmountEl.textContent = withdrawAmount.toLocaleString();
            }
            
            const withdrawModal = document.getElementById('withdrawModal');
            if (withdrawModal) {
                withdrawModal.classList.remove('hidden');
            }
        }
        
        function confirmWithdraw() {
            const cardInput = document.getElementById('cardInput');
            const cardNumber = cardInput ? cardInput.value.replace(/\s/g, '') : '';
            const errorEl = document.getElementById('withdrawError');
            
            if (!/^\d{16}$/.test(cardNumber)) {
                if (errorEl) errorEl.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä)';
                return;
            }
            
            const withdrawAmount = gameState.balance - 40000;
            gameState.balance = 40000;
            
            const withdrawModal = document.getElementById('withdrawModal');
            if (withdrawModal) {
                withdrawModal.classList.add('hidden');
            }
            
            showMessage(`‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ ${withdrawAmount.toLocaleString()} ‚ÇΩ –ø—Ä–∏–Ω—è—Ç–∞!\n–ö–∞—Ä—Ç–∞: ****-****-****-${cardNumber.slice(-4)}\n–°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –¥–æ 24 —á–∞—Å–æ–≤`, 8000);
            addBotMessage(`${gameState.username} –≤—ã–≤–µ–ª ${withdrawAmount.toLocaleString()} ‚ÇΩ`);
            updateUI();
            vibrate();
        }
        
        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function replenish(amount) {
            setTimeout(() => {
                gameState.balance += amount;
                updateUI();
                showMessage(`‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚ÇΩ`);
                addBotMessage(`${gameState.username} –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å –Ω–∞ ${amount} ‚ÇΩ`);
            }, 1000);
            
            showMessage('üí≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...');
            vibrate();
        }
        
        // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        const BOT_MESSAGES = [
            '–≤—ã–∏–≥—Ä–∞–ª 450 ‚ÇΩ!', '—Å–æ—Ä–≤–∞–ª –¥–∂–µ–∫–ø–æ—Ç 15,000 ‚ÇΩ!', '–≤—ã–∏–≥—Ä–∞–ª–∞ 820 ‚ÇΩ!',
            '–ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å 1,200 ‚ÇΩ!', '–≤—ã–∏–≥—Ä–∞–ª–∞ 650 ‚ÇΩ –≤ –±–æ–Ω—É—Å–Ω–æ–π –∏–≥—Ä–µ!',
            '—Å–æ—Ä–≤–∞–ª –∫—É—à 3,400 ‚ÇΩ!', '–≤—ã–∏–≥—Ä–∞–ª–∞ 780 ‚ÇΩ!', '–ø–æ–ª—É—á–∏–ª 2,100 ‚ÇΩ!'
        ];
        
        const NAMES = ['–ê–Ω–Ω–∞ –ö.', '–ú–∞–∫—Å–∏–º –†.', '–ï–ª–µ–Ω–∞ –í.', '–ò–≥–æ—Ä—å –°.', '–ú–∞—Ä–∏—è –ü.', '–ê–ª–µ–∫—Å–µ–π –ö.', '–û–ª—å–≥–∞ –ù.', '–î–º–∏—Ç—Ä–∏–π –õ.'];
        
        function startBotMessages() {
            setInterval(() => {
                if (Math.random() < 0.4) {
                    const name = NAMES[Math.floor(Math.random() * NAMES.length)];
                    const message = BOT_MESSAGES[Math.floor(Math.random() * BOT_MESSAGES.length)];
                    addBotMessage(`${name} ${message}`);
                }
            }, 5000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function initUser() {
            if (isTelegram && tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                gameState.username = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                updateUI();
                return;
            }
            
            if (!gameState.username) {
                const usernameModal = document.getElementById('usernameModal');
                if (usernameModal) {
                    usernameModal.classList.remove('hidden');
                    const usernameInput = document.getElementById('usernameInput');
                    if (usernameInput) {
                        setTimeout(() => usernameInput.focus(), 100);
                    }
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function initEventListeners() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π');
            
            // –°—Ç–∞–≤–∫–∏
            const betMinus = document.getElementById('betMinus');
            const betPlus = document.getElementById('betPlus');
            
            if (betMinus) {
                betMinus.onclick = () => {
                    if (gameState.bet > 10) {
                        gameState.bet -= 10;
                        updateUI();
                        vibrate();
                    }
                };
            }
            
            if (betPlus) {
                betPlus.onclick = () => {
                    if (gameState.bet < 80) {
                        gameState.bet += 10;
                        updateUI();
                        vibrate();
                    }
                };
            }
            
            // –ò–≥—Ä–∞
            const spinBtn = document.getElementById('spinBtn');
            const autoBtn = document.getElementById('autoBtn');
            const stopAutoBtn = document.getElementById('stopAutoBtn');
            
            if (spinBtn) spinBtn.onclick = spin;
            if (autoBtn) autoBtn.onclick = toggleAutoSpin;
            if (stopAutoBtn) stopAutoBtn.onclick = toggleAutoSpin;
            
            // –ü—Ä–æ—á–µ–µ
            const withdrawBtn = document.getElementById('withdrawBtn');
            const rulesBtn = document.getElementById('rulesBtn');
            
            if (withdrawBtn) {
                withdrawBtn.onclick = () => {
                    initWithdraw();
                    vibrate();
                };
            }
            
            if (rulesBtn) {
                rulesBtn.onclick = () => {
                    const rulesModal = document.getElementById('rulesModal');
                    if (rulesModal) rulesModal.classList.remove('hidden');
                    vibrate();
                };
            }
            
            // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
            document.querySelectorAll('.replenish-btn').forEach(btn => {
                btn.onclick = () => {
                    replenish(parseInt(btn.dataset.amount));
                };
            });
            
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const usernameOk = document.getElementById('usernameOk');
            if (usernameOk) {
                usernameOk.onclick = () => {
                    const input = document.getElementById('usernameInput');
                    if (input && input.value.trim()) {
                        gameState.username = input.value.trim();
                        const usernameModal = document.getElementById('usernameModal');
                        if (usernameModal) usernameModal.classList.add('hidden');
                        updateUI();
                        vibrate();
                    }
                };
            }
            
            const confirmWithdraw = document.getElementById('confirmWithdraw');
            const cancelWithdraw = document.getElementById('cancelWithdraw');
            
            if (confirmWithdraw) confirmWithdraw.onclick = confirmWithdraw;
            if (cancelWithdraw) {
                cancelWithdraw.onclick = () => {
                    const withdrawModal = document.getElementById('withdrawModal');
                    if (withdrawModal) withdrawModal.classList.add('hidden');
                    const cardInput = document.getElementById('cardInput');
                    const withdrawError = document.getElementById('withdrawError');
                    if (cardInput) cardInput.value = '';
                    if (withdrawError) withdrawError.textContent = '';
                };
            }
            
            const closeMiniGame = document.getElementById('closeMiniGame');
            if (closeMiniGame) {
                closeMiniGame.onclick = () => {
                    const miniGameModal = document.getElementById('miniGameModal');
                    if (miniGameModal) miniGameModal.classList.add('hidden');
                };
            }
            
            const closeRules = document.getElementById('closeRules');
            if (closeRules) {
                closeRules.onclick = () => {
                    const rulesModal = document.getElementById('rulesModal');
                    if (rulesModal) rulesModal.classList.add('hidden');
                };
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
            const cardInput = document.getElementById('cardInput');
            if (cardInput) {
                cardInput.oninput = (e) => {
                    let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/g, '');
                    value = value.replace(/(.{4})/g, '$1 ').trim();
                    e.target.value = value;
                };
            }
            
            // Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
            const usernameInput = document.getElementById('usernameInput');
            if (usernameInput) {
                usernameInput.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        const usernameOk = document.getElementById('usernameOk');
                        if (usernameOk) usernameOk.click();
                    }
                };
            }
            
            console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
        }
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ confirmWithdraw
        window.confirmWithdraw = confirmWithdraw;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã');
            
            checkFreeSpinsExpiry();
            createSlots();
            updateUI();
            initEventListeners();
            initUser();
            startBotMessages();
            
            setTimeout(() => {
                if (gameState.username) {
                    showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${gameState.username}! –£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã! üçÄ`);
                }
            }, 1000);
            
            console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
        
        console.log('BingoBett —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html>
