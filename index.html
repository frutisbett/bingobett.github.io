<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BingoBett</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .replenish-buttons {
      margin: 15px 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .replenish-btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #f9c74f;
      color: #000;
      cursor: pointer;
    }
    #freeSpinsDisplay {
      font-size: 18px;
      margin: 10px;
    }
    #balanceDisplay {
      font-size: 24px;
      margin: 10px;
    }
    .slot-machine {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      justify-content: center;
      margin: 20px auto;
      width: fit-content;
    }
    .slot {
      font-size: 40px;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #222;
      border: 2px solid #444;
      border-radius: 10px;
      transition: all 0.3s;
    }
    .win {
      background: gold;
      color: black;
      box-shadow: 0 0 15px 5px gold;
    }
    .big-win {
      animation: bigWin 1s infinite;
    }
    @keyframes bigWin {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .controls {
      margin: 20px;
    }
    .controls button {
      margin: 5px;
    }
    #miniGameOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #miniGameOverlay .box {
      width: 80px;
      height: 80px;
      font-size: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #444;
      margin: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    #miniGameOverlay .win {
      background: #f9c74f;
    }
    #miniGameOverlay .lose {
      background: #e55;
    }
    #miniGameOverlay .selected {
      transform: scale(1.2);
    }
    #botChat {
      max-height: 150px;
      overflow-y: auto;
      border-top: 1px solid #444;
      margin: 10px;
    }
    .bot-message {
      margin: 5px 0;
    }
  </style>
</head>
<body>

  <!-- Счётчик фриспинов -->
  <div id="freeSpinsDisplay">Фриспины: 55</div>

  <!-- Баланс -->
  <div id="balanceDisplay">100.00 ₽</div>

  <!-- Кнопки пополнения -->
  <div class="replenish-buttons">
    <button class="replenish-btn" data-amount="50">50 ₽</button>
    <button class="replenish-btn" data-amount="300">300 ₽</button>
    <button class="replenish-btn" data-amount="500">500 ₽</button>
    <button class="replenish-btn" data-amount="800">800 ₽</button>
    <a id="replenishLink" href="#" target="_blank" style="display: none;">Оплатить</a>
  </div>

  <!-- Слоты -->
  <div class="slot-machine" id="slotMachine"></div>

  <!-- Кнопки управления -->
  <div class="controls">
    <button id="spinButton">Вращать 🎰</button>
    <button id="autoSpinButton">Автоспин ▶️</button>
    <button id="stopAutoSpinButton" style="display:none;">Стоп автоспин ⏹</button>
  </div>

  <!-- Мини-игра -->
  <div id="miniGameOverlay">
    <div class="box" data-box="1">🎁</div>
    <div class="box" data-box="2">🎁</div>
    <div class="box" data-box="3">🎁</div>
    <div id="miniGameMsg"></div>
    <button id="closeMiniGame" style="margin-top: 10px; display: none;">Закрыть</button>
  </div>

  <!-- Бот-чат -->
  <div id="botChat"></div>

  <script src="https://telegram.org/js/telegram-web-app.js "></script>
  <script>
    const Telegram = window.Telegram.WebApp;
    Telegram.ready();

    // --- Переменные игры ---
    let balance = 100;
    let betAmount = 10;
    let lastWin = 0;
    let autoSpinActive = false;
    let autoSpinTimer = null;
    let miniGameActive = false;

    const balanceDisplay = document.getElementById('balanceDisplay');
    const slotMachine = document.getElementById('slotMachine');
    const botChat = document.getElementById('botChat');
    const spinButton = document.getElementById('spinButton');
    const autoSpinButton = document.getElementById('autoSpinButton');
    const stopAutoSpinButton = document.getElementById('stopAutoSpinButton');
    const freeSpinsDisplay = document.getElementById('freeSpinsDisplay');

    // --- Проверка URL на наличие платежа ---
    const urlParams = new URLSearchParams(window.location.search);
    const amountToReplenish = urlParams.get('replenish');

    if (amountToReplenish && !localStorage.getItem('processedReplenish')) {
      balance += parseFloat(amountToReplenish);
      updateUI();
      localStorage.setItem('processedReplenish', 'true');
      alert(`Баланс пополнен на ${amountToReplenish} ₽`);
    }

    window.addEventListener('beforeunload', () => {
      localStorage.removeItem('processedReplenish');
    });

    // --- Инициализация фриспинов ---
    const registrationTimestamp = localStorage.getItem('registrationTimestamp');
    if (!registrationTimestamp) {
      localStorage.setItem('registrationTimestamp', Date.now());
      localStorage.setItem('freeSpins', 55);
    }

    function isFreeSpinsExpired() {
      const registrationTime = Number(localStorage.getItem('registrationTimestamp'));
      const currentTime = Date.now();
      const expirationPeriod = 23 * 60 * 60 * 1000;
      return (currentTime - registrationTime) > expirationPeriod;
    }

    function hasAvailableFreeSpins() {
      const remainingSpins = Number(localStorage.getItem('freeSpins')) || 55;
      return remainingSpins > 0 && !isFreeSpinsExpired();
    }

    // --- Обновление счётчика фриспинов ---
    function updateFreeSpinsDisplay() {
      const remainingSpins = Number(localStorage.getItem('freeSpins')) || 55;
      if (freeSpinsDisplay) {
        freeSpinsDisplay.textContent = `Фриспины: ${remainingSpins}`;
      }
    }

    updateFreeSpinsDisplay();

    // --- Обработчики пополнения ---
    document.querySelectorAll('.replenish-btn').forEach(btn => {
      btn.onclick = function () {
        const amount = this.dataset.amount;
        const receiver = '4100118182998706'; // ваш кошелёк
        const redirectUrl = encodeURIComponent(`https://t.me/frutis_bingo_bett_bot/startapp?replenish=${amount}`);
        const paymentUrl = ` https://yoomoney.ru/quickpay/confirm.xml?receiver=${receiver}&quickpay-form=small&sum=${amount}&paymentType=AC&successURL=${redirectUrl}`;

        const link = document.getElementById('replenishLink');
        link.href = paymentUrl;
        link.click();
      };
    });

    // --- Обновление интерфейса ---
    function updateUI() {
      balanceDisplay.textContent = `${balance.toFixed(2)} ₽`;
      localStorage.setItem('slotBalance', balance);
    }

    // --- Создание слотов ---
    const rows = 1;
    const columns = 5;
    const reels = [
      ["🍒", "🍋", "🍊", "🍉", "🍇", "🍓", "🍍", "🥝", "🍌", "🥥", "🎁", "💎"],
      ["🍋", "🍊", "🍉", "🍇", "🍓", "🍍", "🥝", "🍌", "🥥", "🎁", "💎", "🍒"],
      ["🍊", "🍉", "🍇", "🍓", "🍍", "🥝", "🍌", "🥥", "🎁", "💎", "🍒", "🍋"],
      ["🍉", "🍇", "🍓", "🍍", "🥝", "🍌", "🥥", "🎁", "💎", "🍒", "🍋", "🍊"],
      ["🍇", "🍓", "🍍", "🥝", "🍌", "🥥", "🎁", "💎", "🍒", "🍋", "🍊", "🍉"]
    ];

    function createSlots() {
      slotMachine.innerHTML = '';
      for (let row = 0; row < rows; row++) {
        for (let col = 0; col < columns; col++) {
          const slot = document.createElement('div');
          slot.classList.add('slot');
          slot.textContent = "❓";
          slotMachine.appendChild(slot);
        }
      }
    }

    createSlots();

    // --- Анимация вращения ---
    function spinWithAnimation(callback) {
      if (miniGameActive) {
        if (callback) callback();
        return;
      }

      if (balance < betAmount) {
        alert('Недостаточно средств для спина!');
        stopAutoSpin();
        if (callback) callback();
        return;
      }

      balance -= betAmount;
      updateUI();

      const slots = document.querySelectorAll('.slot');
      const stopPositions = [];
      for (let col = 0; col < columns; col++) {
        stopPositions[col] = Math.floor(Math.random() * reels[col].length);
      }

      let spinDuration = 1200;
      let startTime = performance.now();

      function animate(currentTime) {
        let elapsed = currentTime - startTime;
        let progress = Math.min(elapsed / spinDuration, 1);

        slots.forEach((s, i) => {
          let reel = reels[i];
          let index = Math.floor((progress * reel.length) % reel.length);
          s.textContent = reel[index];
        });

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          // Остановка на выигрышной комбинации
          let winChance = Math.random();
          let totalWin = 0;

          // Имитация выигрыша
          if (winChance < 0.3) {
            totalWin = betAmount * (Math.random() * 5 + 1); // выигрыш от x1 до x6
            if (totalWin > 500) totalWin = 500; // ограничение на 500
            balance += totalWin;
            updateUI();
            alert(`Вы выиграли ${totalWin.toFixed(0)} ₽`);
          } else {
            updateUI();
            alert('Нет выигрыша. Попробуйте ещё!');
          }
        }
      }

      requestAnimationFrame(animate);
    }

    // --- Кнопка "Вращать" ---
    spinButton.onclick = function () {
      if (!hasAvailableFreeSpins()) {
        alert('Все фриспины истекли. Пополните баланс.');
        return;
      }

      const remainingSpins = Number(localStorage.getItem('freeSpins')) - 1;
      localStorage.setItem('freeSpins', remainingSpins);
      updateFreeSpinsDisplay();

      spinWithAnimation();
    };

    // --- Автоспин ---
    autoSpinButton.onclick = () => {
      autoSpinActive = true;
      autoSpinTimer = setInterval(() => {
        if (hasAvailableFreeSpins()) {
          spinWithAnimation();
          const remainingSpins = Number(localStorage.getItem('freeSpins')) - 1;
          localStorage.setItem('freeSpins', remainingSpins);
          updateFreeSpinsDisplay();
        }
      }, 2000);
      stopAutoSpinButton.style.display = '';
      autoSpinButton.style.display = 'none';
    };

    stopAutoSpinButton.onclick = () => {
      clearInterval(autoSpinTimer);
      autoSpinActive = false;
      stopAutoSpinButton.style.display = 'none';
      autoSpinButton.style.display = '';
    };

    // --- Мини-игра с подарками ---
    function showMiniGame(winAmount, callback) {
      const overlay = document.getElementById('miniGameOverlay');
      const boxes = overlay.querySelectorAll('.box');
      const msg = document.getElementById('miniGameMsg');
      const closeBtn = document.getElementById('closeMiniGame');

      overlay.style.display = 'flex';
      miniGameActive = true;
      msg.textContent = "Выберите одну из коробок:";
      closeBtn.style.display = 'none';

      boxes.forEach(box => {
        box.classList.remove('win', 'lose', 'selected');
        box.onclick = null;
        box.onclick = () => {
          box.classList.add('selected');
          const winBox = Math.floor(Math.random() * 3) + 1;
          if (parseInt(box.dataset.box) === winBox) {
            msg.textContent = `Поздравляем! Вы выиграли: +${winAmount} ₽`;
            balance += winAmount;
          } else {
            msg.textContent = `Увы! Вы потеряли половину выигрыша (-${Math.floor(winAmount / 2)} ₽)`;
            balance -= Math.floor(winAmount / 2);
          }
          updateUI();
          closeBtn.style.display = '';
        };
      });

      closeBtn.onclick = () => {
        overlay.style.display = 'none';
        miniGameActive = false;
        if (callback) callback();
        if (autoSpinActive) spinWithAnimation();
      };
    }

    // --- Бот-чат ---
    const botNames = ["Артём", "Ирина", "Максим", "Ольга", "Владимир", "Светлана"];
    const botMessages = [
      "выиграл(а) 120 ₽!", "поймал(а) бонус!", "сорвал(а) джекпот!", "проиграл(а) 40 ₽",
      "выиграл(а) 200 ₽!", "попробовал(а) автоспин", "получил(а) мини-игру", "выиграл(а) 70 ₽",
      "сорвал(а) банк!", "проиграл(а) 20 ₽", "выиграл(а) 250 ₽!", "получил(а) фриспины",
      "выиграл(а) 80 ₽", "сорвал(а) супер-выигрыш!", "проиграл(а) 60 ₽",
      "выиграл(а) 250 ₽!", "выиграл(а) 90 ₽", "выиграл(а) 150 ₽!", "проиграл(а) 10 ₽",
      "выиграл(а) 200 ₽!"
    ];

    function addBotMessage() {
      const name = botNames[Math.floor(Math.random() * botNames.length)];
      const message = document.createElement('div');
      message.className = 'bot-message';
      message.innerHTML = `<span style="color:#0ff">${name}</span>: ${botMessages[Math.floor(Math.random() * botMessages.length)]}`;
      botChat.appendChild(message);
      botChat.scrollTop = botChat.scrollHeight;
    }

    // --- Периодические сообщения ---
    setInterval(() => {
      addBotMessage();
    }, 7000);

    // --- Инициализация ---
    updateUI();
    updateFreeSpinsDisplay();
  </script>
</body>
</html>






