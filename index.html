<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BingoBett</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #444);
    color: #fff;
    margin: 0; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  .info-bar {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;
    margin-bottom: 15px;
  }
  .info-bar > div {
    font-size: 18px;
  }
  .slot-machine {
  display: grid;
  grid-template-columns: repeat(5, 18vw);
  grid-template-rows: repeat(4, 12vw);
  gap: 2vw;
  background: #222;
  padding: 4vw 2vw;
  border-radius: 4vw;
  box-shadow: 0 0 4vw #0f0;
  max-width: 98vw;
  min-width: 320px;
}
  .slot {
  background: #000;
  border-radius: 2vw;
  font-size: 8vw;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: inset 0 0 2vw #0f0;
  transition: background-color 0.3s, transform 0.3s;
  position: relative;
  min-width: 0;
  min-height: 0;
}
  .slot.win {
    background-color: gold;
    color: black;
    box-shadow: 0 0 15px 5px gold;
    animation: winPulse 1s infinite alternate;
  }
  @keyframes winPulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.1); }
}
    .slot.big-win {
    animation: megaWinPulse 0.4s alternate infinite;
    background: linear-gradient(90deg, gold, orange, gold);
    color: black;
  }
  @keyframes megaWinPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.2); }
  }
 button {
  margin-top: 15px;
  padding: 2vw 4vw;
  font-size: 4vw;
  cursor: pointer;
  border-radius: 12px;
  border: none;
  background: #4caf50;
  color: white;
  box-shadow: 0 5px #388e3c;
  transition: background 0.3s;
}
    button:active {
    box-shadow: 0 2px #388e3c;
    transform: translateY(3px);
  }
  .controls {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }
  .message {
  margin-top: 20px;
  font-size: 4vw;
  min-height: 10vw;
  white-space: pre-line;
  color: #ff0;
  max-width: 98vw;
  text-align: center;
}
  .bank-jackpot {
  margin: 10px 0;
  font-size: 4vw;
}
    .balance-actions {
    margin: 12px 0;
  }
  .balance-actions input {
  width: 40vw;
  max-width: 140px;
  font-size: 4vw;
  padding: 2vw;
  border-radius: 8px;
  border: none;
  margin-right: 2vw;
  min-width: 0;
  box-sizing: border-box;
}
  #withdrawMsg {
    color: #ff0;
    min-height: 24px;
    font-size: 17px;
    margin-top: 6px;
    text-align: center;
  }
 #botChat {
  width: 98vw;
  max-width: 420px;
  max-height: 40vw;
  overflow-y: auto;
  background: #111;
  color: #0f0;
  font-family: monospace;
  font-size: 3.5vw;
  padding: 2vw;
  border-radius: 2vw;
  margin-top: 5vw;
  border: 1px solid #0f0;
}
    .bot-message {
    margin: 3px 0;
    padding: 2px;
    border-bottom: 1px dotted #0f03;
  }
.replenish-buttons {
  margin: 15px 0;
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}
.replenish-btn {
  padding: 10px 20px;
  font-size: 4vw;
  background: #e62117;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.replenish-btn:hover {
  background: #cc1f15;
}
  /* –ú–∏–Ω–∏-–∏–≥—Ä–∞ */
  .mini-game-overlay {
    position: fixed; /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å absolute */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0; /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å height: 100% */
    background: rgba(0,0,0,0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
    display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  }
  .mini-game-content {
  background: #232323;
  border-radius: 2vw;
  padding: 5vw 3vw 4vw 3vw;
  color: #fff;
  min-width: 60vw;
  box-shadow: 0 0 4vw #000;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.box {
  width: 20vw;
  max-width: 100px;
  height: 20vw;
  max-height: 100px;
  background: #000;
  border-radius: 2vw;
  font-size: 10vw;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: inset 0 0 2vw #0f0;
  transition: background-color 0.3s, transform 0.3s;
  position: relative;
  cursor: pointer;
}
   .box.selected {
    background-color: #4caf50;
    color: white;
  }
  .box.win {
    background-color: green;
    color: white;
  }
  .box.lose {
    background-color: red;
    color: white;
  }
  .mini-game-msg {
    font-size: 18px;
    margin-bottom: 10px;
  }
  .close-btn {
    font-size: 18px;
    padding: 10px 20px;
    border-radius: 5px;
    background-color: #ff4500;
    color: white;
    cursor: pointer;
    border: none;
  }
  @media (max-width: 600px) {
  .slot-machine {
    grid-template-columns: repeat(5, 16vw);
    grid-template-rows: repeat(4, 10vw);
    padding: 2vw 1vw;
  }
  .slot {
    font-size: 7vw;
  }
  #botChat, .mini-game-content {
    width: 96vw;
    max-width: 100vw;
    font-size: 3.5vw;
  }
  .box {
    width: 25vw;
    height: 25vw;
    font-size: 12vw;
  }
  .message {
    max-width: 98vw;
    font-size: 4vw;
  }
  .info-bar > div {
    font-size: 4vw;
  }
  .bank-jackpot {
    font-size: 4vw;
  }
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–º–µ–Ω–∏ */
.modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
    box-sizing: border-box;
}
.modal {
    background: #333;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: white;
    min-width: 300px;
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 40px);
    box-sizing: border-box;
}
.modal input {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    width: 200px;
}
.modal button {
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px;
}
/* --- –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –í–´–í–û–î–ê –ò –ü–†–ê–í–ò–õ --- */
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ */
.withdraw-modal {
    background: #333;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: white;
    min-width: 300px;
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 40px);
    box-sizing: border-box;
}
.withdraw-modal input {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    width: 200px;
}
.withdraw-modal button {
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px;
}
.withdraw-modal button.cancel {
    background: #f44336;
}
.withdraw-error {
    color: #ff4444;
    margin-top: 10px;
    font-size: 14px;
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª */
.rules-modal {
    background: #333;
    padding: 20px;
    border-radius: 10px;
    color: white;
    min-width: 300px;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-sizing: border-box;
    text-align: left;
}
.rules-modal h3 {
    text-align: center;
    color: #4caf50;
}
.rules-modal h4 {
    color: #4caf50;
    margin-top: 20px;
}
.rules-modal ul {
    padding-left: 20px;
}
.rules-modal li {
    margin-bottom: 5px;
}
.rules-modal .premium-symbols {
    background: #222;
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    font-size: 14px;
}
/* --- –ö–û–ù–ï–¶ –ù–û–í–´–• –°–¢–ò–õ–ï–ô --- */
</style>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ (—É–∂–µ –±—ã–ª–æ) -->
<div id="usernameModal" class="modal-bg" style="display:none;">
  <div class="modal">
    <div>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –∏–≥—Ä—ã:</div>
    <input id="usernameInput" maxlength="32" autocomplete="off">
    <button id="usernameOkBtn">OK</button>
  </div>
</div>

<!-- --- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ --- -->
<div id="withdrawModal" class="modal-bg" style="display:none;">
  <div class="withdraw-modal">
    <h3>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
    <div>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä):</div>
    <input id="cardNumberInput" maxlength="19" placeholder="1234 5678 9012 3456" autocomplete="off">
    <div>–°—É–º–º–∞ –∫ –≤—ã–≤–æ–¥—É: <span id="withdrawAmount">0.00</span> ‚ÇΩ</div>
    <div style="margin-top: 15px;">
      <button id="confirmWithdrawBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      <button id="cancelWithdrawBtn" class="cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>
    <div id="withdrawError" class="withdraw-error"></div>
  </div>
</div>
<!-- --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ --- -->

<!-- --- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ü—Ä–∞–≤–∏–ª–∞ --- -->
<div id="rulesModal" class="modal-bg" style="display:none;">
  <div class="rules-modal">
    <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã BingoBett</h3>
    
    <h4>üé∞ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</h4>
    <ul>
      <li>–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ: 5 –±–∞—Ä–∞–±–∞–Ω–æ–≤ √ó 4 —Ä—è–¥–∞ (20 —Å–∏–º–≤–æ–ª–æ–≤)</li>
      <li>–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç–∞–≤–æ–∫: –æ—Ç 10 –¥–æ 80 —Ä—É–±–ª–µ–π</li>
      <li>–í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –ª–∏–Ω–∏–∏: —Ç–æ–ª—å–∫–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ (4 –ª–∏–Ω–∏–∏)</li>
      <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞ –ø–æ–¥—Ä—è–¥ —Å–ª–µ–≤–∞</li>
      <li>–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 100 —Ä—É–±–ª–µ–π</li>
    </ul>
    
    <h4>üí∞ –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç (–º–Ω–æ–∂–∏—Ç–µ–ª—å √ó —Å—Ç–∞–≤–∫–∞):</h4>
    <div class="premium-symbols">
      <div><strong>–û–±—ã—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:</strong></div>
      üçíüçãüçäüçâüçá: 3√ó5, 4√ó10, 5√ó20<br>
      üçìüçç: 3√ó7, 4√ó14, 5√ó28<br>
      ü•ùüçå: 3√ó10, 4√ó20, 5√ó40<br>
      ü••: 3√ó12, 4√ó24, 5√ó48<br>
      <div style="margin-top: 10px;"><strong>–ü—Ä–µ–º–∏—É–º —Å–∏–º–≤–æ–ª—ã:</strong></div>
      üéÅ: 3√ó15, 4√ó30, 5√ó60<br>
      üíé: 3√ó20, 4√ó40, 5√ó80<br>
      ‚≠ê: 3√ó25, 4√ó50, 5√ó100<br>
      üÉè: 3√ó30, 4√ó60, 5√ó120<br>
      üëë: 3√ó50, 4√ó100, 5√ó200<br>
      üí∞: 3√ó100, 4√ó200, 5√ó500
    </div>
    
    <h4>üéÅ –§—Ä–∏—Å–ø–∏–Ω—ã:</h4>
    <ul>
      <li>–ù–æ–≤—ã–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç 55 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π</li>
      <li>–§—Ä–∏—Å–ø–∏–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
      <li>–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ —Å—Ç–∞–≤–∫–∞ –ù–ï —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞</li>
      <li>–í—ã–∏–≥—Ä—ã—à–∏ —Å —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å</li>
    </ul>
    
    <h4>üí≥ –£—Å–ª–æ–≤–∏—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤:</h4>
    <ul>
      <li><strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—ã–≤–æ–¥–∞: 40,001 —Ä—É–±–ª—å</strong></li>
      <li>–í—ã–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—É–º–º–∞ —Å–≤—ã—à–µ 40,000 —Ä—É–±–ª–µ–π</li>
      <li>40,000 —Ä—É–±–ª–µ–π –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ</li>
      <li>–í—ã–≤–æ–¥ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É (16 —Ü–∏—Ñ—Ä)</li>
      <li>–í—Ä–µ–º—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è: –¥–æ 24 —á–∞—Å–æ–≤</li>
    </ul>
    
    <div style="margin-top: 20px; text-align: center;">
      <button id="closeRulesBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>
<!-- --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê: –ü—Ä–∞–≤–∏–ª–∞ --- -->

<h1>BingoBett</h1> <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ -->
<div class="info-bar">
  <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="username"></span></div>
  <div>–ë–∞–ª–∞–Ω—Å: <span id="balanceDisplay">100 ‚ÇΩ</span></div>
  <div>–°—Ç–∞–≤–∫–∞: <button id="betMinus">-</button> <span id="betAmount">10</span> ‚ÇΩ <button id="betPlus">+</button></div>
</div>
<div id="freeSpinsDisplay">–§—Ä–∏—Å–ø–∏–Ω—ã: 55</div>
<div id="withdrawMsg"></div>
<div class="bank-jackpot">
  –î–∂–µ–∫–ø–æ—Ç: <span id="jackpotDisplay">2 200 453 ‚ÇΩ</span>
</div>
<div class="replenish-buttons">
  <button class="replenish-btn" data-amount="50">50 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="300">300 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="500">500 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="800">800 ‚ÇΩ</button>
  <a id="replenishLink" href="#" target="_blank" style="display: none;">–û–ø–ª–∞—Ç–∏—Ç—å</a>
</div>
  <div class="slot-machine" id="slotMachine"></div>
<div class="controls">
  <button id="spinButton">–í—Ä–∞—â–∞—Ç—å üé∞</button>
  <button id="autoSpinButton">–ê–≤—Ç–æ—Å–ø–∏–Ω ‚ñ∂Ô∏è</button>
  <button id="stopAutoSpinButton" style="display:none;">–°—Ç–æ–ø –∞–≤—Ç–æ—Å–ø–∏–Ω ‚èπ</button>
  <!-- --- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê: –ü—Ä–∞–≤–∏–ª–∞ --- -->
  <button id="rulesButton">–ü—Ä–∞–≤–∏–ª–∞ üìã</button>
  <!-- --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –ö–ù–û–ü–ö–ò: –ü—Ä–∞–≤–∏–ª–∞ --- -->
</div>
<div class="message" id="message"></div>
<div id="botChat">
  <b>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏:</b><br>
</div>
<!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ -->
<div class="mini-game-overlay" id="miniGameOverlay">
  <div class="mini-game-content">
    <h2>–ú–∏–Ω–∏-–∏–≥—Ä–∞: –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!</h2>
    <div class="boxes">
      <div class="box" data-box="1">üéÅ</div>
      <div class="box" data-box="2">üéÅ</div>
      <div class="box" data-box="3">üéÅ</div>
    </div>
    <div class="mini-game-msg" id="miniGameMsg"></div>
    <button class="close-btn" id="closeMiniGame">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
<script>
(function() { // –ò—Å–ø–æ–ª—å–∑—É–µ–º IIFE –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
  'use strict';

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK ---
  let tgUser = null;
  let isTelegramReady = false;

  function initTelegram() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º window.Telegram, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ Telegram
    if (typeof window !== 'undefined' && window.Telegram && window.Telegram.WebApp) {
      try {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        if (window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
          tgUser = window.Telegram.WebApp.initDataUnsafe.user;
        }
        isTelegramReady = true;
        console.log("Telegram WebApp SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.");
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp SDK:", e);
      }
    } else {
      console.warn("Telegram WebApp SDK –Ω–µ –Ω–∞–π–¥–µ–Ω. –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.");
    }
  }

  // --- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ---
  let username = localStorage.getItem('slotUsername') || '';

  function setUsername(name) {
    username = name;
    localStorage.setItem('slotUsername', name);
    const usernameElement = document.getElementById('username');
    if (usernameElement) {
        usernameElement.textContent = name;
    }
  }

  // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–∏—Å–ø–∏–Ω–∞–º–∏ ---
  function initializeFreeSpins() {
    const registrationTimestamp = localStorage.getItem('registrationTimestamp');
    if (!registrationTimestamp) {
      localStorage.setItem('freeSpins', '55');
      localStorage.setItem('registrationTimestamp', Date.now().toString());
    }
  }

  function isFreeSpinsExpired() {
    const registrationTime = Number(localStorage.getItem('registrationTimestamp'));
    const currentTime = Date.now();
    const twentyFourHours = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    return (currentTime - registrationTime) > twentyFourHours;
  }

  function getFreeSpins() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
    if (isFreeSpinsExpired()) {
        localStorage.setItem('freeSpins', '0');
    }
    return parseInt(localStorage.getItem('freeSpins') || '0');
  }

  function useFreeSpin() {
    let currentSpins = getFreeSpins();
    if (currentSpins > 0) {
      currentSpins -= 1;
      localStorage.setItem('freeSpins', currentSpins.toString());
      updateFreeSpinsDisplay();
      return true;
    }
    return false;
  }

  function updateFreeSpinsDisplay() {
    const freeSpins = getFreeSpins();
    const displayElement = document.getElementById('freeSpinsDisplay');
    if (displayElement) {
        displayElement.textContent = `–§—Ä–∏—Å–ø–∏–Ω—ã: ${freeSpins}`;
    }
  }


  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
  function initializeUser() {
    initializeFreeSpins(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ—Ä–∏—Å–ø–∏–Ω—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

    // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram user ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∏–º—è
    if (tgUser && tgUser.first_name) {
      setUsername(tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : ""));
    } else if (!username) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
      const usernameModal = document.getElementById('usernameModal');
      const usernameInput = document.getElementById('usernameInput');
      const usernameOkBtn = document.getElementById('usernameOkBtn');

      if (usernameModal && usernameInput && usernameOkBtn) {
        usernameModal.style.display = 'flex'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
        usernameInput.focus();
        usernameOkBtn.onclick = function() {
          let val = usernameInput.value.trim();
          if (val.length > 0) {
            setUsername(val);
            usernameModal.style.display = 'none';
          }
        };
        usernameInput.onkeydown = function(e) {
          if (e.key === "Enter" && usernameOkBtn) usernameOkBtn.click();
        };
      }
    } else {
      setUsername(username);
    }
    updateFreeSpinsDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º–µ–Ω–∏
  }


  // --- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ ---
  function initializeReplenishment() {
    document.querySelectorAll('.replenish-btn').forEach(btn => {
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏
        const clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        
        clone.onclick = function () {
            const amount = this.dataset.amount;
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –ÆMoney
            const receiver = '4100118182998706';
            // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –æ–ø–ª–∞—Ç—ã
            const paymentUrl = `https://yoomoney.ru/quickpay/confirm.xml?receiver=${receiver}&quickpay-form=shop&targets=–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ BingoBett ${amount}‚ÇΩ&paymentType=PC&sum=${amount}&label=${Date.now()}`;

            if (isTelegramReady) {
                // –í Telegram Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ SDK
                window.Telegram.WebApp.openLink(paymentUrl);
            } else {
                // –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                window.open(paymentUrl, '_blank');
            }

            // –≠–º—É–ª—è—Ü–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –ÆMoney
            setTimeout(() => {
                balance += parseFloat(amount);
                updateUI();
                showMessage(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚ÇΩ (—ç–º—É–ª—è—Ü–∏—è)`);
            }, 5000);
        };
    });
  }


  // --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã ---
  const COLUMNS = 5;
  const ROWS = 4;
  const MIN_BET = 10;
  const MAX_BET = 80;
  const REELS = [
    ["üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçã","üçä","üçâ","üçá","üçì","ü••","‚≠ê","üÉè","üëë"],
    ["üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
    ["üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè","üí∞"],
    ["üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
    ["üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"]
  ];
  const PAYTABLE = {
    "üçí": {3:5, 4:10, 5:20},
    "üçã": {3:5, 4:10, 5:20},
    "üçä": {3:5, 4:10, 5:20},
    "üçâ": {3:5, 4:10, 5:20},
    "üçá": {3:5, 4:10, 5:20},
    "üçì": {3:7, 4:14, 5:28},
    "üçç": {3:7, 4:14, 5:28},
    "ü•ù": {3:10, 4:20, 5:40},
    "üçå": {3:10, 4:20, 5:40},
    "ü••": {3:12, 4:24, 5:48},
    "üéÅ": {3:15, 4:30, 5:60},
    "üíé": {3:20, 4:40, 5:80},
    "‚≠ê": {3:25, 4:50, 5:100},
    "üÉè": {3:30, 4:60, 5:120},
    "üëë": {3:50, 4:100, 5:200},
    "üí∞": {3:100, 4:200, 5:500}
  };

  // --- –°–æ—Å—Ç–æ—è–Ω–∏—è ---
  let balance = parseFloat(localStorage.getItem('slotBalance')) || 100;
  let betAmount = parseInt(localStorage.getItem('slotBet')) || MIN_BET;
  let jackpot = parseFloat(localStorage.getItem('slotJackpot')) || 2200453;
  let autoSpinActive = false;
  let autoSpinTimer = null;
  let slotElements = [];

  // --- DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
  const slotMachine = document.getElementById('slotMachine');
  const messageElement = document.getElementById('message');
  const miniGameOverlay = document.getElementById('miniGameOverlay');

  // --- –§—É–Ω–∫—Ü–∏–∏ UI ---
  function formatJackpot(n) {
    return new Intl.NumberFormat('ru-RU').format(n) + " ‚ÇΩ";
  }

  function updateUI() {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
    const balanceDisplay = document.getElementById('balanceDisplay');
    if (balanceDisplay) balanceDisplay.textContent = `${balance.toFixed(2)} ‚ÇΩ`;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
    const betAmountSpan = document.getElementById('betAmount');
    if (betAmountSpan) betAmountSpan.textContent = betAmount;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∂–µ–∫–ø–æ—Ç–∞
    const jackpotDisplay = document.getElementById('jackpotDisplay');
    if (jackpotDisplay) jackpotDisplay.textContent = formatJackpot(jackpot);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
    localStorage.setItem('slotBalance', balance);
    localStorage.setItem('slotBet', betAmount);
    localStorage.setItem('slotJackpot', jackpot);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–í—Ä–∞—â–∞—Ç—å"
    const spinButton = document.getElementById('spinButton');
    if (spinButton) spinButton.disabled = (balance < betAmount) && (getFreeSpins() === 0);
  }

  function showMessage(text) {
    if (messageElement) {
        messageElement.textContent = text;
        // –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–æ –ª–∏ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (messageElement.textContent === text) {
                messageElement.textContent = '';
            }
        }, 5000);
    }
  }

  // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
  function createSlots() {
    if (!slotMachine) {
        console.error("–≠–ª–µ–º–µ–Ω—Ç slotMachine –Ω–µ –Ω–∞–π–¥–µ–Ω");
        return;
    }
    slotMachine.innerHTML = '';
    slotElements = [];
    for(let row=0; row<ROWS; row++){
      for(let col=0; col<COLUMNS; col++){
        const slot = document.createElement('div');
        slot.classList.add('slot');
        slot.textContent = "üçí"; // –ù–∞—á–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
        slotMachine.appendChild(slot);
        slotElements.push(slot);
      }
    }
  }

  function getSymbolFromReel(reel, position) {
    // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –ø–æ—Ö–æ–∂–µ, –∏–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    // —Ä–µ–¥–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –Ω–æ –ª–æ–≥–∏–∫–∞ –±—ã–ª–∞ —Å–ª–æ–∂–Ω–æ–π. –û—Å—Ç–∞–≤–∏–º –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é.
    return reel[position % reel.length];
  }

  function secureRandomInt(max){
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Math.random –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –≤ production –ª—É—á—à–µ crypto
    return Math.floor(Math.random() * max);
  }

  async function spin() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –º–∞—à–∏–Ω–∞ –≤—Ä–∞—â–µ–Ω–∏–µ–º
    const spinButton = document.getElementById('spinButton');
    const autoSpinButton = document.getElementById('autoSpinButton');
    if (!spinButton || spinButton.disabled) return;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—Ä–∞—â–µ–Ω–∏—è
    const hasFreespins = getFreeSpins() > 0;
    if (balance < betAmount && !hasFreespins) {
        showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è!");
        stopAutoSpin(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ—Å–ø–∏–Ω, –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤
        return;
    }

    // --- –õ–æ–≥–∏–∫–∞ —Å—Ç–∞–≤–∫–∏ –∏ –¥–∂–µ–∫–ø–æ—Ç–∞ ---
    let isUsingFreeSpin = false;
    if (hasFreespins) {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—Ä–∏—Å–ø–∏–Ω, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        isUsingFreeSpin = useFreeSpin(); // –≠—Ç–æ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç display
        if (isUsingFreeSpin) {
            showMessage('üéÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–∏—Å–ø–∏–Ω!');
        }
    }

    if (!isUsingFreeSpin) {
        // –°–Ω–∏–º–∞–µ–º –æ–±—ã—á–Ω—É—é —Å—Ç–∞–≤–∫—É
        let jackpotPart = betAmount * 0.1; // 10% –∏–¥–µ—Ç –≤ –¥–∂–µ–∫–ø–æ—Ç
        jackpot += jackpotPart;
        balance -= betAmount;
        updateUI(); // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ —Å–Ω—è—Ç–∏—è —Å—Ç–∞–≤–∫–∏
    } else {
        // –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ—Ä–∏—Å–ø–∏–Ω–∞ —á–∞—Å—Ç—å —Å—Ç–∞–≤–∫–∏ —Ç–æ–∂–µ –∏–¥–µ—Ç –≤ –¥–∂–µ–∫–ø–æ—Ç
        let jackpotPart = betAmount * 0.1;
        jackpot += jackpotPart;
        updateUI(); // –û–±–Ω–æ–≤–ª—è–µ–º UI —Ç–æ–ª—å–∫–æ –¥–∂–µ–∫–ø–æ—Ç
    }

    // --- –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è ---
    if (messageElement) messageElement.textContent = "–í—Ä–∞—â–∞–µ–º...";

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
    let stopPositions = [];
    for(let col=0; col<COLUMNS; col++){
      stopPositions[col] = secureRandomInt(REELS[col].length);
    }

    // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–∏–≥—Ä—ã—à–∏
    slotElements.forEach(slot => slot.classList.remove('win', 'big-win'));

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤
    slotElements.forEach((slot, index) => {
        slot.classList.add('spinning');
        const row = Math.floor(index / COLUMNS);
        const col = index % COLUMNS;
        const reel = REELS[col];

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–∏–º–≤–æ–ª–æ–≤
        const symbolDiv = document.createElement('div');
        symbolDiv.className = 'symbol';
        slot.innerHTML = '';
        slot.appendChild(symbolDiv);

        // –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Å–∏–º–≤–æ–ª–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è
        const symbolInterval = setInterval(() => {
            const randomSymbol = reel[secureRandomInt(reel.length)];
            symbolDiv.textContent = randomSymbol;
        }, 100); // –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–æ–∂–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
        slot.dataset.symbolInterval = symbolInterval;
    });

    // –ü–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞—Ä–∞–±–∞–Ω–æ–≤ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ) —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
    for (let col = 0; col < COLUMNS; col++) {
        // –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
        if (col > 0) { // –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–≤–æ–≥–æ
            await new Promise(resolve => setTimeout(resolve, 800)); // –ó–∞–¥–µ—Ä–∂–∫–∞ 800–º—Å
        }

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–æ—Ç—ã –≤ —Ç–µ–∫—É—â–µ–º –±–∞—Ä–∞–±–∞–Ω–µ (–∫–æ–ª–æ–Ω–∫–µ)
        for (let row = 0; row < ROWS; row++) {
            const index = row * COLUMNS + col;
            const slot = slotElements[index];
            const reel = REELS[col];

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            if (slot.dataset.symbolInterval) {
                clearInterval(slot.dataset.symbolInterval);
            }
            slot.classList.remove('spinning');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
            const finalSymbol = getSymbolFromReel(reel, stopPositions[col] + row);
            slot.innerHTML = finalSymbol;
        }
    }

    // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π ---
    await new Promise(resolve => setTimeout(resolve, 300)); // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    checkResults();
  }

  function checkResults(){
    let totalWin = 0;
    let winMessages = [];
    const winningSlots = []; // –î–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–∏–≥—Ä–∞–≤—à–∏—Ö —Å–ª–æ—Ç–æ–≤

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ (4 –ª–∏–Ω–∏–∏)
    for (let row = 0; row < ROWS; row++) {
        let lineSymbols = [];
        let lineIndices = [];
        for (let col = 0; col < COLUMNS; col++) {
            const index = row * COLUMNS + col;
            lineSymbols.push(slotElements[index].textContent);
            lineIndices.push(index);
        }

        let firstSymbol = lineSymbols[0];
        let count = 1;
        // –°—á–∏—Ç–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ
        for (let i = 1; i < lineSymbols.length; i++) {
            if (lineSymbols[i] === firstSymbol) {
                count++;
            } else {
                break;
            }
        }

        if (count >= 3 && PAYTABLE[firstSymbol]) {
            let win = PAYTABLE[firstSymbol][count] * betAmount;
            totalWin += win;
            winMessages.push(`–õ–∏–Ω–∏—è ${row + 1}: ${firstSymbol} x${count} = +${win} ‚ÇΩ`);
            
            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤—ã–∏–≥—Ä–∞–≤—à–∏—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            for (let i = 0; i < count; i++) {
                winningSlots.push(lineIndices[i]);
            }
        }
    }

    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä–∞–≤—à–∏–µ —Å–ª–æ—Ç—ã
    winningSlots.forEach(index => {
        const slot = slotElements[index];
        if (slot) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤—ã–∏–≥—Ä—ã—à–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const symbol = slot.textContent;
            if (totalWin >= betAmount * 10) { // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –≤—ã–∏–≥—Ä—ã—à–∞, –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å
                slot.classList.add('big-win');
            } else {
                slot.classList.add('win');
            }
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞
    if (totalWin > 0) {
      balance += totalWin;
      // –î–∂–µ–∫–ø–æ—Ç –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –∏–≥—Ä—ã, –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ

      if (totalWin >= betAmount * 50) { // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –º–µ–≥–∞-–≤—ã–∏–≥—Ä—ã—à–∞
        showMessage(`üéâ –ú–ï–ì–ê –í–´–ò–ì–†–´–®! +${totalWin.toFixed(2)} ‚ÇΩ`);
      } else {
        showMessage(`üí∞ –í—ã–∏–≥—Ä—ã—à: +${totalWin.toFixed(2)} ‚ÇΩ`);
      }

      // –ó–∞–ø—É—Å–∫ –º–∏–Ω–∏-–∏–≥—Ä—ã —Å –Ω–µ–±–æ–ª—å—à–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –∏–ª–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –≤—ã–∏–≥—Ä—ã—à–µ
      if (Math.random() < 0.05 || totalWin >= betAmount * 25) {
        setTimeout(() => startMiniGame(totalWin), 2000);
      }

    } else {
      showMessage("–ù–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë!");
    }

    updateUI();
  }


  // --- –ú–∏–Ω–∏-–∏–≥—Ä–∞ ---
  function startMiniGame(winAmount) {
    const overlay = document.getElementById('miniGameOverlay');
    const boxes = overlay ? overlay.querySelectorAll('.box') : [];
    const msg = document.getElementById('miniGameMsg');
    const closeBtn = document.getElementById('closeMiniGame');

    if (!overlay || boxes.length === 0 || !msg || !closeBtn) {
        console.warn("–≠–ª–µ–º–µ–Ω—Ç—ã –º–∏–Ω–∏-–∏–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
        return;
    }

    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ—Ä–æ–±–æ–∫
    boxes.forEach(box => {
        box.classList.remove('selected', 'win', 'lose');
        box.onclick = null;
    });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏
    const winBoxIndex = Math.floor(Math.random() * boxes.length); // 0, 1 –∏–ª–∏ 2
    let isPicked = false;

    msg.textContent = `–í—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(2)} ‚ÇΩ. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!`;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    overlay.style.display = 'flex';

    // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
    boxes.forEach((box, index) => {
        box.onclick = () => {
            if (isPicked) return; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–±–æ—Ä
            isPicked = true;

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –≤—Å–µ—Ö –∫–æ—Ä–æ–±–∫–∞—Ö
            boxes.forEach(b => b.onclick = null);

            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞
            box.classList.add('selected');

            setTimeout(() => {
                if (index === winBoxIndex) {
                    // –í—ã–∏–≥—Ä—ã—à
                    box.classList.add('win');
                    const bonusWin = winAmount; // –ë–æ–Ω—É—Å —Ä–∞–≤–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤—ã–∏–≥—Ä—ã—à—É
                    balance += bonusWin;
                    msg.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! +${bonusWin.toFixed(2)} ‚ÇΩ`;
                    showMessage(`–ú–∏–Ω–∏-–∏–≥—Ä–∞: +${bonusWin.toFixed(2)} ‚ÇΩ`);
                } else {
                    // –ü—Ä–æ–∏–≥—Ä—ã—à
                    box.classList.add('lose');
                    // –ú–æ–∂–Ω–æ —Å–Ω—è—Ç—å —á–∞—Å—Ç—å –≤—ã–∏–≥—Ä—ã—à–∞, –Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –ø–æ—Ö–æ–∂–µ, –Ω–∏—á–µ–≥–æ –Ω–µ —Å–Ω–∏–º–∞–ª–æ—Å—å
                    msg.textContent = `–ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!`;
                }
                updateUI();
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                closeBtn.style.display = 'block';
            }, 800); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        };
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
    const newCloseBtn = closeBtn.cloneNode(true);
    closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
    newCloseBtn.onclick = () => {
        if (overlay) overlay.style.display = 'none';
        // –ï—Å–ª–∏ –∞–≤—Ç–æ—Å–ø–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
        if (autoSpinActive) {
             // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è
             setTimeout(() => {
                 if(autoSpinActive && !document.getElementById('spinButton').disabled) {
                     spin();
                 }
             }, 500);
         }
    };
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ –≤—ã–±–æ—Ä–∞
    newCloseBtn.style.display = 'none';
  }


  // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–æ–π ---
  function initializeBetControls() {
    const betMinus = document.getElementById('betMinus');
    const betPlus = document.getElementById('betPlus');

    if (betMinus) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const newBetMinus = betMinus.cloneNode(true);
        betMinus.parentNode.replaceChild(newBetMinus, betMinus);
        newBetMinus.onclick = () => {
            if (betAmount > MIN_BET) {
                betAmount -= 10;
                updateUI();
            }
        };
    }

    if (betPlus) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const newBetPlus = betPlus.cloneNode(true);
        betPlus.parentNode.replaceChild(newBetPlus, betPlus);
        newBetPlus.onclick = () => {
            if (betAmount < MAX_BET) {
                betAmount += 10;
                updateUI();
            }
        };
    }
  }

  // --- –ê–≤—Ç–æ—Å–ø–∏–Ω ---
  function startAutoSpin() {
    if (autoSpinActive) return;
    autoSpinActive = true;
    
    const autoSpinButton = document.getElementById('autoSpinButton');
    const stopAutoSpinButton = document.getElementById('stopAutoSpinButton');
    
    if (autoSpinButton) autoSpinButton.style.display = 'none';
    if (stopAutoSpinButton) stopAutoSpinButton.style.display = 'inline-block';

    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ
    spin();

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –≤—Ä–∞—â–µ–Ω–∏–π
    autoSpinTimer = setInterval(() => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –º–∞—à–∏–Ω–∞ –≤—Ä–∞—â–µ–Ω–∏–µ–º –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
        // –∏ –µ—Å—Ç—å –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–ª–∏ —Ñ—Ä–∏—Å–ø–∏–Ω—ã
        const spinButton = document.getElementById('spinButton');
        if (spinButton && !spinButton.disabled) {
            spin();
        } else if (spinButton && spinButton.disabled) {
            // –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∏ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ—Å–ø–∏–Ω
            stopAutoSpin();
            showMessage('–ê–≤—Ç–æ—Å–ø–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤.');
        }
    }, 3000); // –í—Ä–∞—â–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
  }

  function stopAutoSpin() {
    autoSpinActive = false;
    if (autoSpinTimer) {
        clearInterval(autoSpinTimer);
        autoSpinTimer = null;
    }
    
    const autoSpinButton = document.getElementById('autoSpinButton');
    const stopAutoSpinButton = document.getElementById('stopAutoSpinButton');
    
    if (autoSpinButton) autoSpinButton.style.display = 'inline-block';
    if (stopAutoSpinButton) stopAutoSpinButton.style.display = 'none';
  }

  // --- –ë–æ—Ç-—á–∞—Ç ---
  function initializeBotChat() {
    const botChat = document.getElementById('botChat');
    if (!botChat) return;

    const botNames = [
        "–ê—Ä—Ç—ë–º", "–ò—Ä–∏–Ω–∞", "–ú–∞–∫—Å–∏–º", "–û–ª—å–≥–∞", "–í–ª–∞–¥–∏–º–∏—Ä", "–°–≤–µ—Ç–ª–∞–Ω–∞", "–î–µ–Ω–∏—Å", "–ú–∞—Ä–∏—è", "–ê–ª–µ–∫—Å–µ–π", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",
        "–ü–∞–≤–µ–ª", "–¢–∞—Ç—å—è–Ω–∞", "–†–æ–º–∞–Ω", "–ê–Ω–∞—Å—Ç–∞—Å–∏—è", "–ò–≥–æ—Ä—å", "–ï–ª–µ–Ω–∞", "–î–º–∏—Ç—Ä–∏–π", "–ê–Ω–Ω–∞", "–ö–∏—Ä–∏–ª–ª", "–Æ–ª–∏—è",
        "–°–µ—Ä–≥–µ–π", "–ú–∞—Ä–∏–Ω–∞", "–ú–∏—Ö–∞–∏–ª", "–ê–ª–∏—Å–∞", "–ï–≤–≥–µ–Ω–∏–π", "–í–∏–∫—Ç–æ—Ä–∏—è", "–ì–ª–µ–±", "–í–µ—Ä–∞", "–ì—Ä–∏–≥–æ—Ä–∏–π", "–ü–æ–ª–∏–Ω–∞"
    ];
    const botMessages = [
        "–≤—ã–∏–≥—Ä–∞–ª(–∞) 120 ‚ÇΩ!", "–ø–æ–π–º–∞–ª(–∞) –±–æ–Ω—É—Å!", "—Å–æ—Ä–≤–∞–ª(–∞) –¥–∂–µ–∫–ø–æ—Ç!", "–ø—Ä–æ–∏–≥—Ä–∞–ª(–∞) 40 ‚ÇΩ", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 300 ‚ÇΩ!",
        "–ø–æ–ø—Ä–æ–±–æ–≤–∞–ª(–∞) –∞–≤—Ç–æ—Å–ø–∏–Ω", "–ø–æ–ª—É—á–∏–ª(–∞) –º–∏–Ω–∏-–∏–≥—Ä—É", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 70 ‚ÇΩ", "—Å–æ—Ä–≤–∞–ª(–∞) –±–∞–Ω–∫!", "–ø—Ä–æ–∏–≥—Ä–∞–ª(–∞) 20 ‚ÇΩ",
        "–≤—ã–∏–≥—Ä–∞–ª(–∞) 500 ‚ÇΩ!", "–ø–æ–ª—É—á–∏–ª(–∞) —Ñ—Ä–∏—Å–ø–∏–Ω—ã", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 80 ‚ÇΩ", "—Å–æ—Ä–≤–∞–ª(–∞) —Å—É–ø–µ—Ä-–≤—ã–∏–≥—Ä—ã—à!", "–ø—Ä–æ–∏–≥—Ä–∞–ª(–∞) 60 ‚ÇΩ",
        "–≤—ã–∏–≥—Ä–∞–ª(–∞) 250 ‚ÇΩ!", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 90 ‚ÇΩ", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 150 ‚ÇΩ!", "–ø—Ä–æ–∏–≥—Ä–∞–ª(–∞) 10 ‚ÇΩ", "–≤—ã–∏–≥—Ä–∞–ª(–∞) 200 ‚ÇΩ!"
    ];

    function addBotMessage() {
        const name = botNames[Math.floor(Math.random() * botNames.length)];
        const msg = botMessages[Math.floor(Math.random() * botMessages.length)];
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
        const timeString = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

        const messageDiv = document.createElement('div');
        messageDiv.className = 'bot-message';
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –∏–º–µ–Ω–∏
        messageDiv.innerHTML = `<span style="color:#0ff">${timeString} - ${name}</span>: ${msg}`;

        botChat.appendChild(messageDiv);

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        while (botChat.children.length > 21) { // 1 –∑–∞–≥–æ–ª–æ–≤–æ–∫ + 20 —Å–æ–æ–±—â–µ–Ω–∏–π
            botChat.removeChild(botChat.children[1]); // –£–¥–∞–ª—è–µ–º –≤—Ç–æ—Ä–æ–µ (–ø–µ—Ä–≤–æ–µ - –∑–∞–≥–æ–ª–æ–≤–æ–∫)
        }

        botChat.scrollTop = botChat.scrollHeight;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É
    addBotMessage();

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    setInterval(() => {
        if (Math.random() < 0.3) { // 30% —à–∞–Ω—Å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
            addBotMessage();
        }
    }, 8000); // –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 8 —Å–µ–∫—É–Ω–¥ –≤ —Å—Ä–µ–¥–Ω–µ–º
  }

  // --- –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ ---
  function initializeWithdrawal() {
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawModal = document.getElementById('withdrawModal');
    const cardNumberInput = document.getElementById('cardNumberInput');
    const confirmWithdrawBtn = document.getElementById('confirmWithdrawBtn');
    const cancelWithdrawBtn = document.getElementById('cancelWithdrawBtn');
    const closeWithdrawBtn = document.getElementById('closeWithdrawBtn'); // –ï—Å–ª–∏ –±—ã –±—ã–ª–∞ –∫—Ä–µ—Å—Ç–∏–∫
    const withdrawError = document.getElementById('withdrawError');

    if (!withdrawBtn || !withdrawModal || !cardNumberInput || !confirmWithdrawBtn || !cancelWithdrawBtn || !withdrawError) {
        console.warn("–ù–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–≤–æ–¥–∞ –Ω–∞–π–¥–µ–Ω—ã.");
        return;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –≤–≤–æ–¥–µ
    cardNumberInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
      let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
      e.target.value = formattedValue;
    });

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    withdrawBtn.onclick = function() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã–≤–æ–¥–∞
        if (balance <= 40000) {
            const required = (40000.01 - balance).toFixed(2);
            showMessage(`‚ùå –í—ã–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!\n–ú–∏–Ω–∏–º—É–º –¥–ª—è –≤—ã–≤–æ–¥–∞: 40,001 ‚ÇΩ\n–í–∞—à –±–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} ‚ÇΩ\n–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${required} ‚ÇΩ`);
            const withdrawMsgElement = document.getElementById('withdrawMsg');
            if (withdrawMsgElement) {
                withdrawMsgElement.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞!</span>';
            }
            return;
        }

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É –∫ –≤—ã–≤–æ–¥—É
        const withdrawableAmount = balance - 40000;
        document.getElementById('withdrawAmount').textContent = withdrawableAmount.toFixed(2);

        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –∏ –æ—à–∏–±–∫–∏
        cardNumberInput.value = '';
        withdrawError.textContent = '';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        withdrawModal.style.display = 'flex';
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        setTimeout(() => cardNumberInput.focus(), 100);
    };

    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞
    confirmWithdrawBtn.onclick = function() {
        const cardNumber = cardNumberInput.value.replace(/\s/g, ''); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
        if (!/^\d{16}$/.test(cardNumber)) {
            withdrawError.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä)';
            return;
        }

        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è
        if (balance <= 40000) {
             withdrawError.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞';
             return;
        }

        const withdrawAmount = balance - 40000;
        // "–°–ø–∏—Å—ã–≤–∞–µ–º" —Å—Ä–µ–¥—Å—Ç–≤–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É)
        balance = 40000;
        updateUI();

        // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        withdrawModal.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        showMessage(`‚úÖ –ó–ê–Ø–í–ö–ê –ù–ê –í–´–í–û–î –ü–†–ò–ù–Ø–¢–ê!\n–°—É–º–º–∞: ${withdrawAmount.toFixed(2)} ‚ÇΩ\n–ö–∞—Ä—Ç–∞: **** **** **** ${cardNumber.slice(-4)}\n–°—Ä–æ–∫: –¥–æ 24 —á–∞—Å–æ–≤\n–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ: 40,000.00 ‚ÇΩ`);
        
        // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤—ã–≤–æ–¥–∞
        const withdrawMsgElement = document.getElementById('withdrawMsg');
        if (withdrawMsgElement) {
            withdrawMsgElement.innerHTML = '';
        }
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–º–µ–Ω–∞"
    cancelWithdrawBtn.onclick = function() {
        withdrawModal.style.display = 'none';
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    withdrawModal.onclick = function(event) {
        if (event.target === withdrawModal) {
            withdrawModal.style.display = 'none';
        }
    };
  }
  // --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –õ–û–ì–ò–ö–ò: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ ---


  // --- –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü—Ä–∞–≤–∏–ª–∞ ---
  function initializeRules() {
    const rulesButton = document.getElementById('rulesButton');
    const rulesModal = document.getElementById('rulesModal');
    const closeRulesBtn = document.getElementById('closeRulesBtn');

    if (!rulesButton || !rulesModal || !closeRulesBtn) {
        console.warn("–ù–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª –Ω–∞–π–¥–µ–Ω—ã.");
        return;
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª
    rulesButton.onclick = function() {
        rulesModal.style.display = 'flex';
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª –ø–æ –∫–Ω–æ–ø–∫–µ
    closeRulesBtn.onclick = function() {
        rulesModal.style.display = 'none';
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏
    rulesModal.onclick = function(event) {
        if (event.target === rulesModal) {
            rulesModal.style.display = 'none';
        }
    };
  }
  // --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –õ–û–ì–ò–ö–ò: –ü—Ä–∞–≤–∏–ª–∞ ---


  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã ---
  function initializeGame() {
    console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...");
    initTelegram(); // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram SDK
    initializeUser(); // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ñ—Ä–∏—Å–ø–∏–Ω—ã
    createSlots(); // 3. –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã
    updateUI(); // 4. –û–±–Ω–æ–≤–ª—è–µ–º UI
    initializeBetControls(); // 5. –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫
    initializeReplenishment(); // 6. –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    initializeBotChat(); // 7. –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç-—á–∞—Ç
    initializeWithdrawal(); // 8. –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞
    initializeRules(); // 9. –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª

    // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤—Ä–∞—â–µ–Ω–∏—è
    const spinButton = document.getElementById('spinButton');
    const autoSpinButton = document.getElementById('autoSpinButton');
    const stopAutoSpinButton = document.getElementById('stopAutoSpinButton');

    if (spinButton) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const newSpinButton = spinButton.cloneNode(true);
        spinButton.parentNode.replaceChild(newSpinButton, spinButton);
        newSpinButton.onclick = spin;
    }

    if (autoSpinButton) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const newAutoSpinButton = autoSpinButton.cloneNode(true);
        autoSpinButton.parentNode.replaceChild(newAutoSpinButton, autoSpinButton);
        newAutoSpinButton.onclick = startAutoSpin;
    }

    if (stopAutoSpinButton) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const newStopAutoSpinButton = stopAutoSpinButton.cloneNode(true);
        stopAutoSpinButton.parentNode.replaceChild(newStopAutoSpinButton, stopAutoSpinButton);
        newStopAutoSpinButton.onclick = stopAutoSpin;
    }

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    setTimeout(() => {
        showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username || '–ò–≥—Ä–æ–∫'}!`);
    }, 1000);

    console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
  }

  // --- –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ---
  // –î–æ–∂–∏–¥–∞–µ–º—Å—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Telegram Web App
  function waitForTelegramAndDOM() {
      if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
              console.log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram SDK...");
              // –î–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Telegram SDK
              setTimeout(initializeGame, 100);
          });
      } else {
          console.log("DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram SDK...");
          setTimeout(initializeGame, 100);
      }
  }

  // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–∂–∏–¥–∞–Ω–∏—è
  waitForTelegramAndDOM();

})(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º IIFE
</script>
</body>
</html>
