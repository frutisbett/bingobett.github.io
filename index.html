<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BingoBett</title>
<script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=GSSrfiSffx0kH7sW4myJ8MM6WVBQeRaifiOyZTd7q3V0DyBg9bNHwTh3v39YezmzSfAw3b2bnMIMZRYpp_-0BjA3ZCdhriSqo0D62TqJQ-Q" charset="UTF-8"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #444);
    color: #fff;
    margin: 0; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  .modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  .modal {
    background: #333;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: white;
  }
  .modal input {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    width: 200px;
  }
  .modal button {
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .info-bar {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;
    margin-bottom: 15px;
  }
  .info-bar > div {
    font-size: 18px;
  }
  .slot-machine {
    display: grid;
    grid-template-columns: repeat(5, 18vw);
    grid-template-rows: repeat(4, 12vw);
    gap: 2vw;
    background: #222;
    padding: 4vw 2vw;
    border-radius: 4vw;
    box-shadow: 0 0 4vw #0f0;
    max-width: 98vw;
    min-width: 320px;
  }
  .slot {
    background: #000;
    border-radius: 2vw;
    font-size: 8vw;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 0 2vw #0f0;
    transition: background-color 0.3s, transform 0.3s;
    position: relative;
    min-width: 0;
    min-height: 0;
  }
  .slot.win {
    background-color: gold;
    color: black;
    box-shadow: 0 0 15px 5px gold;
    animation: winPulse 1s infinite alternate;
  }
  @keyframes winPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.1); }
  }
  .slot.big-win {
    animation: megaWinPulse 0.4s alternate infinite;
    background: linear-gradient(90deg, gold, orange, gold);
    color: black;
  }
  @keyframes megaWinPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.2); }
  }
  button {
    margin-top: 15px;
    padding: 2vw 4vw;
    font-size: 4vw;
    cursor: pointer;
    border-radius: 12px;
    border: none;
    background: #4caf50;
    color: white;
    box-shadow: 0 5px #388e3c;
    transition: background 0.3s;
  }
  button:active {
    box-shadow: 0 2px #388e3c;
    transform: translateY(3px);
  }
  .controls {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }
  .message {
    margin-top: 20px;
    font-size: 4vw;
    min-height: 10vw;
    white-space: pre-line;
    color: #ff0;
    max-width: 98vw;
    text-align: center;
  }
  .bank-jackpot {
    margin: 10px 0;
    font-size: 4vw;
  }
  .balance-actions {
    margin: 12px 0;
  }
  .balance-actions input {
    width: 40vw;
    max-width: 140px;
    font-size: 4vw;
    padding: 2vw;
    border-radius: 8px;
    border: none;
    margin-right: 2vw;
    min-width: 0;
    box-sizing: border-box;
  }
  #withdrawMsg {
    color: #ff0;
    min-height: 24px;
    font-size: 17px;
    margin-top: 6px;
    text-align: center;
  }
  #botChat {
    width: 98vw;
    max-width: 420px;
    max-height: 40vw;
    overflow-y: auto;
    background: #111;
    color: #0f0;
    font-family: monospace;
    font-size: 3.5vw;
    padding: 2vw;
    border-radius: 2vw;
    margin-top: 5vw;
    border: 1px solid #0f0;
  }
  .bot-message {
    margin: 3px 0;
    padding: 2px;
    border-bottom: 1px dotted #0f03;
  }
  .replenish-buttons {
    margin: 15px 0;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .replenish-btn {
    padding: 10px 20px;
    font-size: 4vw;
    background: #e62117;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .replenish-btn:hover {
    background: #cc1f15;
  }
  /* –ú–∏–Ω–∏-–∏–≥—Ä–∞ */
  .mini-game-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  .mini-game-content {
    background: #232323;
    border-radius: 2vw;
    padding: 5vw 3vw 4vw 3vw;
    color: #fff;
    min-width: 60vw;
    box-shadow: 0 0 4vw #000;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .boxes {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }
  .box {
    width: 20vw;
    max-width: 100px;
    height: 20vw;
    max-height: 100px;
    background: #000;
    border-radius: 2vw;
    font-size: 10vw;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 0 2vw #0f0;
    transition: background-color 0.3s, transform 0.3s;
    position: relative;
    cursor: pointer;
  }
  .box.selected {
    background-color: #4caf50;
    color: white;
  }
  .box.win {
    background-color: green;
    color: white;
  }
  .box.lose {
    background-color: red;
    color: white;
  }
  .mini-game-msg {
    font-size: 18px;
    margin-bottom: 10px;
  }
  .close-btn {
    font-size: 18px;
    padding: 10px 20px;
    border-radius: 5px;
    background-color: #ff4500;
    color: white;
    cursor: pointer;
    border: none;
  }
  @media (max-width: 600px) {
    .slot-machine {
      grid-template-columns: repeat(5, 16vw);
      grid-template-rows: repeat(4, 10vw);
      padding: 2vw 1vw;
    }
    .slot {
      font-size: 7vw;
    }
    #botChat, .mini-game-content {
      width: 96vw;
      max-width: 100vw;
      font-size: 3.5vw;
    }
    .box {
      width: 25vw;
      height: 25vw;
      font-size: 12vw;
    }
    .message {
      max-width: 98vw;
      font-size: 4vw;
    }
    .info-bar > div {
      font-size: 4vw;
    }
    .bank-jackpot {
      font-size: 4vw;
    }
  }
</style>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<div id="usernameModal" class="modal-bg" style="display:none;">
  <div class="modal">
    <div>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –∏–≥—Ä—ã:</div>
    <input id="usernameInput" maxlength="32" autocomplete="off">
    <button id="usernameOkBtn">OK</button>
  </div>
</div>

<h1>BingoBett</h1>
<div class="info-bar">
  <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="username"></span></div>
  <div>–ë–∞–ª–∞–Ω—Å: <span id="balanceDisplay">100 ‚ÇΩ</span></div>
  <div>–°—Ç–∞–≤–∫–∞: <button id="betMinus">-</button> <span id="betAmount">10</span> ‚ÇΩ <button id="betPlus">+</button></div>
</div>
<div id="freeSpinsDisplay">–§—Ä–∏—Å–ø–∏–Ω—ã: 55</div>

<div id="withdrawMsg"></div>

<div class="bank-jackpot">
  –î–∂–µ–∫–ø–æ—Ç: <span id="jackpotDisplay">2 200 453 ‚ÇΩ</span>
</div>

<div class="replenish-buttons">
  <button class="replenish-btn" data-amount="50">50 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="300">300 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="500">500 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="800">800 ‚ÇΩ</button>
</div>

<div class="slot-machine" id="slotMachine"></div>

<div class="controls">
  <button id="spinButton">–í—Ä–∞—â–∞—Ç—å üé∞</button>
  <button id="autoSpinButton">–ê–≤—Ç–æ—Å–ø–∏–Ω ‚ñ∂Ô∏è</button>
  <button id="stopAutoSpinButton" style="display:none;">–°—Ç–æ–ø –∞–≤—Ç–æ—Å–ø–∏–Ω ‚èπ</button>
</div>

<div class="message" id="message"></div>

<div id="botChat">
  <b>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏:</b><br>
</div>

<!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ -->
<div class="mini-game-overlay" id="miniGameOverlay" style="display:none;">
  <div class="mini-game-content">
    <h2>–ú–∏–Ω–∏-–∏–≥—Ä–∞: –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!</h2>
    <div class="boxes">
      <div class="box" data-box="1">üéÅ</div>
      <div class="box" data-box="2">üéÅ</div>
      <div class="box" data-box="3">üéÅ</div>
    </div>
    <div class="mini-game-msg" id="miniGameMsg"></div>
    <button class="close-btn" id="closeMiniGame">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
  // --- Telegram WebApp SDK ---
  let tgUser = null;
  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.ready();
    if (Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
      tgUser = Telegram.WebApp.initDataUnsafe.user;
    }
  }

  // --- Game Parameters ---
  const columns = 5;
  const rows = 4;
  const MIN_BET = 10;
  const MAX_BET = 80;
  
  const reels = [
    ["üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçã","üçä","üçâ","üçá","üçì","ü••","‚≠ê","üÉè","üëë"],
    ["üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
    ["üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè","üí∞"],
    ["üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
    ["üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"]
  ];
  
  const payTable = {
    "üçí": {3:5, 4:10, 5:20},
    "üçã": {3:5, 4:10, 5:20},
    "üçä": {3:5, 4:10, 5:20},
    "üçâ": {3:5, 4:10, 5:20},
    "üçá": {3:5, 4:10, 5:20},
    "üçì": {3:7, 4:14, 5:28},
    "üçç": {3:7, 4:14, 5:28},
    "ü•ù": {3:10, 4:20, 5:40},
    "üçå": {3:10, 4:20, 5:40},
    "ü••": {3:12, 4:24, 5:48},
    "üéÅ": {3:15, 4:30, 5:60},
    "üíé": {3:20, 4:40, 5:80},
    "‚≠ê": {3:25, 4:50, 5:100},
    "üÉè": {3:30, 4:60, 5:120},
    "üëë": {3:50, 4:100, 5:200},
    "üí∞": {3:100, 4:200, 5:500}
  };

  // --- Game State ---
  let balance = parseFloat(localStorage.getItem('slotBalance')) || 100;
  let bet = parseInt(localStorage.getItem('slotBet')) || 10;
  let jackpot = parseFloat(localStorage.getItem('jackpot')) || 2200453;
  let isSpinning = false;
  let autoSpinActive = false;
  let autoSpinInterval = null;
  let slotElements = [];

  // --- User Management ---
  let username = localStorage.getItem('slotUsername') || '';
  
  function setUsername(name) {
    username = name;
    localStorage.setItem('slotUsername', name);
    document.getElementById('username').textContent = name;
  }

  // Initialize user
  if (tgUser && tgUser.first_name) {
    setUsername(tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : ""));
  } else if (!username) {
    document.getElementById('usernameModal').style.display = '';
    document.getElementById('usernameInput').focus();
    document.getElementById('usernameOkBtn').onclick = function() {
      let val = document.getElementById('usernameInput').value.trim();
      if (val.length > 0) {
        setUsername(val);
        document.getElementById('usernameModal').style.display = 'none';
      }
    };
    document.getElementById('usernameInput').onkeydown = function(e) {
      if (e.key === "Enter") document.getElementById('usernameOkBtn').click();
    };
  } else {
    setUsername(username);
  }

  // --- Free Spins Management ---
  function initializeFreeSpins() {
    const registrationTimestamp = localStorage.getItem('registrationTimestamp');
    if (!registrationTimestamp) {
      localStorage.setItem('freeSpins', 55);
      localStorage.setItem('registrationTimestamp', Date.now());
    }
  }

  function isFreeSpinsExpired() {
    const registrationTime = Number(localStorage.getItem('registrationTimestamp'));
    const currentTime = Date.now();
    const expirationPeriod = 23 * 60 * 60 * 1000;
    return (currentTime - registrationTime) > expirationPeriod;
  }

  function updateFreeSpinsDisplay() {
    const remainingSpins = Number(localStorage.getItem('freeSpins')) || 0;
    const display = document.getElementById('freeSpinsDisplay');
    if (display) {
      display.textContent = `–§—Ä–∏—Å–ø–∏–Ω—ã: ${remainingSpins}`;
    }
  }

  function hasAvailableFreeSpins() {
    const remainingSpins = Number(localStorage.getItem('freeSpins'));
    return remainingSpins > 0 && !isFreeSpinsExpired();
  }

  function useFreeSpins() {
    const currentSpins = Number(localStorage.getItem('freeSpins')) || 0;
    if (currentSpins > 0) {
      localStorage.setItem('freeSpins', currentSpins - 1);
      updateFreeSpinsDisplay();
      return true;
    }
    return false;
  }

  // --- Payment Integration ---
  function initializePaymentButtons() {
    document.querySelectorAll('.replenish-btn').forEach(btn => {
      btn.onclick = function () {
        const amount = this.dataset.amount;
        const receiver = process.env.YOOMONEY_WALLET || '–í–ê–®_–ö–û–®–ï–õ–ï–ö';
        const paymentUrl = `https://yoomoney.ru/quickpay/confirm.xml?receiver=${receiver}&quickpay-form=small&sum=${amount}&paymentType=AC`;
        
        window.open(paymentUrl, '_blank');
        
        // Simulate payment success after 10 seconds (in real app, use webhooks)
        setTimeout(() => {
          balance += parseFloat(amount);
          updateUI();
          alert("–ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç. –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω.");
        }, 10000);
      };
    });
  }

  // --- Slot Machine Creation ---
  function createSlotMachine() {
    const slotMachine = document.getElementById('slotMachine');
    slotMachine.innerHTML = '';
    slotElements = [];
    
    for (let row = 0; row < rows; row++) {
      for (let col = 0; col < columns; col++) {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.id = `slot-${row}-${col}`;
        slotMachine.appendChild(slot);
        slotElements.push(slot);
      }
    }
  }

  // --- Game Logic ---
  function getRandomSymbol(reelIndex) {
    const reel = reels[reelIndex % reels.length];
    return reel[Math.floor(Math.random() * reel.length)];
  }

  function spinReels() {
    const result = [];
    for (let row = 0; row < rows; row++) {
      const rowResult = [];
      for (let col = 0; col < columns; col++) {
        rowResult.push(getRandomSymbol(col));
      }
      result.push(rowResult);
    }
    return result;
  }

  function displayResult(result) {
    for (let row = 0; row < rows; row++) {
      for (let col = 0; col < columns; col++) {
        const slot = document.getElementById(`slot-${row}-${col}`);
        slot.textContent = result[row][col];
        slot.className = 'slot';
      }
    }
  }

  function checkWins(result) {
    const wins = [];
    
    // Check horizontal lines
    for (let row = 0; row < rows; row++) {
      const line = result[row];
      const winData = checkLine(line);
      if (winData) {
        winData.positions = [];
        for (let col = 0; col < winData.count; col++) {
          winData.positions.push({row, col});
        }
        wins.push(winData);
      }
    }
    
    return wins;
  }

  function checkLine(line) {
    const firstSymbol = line[0];
    let count = 1;
    
    for (let i = 1; i < line.length; i++) {
      if (line[i] === firstSymbol) {
        count++;
      } else {
        break;
      }
    }
    
    if (count >= 3 && payTable[firstSymbol]) {
      const multiplier = payTable[firstSymbol][count] || 0;
      return {
        symbol: firstSymbol,
        count: count,
        multiplier: multiplier,
        payout: bet * multiplier
      };
    }
    
    return null;
  }

  function highlightWins(wins) {
    wins.forEach(win => {
      win.positions.forEach(pos => {
        const slot = document.getElementById(`slot-${pos.row}-${pos.col}`);
        if (win.payout >= bet * 10) {
          slot.classList.add('big-win');
        } else {
          slot.classList.add('win');
        }
      });
    });
  }

  function calculateTotalPayout(wins) {
    return wins.reduce((total, win) => total + win.payout, 0);
  }

  function updateJackpot() {
    jackpot += bet * 0.01;
    localStorage.setItem('jackpot', jackpot);
    document.getElementById('jackpotDisplay').textContent = jackpot.toLocaleString('ru-RU') + ' ‚ÇΩ';
  }

  function checkJackpot(result) {
    // Check if all symbols are the same special symbol
    const specialSymbols = ['üëë', 'üí∞', 'üíé'];
    const allSymbols = result.flat();
    const firstSymbol = allSymbols[0];
    
    if (specialSymbols.includes(firstSymbol) && allSymbols.every(symbol => symbol === firstSymbol)) {
      return jackpot;
    }
    return 0;
  }

  function triggerMiniGame() {
    if (Math.random() < 0.1) { // 10% chance
      showMiniGame();
      return true;
    }
    return false;
  }

  // --- Mini Game ---
  function showMiniGame() {
    document.getElementById('miniGameOverlay').style.display = 'flex';
    document.getElementById('miniGameMsg').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞!';
    
    const boxes = document.querySelectorAll('.box');
    boxes.forEach(box => {
      box.className = 'box';
      box.onclick = function() {
        selectBox(this);
      };
    });
  }

  function selectBox(selectedBox) {
    const boxes = document.querySelectorAll('.box');
    const winningBox = Math.floor(Math.random() * 3) + 1;
    const selectedBoxNum = parseInt(selectedBox.dataset.box);
    
    boxes.forEach(box => {
      box.onclick = null;
      const boxNum = parseInt(box.dataset.box);
      if (boxNum === winningBox) {
        box.classList.add('win');
        box.textContent = 'üí∞';
      } else {
        box.classList.add('lose');
        box.textContent = 'üíî';
      }
    });
    
    if (selectedBoxNum === winningBox) {
      const bonus = bet * 5;
      balance += bonus;
      document.getElementById('miniGameMsg').textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${bonus} ‚ÇΩ!`;
    } else {
      document.getElementById('miniGameMsg').textContent = '–ù–µ—É–¥–∞—á–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!';
    }
    
    updateUI();
  }

  function closeMiniGame() {
    document.getElementById('miniGameOverlay').style.display = 'none';
  }

  // --- Bot Chat ---
  function addBotMessage(message) {
    const botChat = document.getElementById('botChat');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'bot-message';
    messageDiv.textContent = new Date().toLocaleTimeString() + ': ' + message;
    botChat.appendChild(messageDiv);
    botChat.scrollTop = botChat.scrollHeight;
  }

  function generateRandomWinMessage() {
    const names = ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ú–∞—Ä–∏—è', '–î–º–∏—Ç—Ä–∏–π', '–ê–Ω–Ω–∞', '–°–µ—Ä–≥–µ–π', '–ï–ª–µ–Ω–∞'];
    const amounts = [150, 250, 300, 500, 750, 1000, 1500];
    const name = names[Math.floor(Math.random() * names.length)];
    const amount = amounts[Math.floor(Math.random() * amounts.length)];
    
    addBotMessage(`${name} –≤—ã–∏–≥—Ä–∞–ª ${amount} ‚ÇΩ!`);
  }

  // --- Main Game Function ---
  async function spin() {
    if (isSpinning) return;
    
    const canUseFreeSpins = hasAvailableFreeSpins();
    
    if (!canUseFreeSpins && balance < bet) {
      document.getElementById('message').textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!';
      return;
    }
    
    isSpinning = true;
    document.getElementById('spinButton').disabled = true;
    document.getElementById('message').textContent = '–í—Ä–∞—â–µ–Ω–∏–µ...';
    
    // Deduct bet or use free spin
    if (canUseFreeSpins) {
      useFreeSpins();
    } else {
      balance -= bet;
    }
    
    updateJackpot();
    updateUI();
    
    // Simulate spinning animation
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    const result = spinReels();
    displayResult(result);
    
    const wins = checkWins(result);
    const totalPayout = calculateTotalPayout(wins);
    const jackpotWin = checkJackpot(result);
    
    if (jackpotWin > 0) {
      balance += jackpotWin;
      jackpot = 50000; // Reset jackpot
      localStorage.setItem('jackpot', jackpot);
      document.getElementById('message').textContent = `–î–ñ–ï–ö–ü–û–¢! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${jackpotWin.toLocaleString('ru-RU')} ‚ÇΩ!`;
      addBotMessage(`${username} –≤—ã–∏–≥—Ä–∞–ª –î–ñ–ï–ö–ü–û–¢ ${jackpotWin.toLocaleString('ru-RU')} ‚ÇΩ!`);
    } else if (totalPayout > 0) {
      balance += totalPayout;
      highlightWins(wins);
      document.getElementById('message').textContent = `–í—ã–∏–≥—Ä—ã—à: ${totalPayout} ‚ÇΩ!`;
      
      if (totalPayout >= bet * 10) {
        addBotMessage(`${username} –≤—ã–∏–≥—Ä–∞–ª –∫—Ä—É–ø–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à ${totalPayout} ‚ÇΩ!`);
      }
    } else {
      document.getElementById('message').textContent = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!';
    }
    
    // Random mini-game trigger
    if (!triggerMiniGame() && Math.random() < 0.3) {
      generateRandomWinMessage();
    }
    
    updateUI();
    isSpinning = false;
    document.getElementById('spinButton').disabled = false;
  }

  // --- Auto Spin ---
  function startAutoSpin() {
    if (autoSpinActive) return;
    
    autoSpinActive = true;
    document.getElementById('autoSpinButton').style.display = 'none';
    document.getElementById('stopAutoSpinButton').style.display = 'inline-block';
    
    autoSpinInterval = setInterval(() => {
      if (!isSpinning && (hasAvailableFreeSpins() || balance >= bet)) {
        spin();
      } else {
        stopAutoSpin();
      }
    }, 2000);
  }

  function stopAutoSpin() {
    autoSpinActive = false;
    if (autoSpinInterval) {
      clearInterval(autoSpinInterval);
      autoSpinInterval = null;
    }
    document.getElementById('autoSpinButton').style.display = 'inline-block';
    document.getElementById('stopAutoSpinButton').style.display = 'none';
  }

  // --- Betting Controls ---
  function increaseBet() {
    if (bet < MAX_BET) {
      bet += 10;
      localStorage.setItem('slotBet', bet);
      updateUI();
    }
  }

  function decreaseBet() {
    if (bet > MIN_BET) {
      bet -= 10;
      localStorage.setItem('slotBet', bet);
      updateUI();
    }
  }

  // --- UI Updates ---
  function updateUI() {
    document.getElementById('balanceDisplay').textContent = balance.toFixed(2) + ' ‚ÇΩ';
    document.getElementById('betAmount').textContent = bet;
    document.getElementById('jackpotDisplay').textContent = jackpot.toLocaleString('ru-RU') + ' ‚ÇΩ';
    localStorage.setItem('slotBalance', balance);
    updateFreeSpinsDisplay();
  }

  // --- Event Listeners ---
  function initializeEventListeners() {
    document.getElementById('spinButton').onclick = spin;
    document.getElementById('autoSpinButton').onclick = startAutoSpin;
    document.getElementById('stopAutoSpinButton').onclick = stopAutoSpin;
    document.getElementById('betPlus').onclick = increaseBet;
    document.getElementById('betMinus').onclick = decreaseBet;
    document.getElementById('closeMiniGame').onclick = closeMiniGame;
  }

  // --- Initialization ---
  function initialize() {
    initializeFreeSpins();
    createSlotMachine();
    initializePaymentButtons();
    initializeEventListeners();
    updateUI();
    
    // Initial slot display
    const initialResult = spinReels();
    displayResult(initialResult);
    
    // Start bot chat with some initial messages
    setTimeout(() => generateRandomWinMessage(), 2000);
    setInterval(generateRandomWinMessage, 15000);
  }

  // Start the game when page loads
  window.addEventListener('load', initialize);
</script>

</body>
</html>






