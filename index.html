<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BingoBett</title>
<script src="https://telegram.org/js/telegram-web-app.js?v=6.0" async></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: var(--tg-theme-bg-color, linear-gradient(135deg, #1a1a1a, #444));
    color: var(--tg-theme-text-color, #fff);
    margin: 0; 
    padding: 10px;
    display: flex; 
    flex-direction: column; 
    align-items: center;
    min-height: 100vh;
    max-width: 100vw;
    overflow-x: hidden;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
  }
  .modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
    box-sizing: border-box;
  }
  .modal {
    background: var(--tg-theme-secondary-bg-color, #333);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: var(--tg-theme-text-color, white);
    min-width: 300px;
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 40px);
    box-sizing: border-box;
  }
  .modal input {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    width: 200px;
  }
  .modal button {
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px;
  }
  .modal button.cancel {
    background: #f44336;
  }
  .info-bar {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;
    margin-bottom: 15px;
  }
  .info-bar > div {
    font-size: 18px;
  }
  .slot-machine {
    display: grid;
    grid-template-columns: repeat(5, 18vw);
    grid-template-rows: repeat(4, 12vw);
    gap: 2vw;
    background: #222;
    padding: 4vw 2vw;
    border-radius: 4vw;
    box-shadow: 0 0 4vw #0f0;
    max-width: 98vw;
    min-width: 320px;
    overflow: hidden;
  }
  .slot {
    background: #000;
    border-radius: 2vw;
    font-size: 8vw;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 0 2vw #0f0;
    transition: background-color 0.3s, transform 0.3s;
    position: relative;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
  }
  /* Spinning animation for slots */
  .slot.spinning {
    background: #111;
    border: 2px solid #0f0;
    box-shadow: inset 0 0 2vw #0f0, 0 0 1vw #0f0;
    overflow: hidden;
    position: relative;
    animation: slotGlow 0.1s ease-in-out infinite alternate;
  }
  .slot.spinning .symbol {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 8vw;
    animation: symbolSpin 0.05s linear infinite;
    opacity: 0.9;
  }
  .slot.spinning.stopping {
    animation: slotGlowStop 0.3s ease-out forwards;
  }
  .slot.spinning.stopping .symbol {
    animation: symbolStop 0.3s ease-out forwards;
  }
  @keyframes slotGlow {
    0% { 
      box-shadow: inset 0 0 2vw #0f0, 0 0 1vw #0f0;
      border-color: #0f0;
    }
    100% { 
      box-shadow: inset 0 0 3vw #ff0, 0 0 2vw #ff0;
      border-color: #ff0;
    }
  }
  @keyframes slotGlowStop {
    0% { 
      box-shadow: inset 0 0 3vw #ff0, 0 0 2vw #ff0;
      border-color: #ff0;
    }
    100% { 
      box-shadow: inset 0 0 2vw #0f0;
      border-color: transparent;
    }
  }
  @keyframes symbolSpin {
    0% { 
      transform: rotateY(0deg) scale(1);
      opacity: 0.7;
    }
    25% { 
      transform: rotateY(90deg) scale(0.8);
      opacity: 0.3;
    }
    50% { 
      transform: rotateY(180deg) scale(1);
      opacity: 0.7;
    }
    75% { 
      transform: rotateY(270deg) scale(0.8);
      opacity: 0.3;
    }
    100% { 
      transform: rotateY(360deg) scale(1);
      opacity: 0.7;
    }
  }
  @keyframes symbolStop {
    0% { 
      transform: rotateY(0deg) scale(0.8);
      opacity: 0.7;
    }
    100% { 
      transform: rotateY(0deg) scale(1);
      opacity: 1;
    }
  }
  .slot.win {
    background-color: gold;
    color: black;
    box-shadow: 0 0 15px 5px gold;
    animation: winPulse 1s infinite alternate;
  }
  @keyframes winPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.1); }
  }
  .slot.big-win {
    animation: megaWinPulse 0.4s alternate infinite;
    background: linear-gradient(90deg, gold, orange, gold);
    color: black;
  }
  @keyframes megaWinPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.2); }
  }
  button {
    margin-top: 8px;
    padding: 12px 16px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 12px;
    border: none;
    background: var(--tg-theme-button-color, #4caf50);
    color: var(--tg-theme-button-text-color, white);
    box-shadow: 0 3px var(--tg-theme-button-color, #388e3c);
    transition: all 0.2s;
    min-height: 44px;
    flex: 1;
    max-width: 120px;
    white-space: nowrap;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  button:active {
    box-shadow: 0 1px var(--tg-theme-button-color, #388e3c);
    transform: translateY(2px);
  }
  button:disabled {
    background: #666;
    cursor: not-allowed;
    box-shadow: 0 1px #555;
    opacity: 0.6;
  }
  .controls {
    margin-top: 15px;
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 350px;
  }
  .message {
    margin-top: 20px;
    font-size: 4vw;
    min-height: 10vw;
    white-space: pre-line;
    color: #ffd700;
    max-width: 98vw;
    text-align: center;
  }
  .bank-jackpot {
    margin: 10px 0;
    font-size: 4vw;
  }
  .balance-actions {
    margin: 12px 0;
  }
  .balance-actions input {
    width: 40vw;
    max-width: 140px;
    font-size: 4vw;
    padding: 2vw;
    border-radius: 8px;
    border: none;
    margin-right: 2vw;
    min-width: 0;
    box-sizing: border-box;
  }
  #withdrawMsg {
    color: #ffd700;
    min-height: 24px;
    font-size: 17px;
    margin-top: 6px;
    text-align: center;
  }
  #botChat {
    width: 98vw;
    max-width: 420px;
    max-height: 40vw;
    overflow-y: auto;
    background: #111;
    color: #ffd700;
    font-family: monospace;
    font-size: 3.5vw;
    padding: 2vw;
    border-radius: 2vw;
    margin-top: 5vw;
    border: 1px solid #ffd700;
  }
  .bot-message {
    margin: 3px 0;
    padding: 2px;
    border-bottom: 1px dotted rgba(255, 215, 0, 0.3);
  }
  .replenish-buttons {
    margin: 15px 0;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .replenish-btn {
    padding: 10px 20px;
    font-size: 4vw;
    background: #e62117;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .replenish-btn:hover {
    background: #cc1f15;
  }
  /* Withdrawal button styling */
  .withdraw-btn {
    padding: 10px 20px !important;
    font-size: 4vw !important;
    background: #ff9800 !important;
    color: white !important;
    border: none !important;
    border-radius: 5px !important;
    cursor: pointer !important;
    margin: 10px !important;
    transition: none !important;
    box-shadow: none !important;
    transform: none !important;
    min-height: auto !important;
    flex: none !important;
    max-width: none !important;
    white-space: normal !important;
    -webkit-tap-highlight-color: transparent !important;
    touch-action: manipulation !important;
  }
  /* –ú–∏–Ω–∏-–∏–≥—Ä–∞ */
  .mini-game-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  .mini-game-content {
    background: #232323;
    border-radius: 2vw;
    padding: 5vw 3vw 4vw 3vw;
    color: #fff;
    min-width: 60vw;
    box-shadow: 0 0 4vw #000;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .boxes {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }
  .box {
    width: 20vw;
    max-width: 100px;
    height: 20vw;
    max-height: 100px;
    background: #000;
    border-radius: 2vw;
    font-size: 10vw;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 0 2vw #0f0;
    transition: background-color 0.3s, transform 0.3s;
    position: relative;
    cursor: pointer;
  }
  .box.selected {
    background-color: #4caf50;
    color: white;
  }
  .box.win {
    background-color: green;
    color: white;
  }
  .box.lose {
    background-color: red;
    color: white;
  }
  .mini-game-msg {
    font-size: 18px;
    margin-bottom: 10px;
  }
  .close-btn {
    font-size: 18px;
    padding: 10px 20px;
    border-radius: 5px;
    background-color: #ff4500;
    color: white;
    cursor: pointer;
    border: none;
  }
  /* Telegram Mini App specific styles */
  @media screen and (max-width: 480px) {
    body {
      padding: 5px;
      background: var(--tg-theme-bg-color, linear-gradient(135deg, #1a1a1a, #444));
    }
    .info-bar {
      gap: 8px;
      margin-bottom: 8px;
    }
    .info-bar > div {
      font-size: 14px;
    }
    button {
      font-size: 12px;
      padding: 8px 12px;
      min-height: 40px;
      max-width: 100px;
    }
    .controls {
      gap: 6px;
      max-width: 320px;
    }
    .replenish-btn, .withdraw-btn {
      font-size: 3vw;
      padding: 8px 16px;
    }
    .modal {
      min-width: 280px;
      padding: 15px;
    }
    .balance-actions input {
      width: 30vw;
      max-width: 100px;
      font-size: 3vw;
    }
  }
  @media (max-width: 600px) {
    .slot-machine {
      grid-template-columns: repeat(5, 16vw);
      grid-template-rows: repeat(4, 10vw);
      padding: 2vw 1vw;
    }
    .slot {
      font-size: 7vw;
    }
    #botChat, .mini-game-content {
      width: 96vw;
      max-width: 100vw;
      font-size: 3.5vw;
    }
    .box {
      width: 25vw;
      height: 25vw;
      font-size: 12vw;
    }
    .message {
      max-width: 98vw;
      font-size: 4vw;
    }
    .info-bar > div {
      font-size: 4vw;
    }
    .bank-jackpot {
      font-size: 4vw;
    }
  }
</style>
</head>
<body>
<div id="usernameModal" class="modal-bg" style="display:none;">
  <div class="modal">
    <div>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –∏–≥—Ä—ã:</div>
    <input id="usernameInput" maxlength="32" autocomplete="off">
    <button id="usernameOkBtn">OK</button>
  </div>
</div>
<!-- Withdrawal Modal -->
<div id="withdrawModal" class="modal-bg" style="display:none;">
  <div class="modal">
    <h3>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
    <div>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</div>
    <input id="cardNumberInput" maxlength="19" placeholder="1234 5678 9012 3456" autocomplete="off">
    <div>–°—É–º–º–∞ –∫ –≤—ã–≤–æ–¥—É: <span id="withdrawAmount"></span> ‚ÇΩ</div>
    <div style="margin-top: 15px;">
      <button id="confirmWithdrawBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      <button id="cancelWithdrawBtn" class="cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>
    <div id="withdrawError" style="color: #ff4444; margin-top: 10px; font-size: 14px;"></div>
  </div>
</div>

<!-- Rules Modal -->
<div id="rulesModal" class="modal-bg" style="display:none;">
  <div class="modal" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
    <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã BingoBett</h3>
    <div style="text-align: left; line-height: 1.6; margin: 20px 0;">
      <h4 style="color: #4caf50; margin-top: 20px;">üé∞ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</h4>
      <ul>
        <li>–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ: 5 –±–∞—Ä–∞–±–∞–Ω–æ–≤ √ó 4 —Ä—è–¥–∞ (20 —Å–∏–º–≤–æ–ª–æ–≤)</li>
        <li>–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç–∞–≤–æ–∫: –æ—Ç 10 –¥–æ 80 —Ä—É–±–ª–µ–π</li>
        <li>–í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –ª–∏–Ω–∏–∏: —Ç–æ–ª—å–∫–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ (4 –ª–∏–Ω–∏–∏)</li>
        <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞ –ø–æ–¥—Ä—è–¥ —Å–ª–µ–≤–∞</li>
        <li>–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 555 —Ä—É–±–ª–µ–π</li>
      </ul>
      <h4 style="color: #4caf50; margin-top: 20px;">üí∞ –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç (–º–Ω–æ–∂–∏—Ç–µ–ª—å √ó —Å—Ç–∞–≤–∫–∞):</h4>
      <div style="font-size: 14px; background: #222; padding: 10px; border-radius: 5px; margin: 10px 0;">
        <div><strong>–û–±—ã—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:</strong></div>
        üçíüçãüçäüçâüçá: 3√ó5, 4√ó10, 5√ó20<br>
        üçìüçç: 3√ó7, 4√ó14, 5√ó28<br>
        ü•ùüçå: 3√ó10, 4√ó20, 5√ó40<br>
        ü••: 3√ó12, 4√ó24, 5√ó48<br>
        <div style="margin-top: 10px;"><strong>–ü—Ä–µ–º–∏—É–º —Å–∏–º–≤–æ–ª—ã:</strong></div>
        üéÅ: 3√ó15, 4√ó30, 5√ó60<br>
        üíé: 3√ó20, 4√ó40, 5√ó80<br>
        ‚≠ê: 3√ó25, 4√ó50, 5√ó100<br>
        üÉè: 3√ó30, 4√ó60, 5√ó120<br>
        üëë: 3√ó50, 4√ó100, 5√ó200<br>
        üí∞: 3√ó100, 4√ó200, 5√ó500 (—Ç–æ–ª—å–∫–æ –Ω–∞ 3-–º –±–∞—Ä–∞–±–∞–Ω–µ)
      </div>
      <h4 style="color: #4caf50; margin-top: 20px;">üéÅ –§—Ä–∏—Å–ø–∏–Ω—ã:</h4>
      <ul>
        <li>–ù–æ–≤—ã–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç 55 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π</li>
        <li>–§—Ä–∏—Å–ø–∏–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
        <li>–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ —Å—Ç–∞–≤–∫–∞ –ù–ï —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞</li>
        <li>–í—ã–∏–≥—Ä—ã—à–∏ —Å —Ñ—Ä–∏—Å–ø–∏–Ω–æ–≤ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å</li>
      </ul>
      <h4 style="color: #4caf50; margin-top: 20px;">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã:</h4>
      <ul>
        <li><strong>–®–∞–Ω—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:</strong> 25% –ø—Ä–∏ –ª—é–±–æ–º –≤—ã–∏–≥—Ä—ã—à–µ</li>
        <li><strong>–í—ã–±–æ—Ä –∫–æ—Ä–æ–±–∫–∏ (70% —à–∞–Ω—Å):</strong> –í—ã–±–µ—Ä–∏—Ç–µ 1 –∏–∑ 3 –∫–æ—Ä–æ–±–æ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞</li>
        <li><strong>–î–æ–∂–¥—å –º–æ–Ω–µ—Ç (30% —à–∞–Ω—Å):</strong> –õ–æ–≤–∏—Ç–µ –ø–∞–¥–∞—é—â–∏–µ –º–æ–Ω–µ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥</li>
        <li><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ "–î–æ–∂–¥–µ –º–æ–Ω–µ—Ç":</strong> –ú—ã—à—å/–ø–∞–ª–µ—Ü –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ª–æ–≤—É—à–∫–∏</li>
        <li><strong>–í—ã–ø–ª–∞—Ç–∞ "–î–æ–∂–¥—å –º–æ–Ω–µ—Ç":</strong> 0.5√ó –æ—Ç —Å—Ç–∞–≤–∫–∏ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–π–º–∞–Ω–Ω—É—é –º–æ–Ω–µ—Ç—É</li>
        <li>–ú–∏–Ω–∏-–∏–≥—Ä—ã –¥–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–∏–≥—Ä—ã—à–∏ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑–∞–º</li>
      </ul>
      <h4 style="color: #ff9800; margin-top: 20px;">üí≥ –£—Å–ª–æ–≤–∏—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤:</h4>
      <ul style="color: #ffeb3b;">
        <li><strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—ã–≤–æ–¥–∞: 40,000 —Ä—É–±–ª–µ–π</strong></li>
        <li>–í—ã–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—É–º–º–∞ —Å–≤—ã—à–µ 40,000 —Ä—É–±–ª–µ–π</li>
        <li>40,000 —Ä—É–±–ª–µ–π –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ</li>
        <li>–í—ã–≤–æ–¥ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É (16 —Ü–∏—Ñ—Ä)</li>
        <li>–í—Ä–µ–º—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è: –¥–æ 24 —á–∞—Å–æ–≤</li>
      </ul>
    </div>
    <div style="margin-top: 20px;">
      <button id="closeRulesBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>
<h1>BingoBett</h1>
<div class="info-bar">
  <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="username"></span></div>
  <div>–ë–∞–ª–∞–Ω—Å: <span id="balanceDisplay">555 ‚ÇΩ</span></div>
  <div>–°—Ç–∞–≤–∫–∞: <button id="betMinus">-</button> <span id="betAmount">10</span> ‚ÇΩ <button id="betPlus">+</button></div>
</div>
<div id="freeSpinsDisplay">–§—Ä–∏—Å–ø–∏–Ω—ã: 55</div>
<div id="withdrawMsg"></div>
<div class="bank-jackpot">
  –î–∂–µ–∫–ø–æ—Ç: <span id="jackpotDisplay">2 200 453 ‚ÇΩ</span>
</div>
<div class="replenish-buttons">
  <button class="replenish-btn" data-amount="50">50 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="300">300 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="500">500 ‚ÇΩ</button>
  <button class="replenish-btn" data-amount="800">800 ‚ÇΩ</button>
</div>
<div style="text-align: center; margin: 10px 0;">
  <button class="withdraw-btn" id="withdrawBtn">–í—ã–≤–µ—Å—Ç–∏ –≤—ã–∏–≥—Ä—ã—à</button>
</div>
<div class="slot-machine" id="slotMachine"></div>
<div class="controls">
  <button id="spinButton">–í—Ä–∞—â–∞—Ç—å üé∞</button>
  <button id="autoSpinButton">–ê–≤—Ç–æ—Å–ø–∏–Ω ‚ñ∂Ô∏è</button>
  <button id="stopAutoSpinButton" style="display:none;">–°—Ç–æ–ø –∞–≤—Ç–æ—Å–ø–∏–Ω ‚èπ</button>
  <button id="rulesButton">–ü—Ä–∞–≤–∏–ª–∞ üìã</button>
</div>
<div class="message" id="message"></div>
<div id="botChat">
  <b>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏:</b><br>
</div>
<!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ -->
<div class="mini-game-overlay" id="miniGameOverlay" style="display:none;">
  <div class="mini-game-content">
    <h2>–ú–∏–Ω–∏-–∏–≥—Ä–∞: –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É!</h2>
    <div class="boxes">
      <div class="box" data-box="1">üéÅ</div>
      <div class="box" data-box="2">üéÅ</div>
      <div class="box" data-box="3">üéÅ</div>
    </div>
    <div class="mini-game-msg" id="miniGameMsg"></div>
    <button class="close-btn" id="closeMiniGame">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
<script>
// --- DEBUG: Telegram WebApp Diagnostics ---
console.log('üîç BingoBett Debug Info:');
console.log('User Agent:', navigator.userAgent);
console.log('Location:', window.location.href);
console.log('Telegram Object exists:', typeof window.Telegram !== 'undefined');
console.log('WebApp Object:', window.Telegram?.WebApp);
console.log('Platform:', window.Telegram?.WebApp?.platform);
console.log('Version:', window.Telegram?.WebApp?.version);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SDK
if (typeof window.Telegram === 'undefined') {
    console.error('‚ùå Telegram WebApp SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        alert('Telegram SDK –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –∏–≥—Ä—É –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.');
    }
}

// --- Telegram WebApp SDK (Compatible with v6.0+) ---
let tgUser = null;
if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
  console.log('‚úÖ Telegram WebApp SDK –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
  window.Telegram.WebApp.ready();
  window.Telegram.WebApp.expand();
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  if (typeof window.Telegram.WebApp.enableClosingConfirmation === 'function') {
    window.Telegram.WebApp.enableClosingConfirmation();
  }
  // Get user data if available
  if (window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
    tgUser = window.Telegram.WebApp.initDataUnsafe.user;
  }
  // Haptic feedback (compatible with all versions)
  window.triggerHaptic = () => {
    try {
      if (window.Telegram.WebApp.HapticFeedback && 
          typeof window.Telegram.WebApp.HapticFeedback.impactOccurred === 'function') {
        window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
      }
    } catch (e) {
      // Ignore haptic errors
    }
  };
} else {
  window.triggerHaptic = () => {}; // Fallback for browsers
}
// --- Game Parameters ---
const columns = 5;
const rows = 4;
const MIN_BET = 10;
const MAX_BET = 80;
const YOOMONEY_WALLET = '4100118182998706'; // <-- –î–æ–±–∞–≤–ª–µ–Ω –∫–æ—à–µ–ª–µ–∫ –ÆMoney
const reels = [
  ["üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçã","üçä","üçâ","üçá","üçì","ü••","‚≠ê","üÉè","üëë"],
  ["üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
  ["üçä","üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè","üí∞"],
  ["üçâ","üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","‚≠ê","üÉè"],
  ["üçá","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"]
];
const payTable = {
  "üçí": {3:5, 4:10, 5:20}, "üçã": {3:5, 4:10, 5:20}, "üçä": {3:5, 4:10, 5:20},
  "üçâ": {3:5, 4:10, 5:20}, "üçá": {3:5, 4:10, 5:20}, "üçì": {3:7, 4:14, 5:28},
  "üçç": {3:7, 4:14, 5:28}, "ü•ù": {3:10, 4:20, 5:40}, "üçå": {3:10, 4:20, 5:40},
  "ü••": {3:12, 4:24, 5:48}, "üéÅ": {3:15, 4:30, 5:60}, "üíé": {3:20, 4:40, 5:80},
  "‚≠ê": {3:25, 4:50, 5:100}, "üÉè": {3:30, 4:60, 5:120}, "üëë": {3:50, 4:100, 5:200},
  "üí∞": {3:100, 4:200, 5:500}
};
// --- Game State ---
let balance = parseFloat(localStorage.getItem('slotBalance')) || 555;
let bet = parseInt(localStorage.getItem('slotBet')) || 10;
let jackpot = parseFloat(localStorage.getItem('jackpot')) || 2200453;
let isSpinning = false;
let autoSpinActive = false;
let autoSpinInterval = null;
let slotElements = [];
let username = localStorage.getItem('slotUsername') || '';
function setUsername(name) {
  username = name;
  localStorage.setItem('slotUsername', name);
  document.getElementById('username').textContent = name;
}
// Initialize user
if (tgUser && tgUser.first_name) {
  setUsername(tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : ""));
} else if (!username) {
  document.getElementById('usernameModal').style.display = 'flex';
  document.getElementById('usernameInput').focus();
  document.getElementById('usernameOkBtn').onclick = function() {
    let val = document.getElementById('usernameInput').value.trim();
    if (val.length > 0) {
      setUsername(val);
      document.getElementById('usernameModal').style.display = 'none';
    }
  };
  document.getElementById('usernameInput').onkeydown = function(e) {
    if (e.key === "Enter") document.getElementById('usernameOkBtn').click();
  };
} else {
  setUsername(username);
}
// --- Free Spins Management ---
class FreeSpinsManager {
  constructor() {
    this.initializeFreeSpins();
    this.checkExpiration();
  }
  initializeFreeSpins() {
    const registrationTimestamp = localStorage.getItem('registrationTimestamp');
    if (!registrationTimestamp) {
      localStorage.setItem('freeSpins', '55');
      localStorage.setItem('registrationTimestamp', Date.now().toString());
    }
  }
  checkExpiration() {
    const registrationTime = Number(localStorage.getItem('registrationTimestamp'));
    const currentTime = Date.now();
    const twentyFourHours = 24 * 60 * 60 * 1000;
    if (currentTime - registrationTime > twentyFourHours) {
      localStorage.setItem('freeSpins', '0');
      this.displayFreeSpins();
    }
  }
  getFreeSpins() {
    this.checkExpiration();
    return parseInt(localStorage.getItem('freeSpins') || '0');
  }
  useFreeSpins(count = 1) {
    let currentSpins = this.getFreeSpins();
    if (currentSpins >= count) {
      currentSpins -= count;
      localStorage.setItem('freeSpins', currentSpins.toString());
      this.displayFreeSpins();
      return true;
    }
    return false;
  }
  displayFreeSpins() {
    const freeSpins = this.getFreeSpins();
    document.getElementById('freeSpinsDisplay').textContent = `–§—Ä–∏—Å–ø–∏–Ω—ã: ${freeSpins}`;
  }
}
const freeSpinsManager = new FreeSpinsManager();
// --- Withdrawal System with Validation ---
function initializeWithdrawal() {
  const withdrawBtn = document.getElementById('withdrawBtn');
  const withdrawModal = document.getElementById('withdrawModal');
  const cardNumberInput = document.getElementById('cardNumberInput');
  const confirmWithdrawBtn = document.getElementById('confirmWithdrawBtn');
  const cancelWithdrawBtn = document.getElementById('cancelWithdrawBtn');
  const withdrawError = document.getElementById('withdrawError');
  if (!withdrawBtn) return; // Safety check

  cardNumberInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
    e.target.value = formattedValue;
  });

  withdrawBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    // –ü–†–ê–í–ò–õ–û –í–´–í–û–î–ê: –±–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 40,000 —Ä—É–±–ª–µ–π
    if (balance < 40000.01) { // <-- –ò–∑–º–µ–Ω–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ –Ω–∞ —Å—Ç—Ä–æ–≥–æ–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
      const requiredAmount = 40000.01 - balance;
      showMessage(`‚ùå –í–´–í–û–î –ù–ï–î–û–°–¢–£–ü–ï–ù!\n\n‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—ã–≤–æ–¥–∞: 40,000.01 ‚ÇΩ\n‚Ä¢ –í–∞—à –±–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} ‚ÇΩ\n‚Ä¢ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${requiredAmount.toFixed(2)} ‚ÇΩ\n\n–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è–º.`);
      document.getElementById('withdrawMsg').innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞!</span>';
      return;
    }
    
    const withdrawableAmount = balance - 40000;
    document.getElementById('withdrawAmount').textContent = withdrawableAmount.toFixed(2);
    cardNumberInput.value = '';
    withdrawError.textContent = '';
    withdrawModal.style.display = 'flex';
    setTimeout(() => cardNumberInput.focus(), 100);
  });

  confirmWithdrawBtn.addEventListener('click', function() {
    const cardNumber = cardNumberInput.value.replace(/\s/g, '');
    if (!validateCardNumber(cardNumber)) {
      withdrawError.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä)';
      return;
    }
    const withdrawAmount = balance - 40000;
    balance = 40000; // –û—Å—Ç–∞–µ—Ç—Å—è 40,000 –Ω–∞ –±–∞–ª–∞–Ω—Å–µ
    updateBalance();
    withdrawModal.style.display = 'none';
    showMessage(`‚úÖ –ó–ê–Ø–í–ö–ê –ù–ê –í–´–í–û–î –ü–†–ò–ù–Ø–¢–ê!\n–°—É–º–º–∞: ${withdrawAmount.toFixed(2)} ‚ÇΩ\n–ö–∞—Ä—Ç–∞: **** **** **** ${cardNumber.slice(-4)}\n–°—Ä–æ–∫: –¥–æ 24 —á–∞—Å–æ–≤\n–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ: 40,000.00 ‚ÇΩ`);
    addBotMessage(`${username} –≤—ã–≤–µ–ª ${withdrawAmount.toFixed(2)} ‚ÇΩ`);
    document.getElementById('withdrawMsg').innerHTML = '';
  });

  cancelWithdrawBtn.addEventListener('click', function() {
    withdrawModal.style.display = 'none';
  });
}

function validateCardNumber(cardNumber) {
  return /^\d{16}$/.test(cardNumber);
}

// --- YooMoney Payment Integration ---
function initiatePayment(amount) {
  // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –±–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  const paymentUrl = `https://yoomoney.ru/quickpay/confirm.xml?receiver=${YOOMONEY_WALLET}&quickpay-form=shop&targets=–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ ${amount}‚ÇΩ&paymentType=PC&sum=${amount}&label=${Date.now()}&successURL=https://frutisbett.github.io/bingobett.github.io`;

  if (window.Telegram && window.Telegram.WebApp) {
    window.Telegram.WebApp.openLink(paymentUrl);
  } else {
    window.open(paymentUrl, '_blank');
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –æ–ø–ª–∞—Ç–µ
  showMessage(`üí≥ –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ ${amount} ‚ÇΩ\n–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∏–≥—Ä—É - –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏`);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
  const checkPayment = setInterval(() => {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API
    // –ü–æ–∫–∞ –¥–µ–ª–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
      balance += amount;
      updateBalance();
      showMessage(`‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!\nüí∞ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚ÇΩ`);
      addBotMessage(`${username} –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å –Ω–∞ ${amount} ‚ÇΩ`);
      clearInterval(checkPayment);
    }, 30000);
  }, 10000);
}

// --- Game Logic ---
function createSlotMachine() {
  const slotMachine = document.getElementById('slotMachine');
  slotMachine.innerHTML = '';
  slotElements = [];
  for (let i = 0; i < rows * columns; i++) {
    const slot = document.createElement('div');
    slot.className = 'slot';
    slot.textContent = 'üçí';
    slotMachine.appendChild(slot);
    slotElements.push(slot);
  }
}

function updateBalance() {
  document.getElementById('balanceDisplay').textContent = balance.toFixed(2) + ' ‚ÇΩ';
  localStorage.setItem('slotBalance', balance.toString());
}

function updateJackpot() {
  document.getElementById('jackpotDisplay').textContent = new Intl.NumberFormat('ru-RU').format(jackpot) + ' ‚ÇΩ';
  localStorage.setItem('jackpot', jackpot.toString());
}

function showMessage(text) {
  document.getElementById('message').textContent = text;
  setTimeout(() => {
    document.getElementById('message').textContent = '';
  }, 5000);
}

async function spin() {
  if (isSpinning) return;
  const currentBet = bet;
  const freeSpins = freeSpinsManager.getFreeSpins();
  let usingFreeSpins = false;

  if (freeSpins > 0) {
    // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—Ä–∏—Å–ø–∏–Ω, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å (—É–±–∏—Ä–∞–µ–º confirm)
    usingFreeSpins = true;
    showMessage('üéÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–∏—Å–ø–∏–Ω!');
  } else if (balance < currentBet) {
    showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏');
    return;
  }

  isSpinning = true;
  document.getElementById('spinButton').disabled = true;
  document.getElementById('autoSpinButton').disabled = true;

  if (usingFreeSpins) {
    freeSpinsManager.useFreeSpins(1);
  } else {
    balance -= currentBet;
    updateBalance();
  }

  jackpot += currentBet * 0.1;
  updateJackpot();

  // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–∏–≥—Ä—ã—à–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
  slotElements.forEach((slot, index) => {
    slot.classList.remove('win', 'big-win', 'stopping');
    slot.classList.add('spinning');
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ—Ç–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
    const symbolDiv = document.createElement('div');
    symbolDiv.className = 'symbol';
    // –°–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤–æ –≤—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è
    const spinSymbols = ['üçí','üçã','üçä','üçâ','üçá','üçì','üçç','ü•ù','üçå','ü••','üéÅ','üíé','‚≠ê','üÉè','üëë','üí∞'];
    let spinIndex = 0;
    // –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Å–∏–º–≤–æ–ª–æ–≤
    const symbolInterval = setInterval(() => {
      symbolDiv.textContent = spinSymbols[spinIndex % spinSymbols.length];
      spinIndex++;
    }, 50);
    slot.innerHTML = '';
    slot.appendChild(symbolDiv);
    slot.dataset.symbolInterval = symbolInterval;
  });

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
  const results = [];
  for (let col = 0; col < columns; col++) {
    const reel = reels[col];
    const columnResults = [];
    for (let row = 0; row < rows; row++) {
      columnResults.push(reel[Math.floor(Math.random() * reel.length)]);
    }
    results.push(columnResults);
  }

  // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–≤–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
  await new Promise(resolve => setTimeout(resolve, 1000));

  // –ü–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞—Ä–∞–±–∞–Ω–æ–≤ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ)
  for (let col = 0; col < columns; col++) {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
    for (let row = 0; row < rows; row++) {
      const slotIndex = row * columns + col;
      const slot = slotElements[slotIndex];
      slot.classList.add('stopping');
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–º–µ–Ω—É —Å–∏–º–≤–æ–ª–æ–≤
      const symbolInterval = slot.dataset.symbolInterval;
      if (symbolInterval) {
        clearInterval(symbolInterval);
      }
    }
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
    await new Promise(resolve => setTimeout(resolve, 400));
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —É–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    for (let row = 0; row < rows; row++) {
      const slotIndex = row * columns + col;
      const slot = slotElements[slotIndex];
      slot.classList.remove('spinning', 'stopping');
      slot.innerHTML = results[col][row];
    }
    // –ó–≤—É–∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞—Ä–∞–±–∞–Ω–∞ (–∏–º–∏—Ç–∞—Ü–∏—è)
    triggerHaptic();
    // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –±–∞—Ä–∞–±–∞–Ω–æ–≤
    if (col < columns - 1) {
      await new Promise(resolve => setTimeout(resolve, 300));
    }
  }

  const { totalWin, winningLines } = checkWins(results);
  if (totalWin > 0) {
    balance += totalWin * currentBet;
    updateBalance();
    winningLines.forEach(line => {
      line.forEach(pos => {
        const slotIndex = pos.row * columns + pos.col;
        if (totalWin >= currentBet * 10) {
          slotElements[slotIndex].classList.add('big-win');
        } else {
          slotElements[slotIndex].classList.add('win');
        }
      });
    });
    if (totalWin >= currentBet * 50) {
      showMessage(`üéâ –ú–ï–ì–ê –í–´–ò–ì–†–´–®! +${(totalWin * currentBet).toFixed(2)} ‚ÇΩ`);
      addBotMessage(`${username} –≤—ã–∏–≥—Ä–∞–ª ${(totalWin * currentBet).toFixed(2)} ‚ÇΩ!`);
      } else {
    showMessage(`üí∞ –í—ã–∏–≥—Ä—ã—à: +${(totalWin * currentBet).toFixed(2)} ‚ÇΩ`);
  }
  if (Math.random() < 0.001) {
    balance += jackpot;
    showMessage(`üèÜ –î–ñ–ï–ö–ü–û–¢! +${jackpot.toFixed(2)} ‚ÇΩ`);
    addBotMessage(`${username} —Å–æ—Ä–≤–∞–ª –î–ñ–ï–ö–ü–û–¢ ${jackpot.toFixed(2)} ‚ÇΩ!`);
    jackpot = 100000;
    updateJackpot();
  }
  // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —à–∞–Ω—Å –º–∏–Ω–∏-–∏–≥—Ä: 25% –ø—Ä–∏ –ª—é–±–æ–º –≤—ã–∏–≥—Ä—ã—à–µ
  if (Math.random() < 0.25) {
    setTimeout(() => {
      // 70% —à–∞–Ω—Å –æ–±—ã—á–Ω–æ–π –º–∏–Ω–∏-–∏–≥—Ä—ã, 30% —à–∞–Ω—Å –¥–æ–∂–¥—è –º–æ–Ω–µ—Ç
      if (Math.random() < 0.7) {
        startMiniGame();
      } else {
        startCoinRainGame();
      }
    }, 2000);
  }
} else {
  // –î–∞–∂–µ –±–µ–∑ –≤—ã–∏–≥—Ä—ã—à–∞ –µ—Å—Ç—å 8% —à–∞–Ω—Å –º–∏–Ω–∏-–∏–≥—Ä—ã
  if (Math.random() < 0.08) {
    setTimeout(() => {
      if (Math.random() < 0.6) {
        startMiniGame();
      } else {
        startCoinRainGame();
      }
    }, 1500);
  }
  }
  isSpinning = false;
  document.getElementById('spinButton').disabled = false;
  document.getElementById('autoSpinButton').disabled = false;
}

function checkWins(results) {
  let totalWin = 0;
  let winningLines = [];
  for (let row = 0; row < rows; row++) {
    const line = [];
    for (let col = 0; col < columns; col++) {
      line.push({row, col, symbol: results[col][row]});
    }
    const win = checkLine(line);
    if (win.multiplier > 0) {
      totalWin += win.multiplier;
      winningLines.push(win.positions);
    }
  }
  return { totalWin, winningLines };
}

function checkLine(line) {
  const symbols = line.map(pos => pos.symbol);
  const firstSymbol = symbols[0];
  let count = 1;
  for (let i = 1; i < symbols.length; i++) {
    if (symbols[i] === firstSymbol) {
      count++;
    } else {
      break;
    }
  }
  if (count >= 3 && payTable[firstSymbol]) {
    return {
      multiplier: payTable[firstSymbol][count] || 0,
      positions: line.slice(0, count)
    };
  }
  return { multiplier: 0, positions: [] };
}

function startMiniGame() {
  const overlay = document.getElementById('miniGameOverlay');
  const boxes = document.querySelectorAll('.box');
  const msg = document.getElementById('miniGameMsg');
  boxes.forEach(box => {
    box.className = 'box';
    box.onclick = null;
  });
  const winningBox = Math.floor(Math.random() * 3) + 1;
  const winAmount = bet * (2 + Math.random() * 3);
  msg.textContent = `–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É! –í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(2)} ‚ÇΩ`;
  overlay.style.display = 'flex';
  boxes.forEach(box => {
    box.onclick = function() {
      const boxNum = parseInt(this.dataset.box);
      boxes.forEach(b => b.onclick = null);
      if (boxNum === winningBox) {
        this.classList.add('win');
        balance += winAmount;
        updateBalance();
        msg.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount.toFixed(2)} ‚ÇΩ!`;
        addBotMessage(`${username} –≤—ã–∏–≥—Ä–∞–ª ${winAmount.toFixed(2)} ‚ÇΩ –≤ –º–∏–Ω–∏-–∏–≥—Ä–µ!`);
      } else {
        this.classList.add('lose');
        boxes[winningBox - 1].classList.add('win');
        msg.textContent = `–ù–µ –ø–æ–≤–µ–∑–ª–æ! –í—ã–∏–≥—Ä—ã—à–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞ –±—ã–ª–∞ #${winningBox}`;
      }
    };
  });
}

function startCoinRainGame() {
  const overlay = document.getElementById('miniGameOverlay');
  const content = overlay.querySelector('.mini-game-content');
  
  // –ò–∑–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∏–≥—Ä—ã "–¥–æ–∂–¥—å –º–æ–Ω–µ—Ç"
  content.innerHTML = `
    <h2>üåßÔ∏è –î–æ–∂–¥—å –º–æ–Ω–µ—Ç!</h2>
    <div style="font-size: 18px; margin: 20px 0;">–õ–æ–≤–∏—Ç–µ –ø–∞–¥–∞—é—â–∏–µ –º–æ–Ω–µ—Ç—ã!</div>
    <div id="coinRainArea" style="position: relative; width: 300px; height: 200px; background: #000; border-radius: 10px; overflow: hidden; margin: 20px 0;">
      <div id="catcher" style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 60px; height: 20px; background: #ffd700; border-radius: 10px;"></div>
    </div>
    <div id="coinRainScore" style="font-size: 20px; color: #ffd700; margin: 10px 0;">–ü–æ–π–º–∞–Ω–æ: 0 –º–æ–Ω–µ—Ç</div>
    <div id="coinRainTimer" style="font-size: 16px; margin: 10px 0;">–í—Ä–µ–º—è: 10 —Å–µ–∫</div>
    <button class="close-btn" onclick="endCoinRainGame()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
  `;
  
  overlay.style.display = 'flex';
  
  let caughtCoins = 0;
  let timeLeft = 10;
  let gameActive = true;
  
  const area = document.getElementById('coinRainArea');
  const catcher = document.getElementById('catcher');
  const scoreDisplay = document.getElementById('coinRainScore');
  const timerDisplay = document.getElementById('coinRainTimer');
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≤—É—à–∫–æ–π –º—ã—à—å—é/–ø–∞–ª—å—Ü–µ–º
  let isMoving = false;
  
  area.addEventListener('mousedown', (e) => { isMoving = true; });
  area.addEventListener('mouseup', () => { isMoving = false; });
  area.addEventListener('mousemove', (e) => {
    if (isMoving && gameActive) {
      const rect = area.getBoundingClientRect();
      const x = e.clientX - rect.left;
      catcher.style.left = Math.max(0, Math.min(240, x - 30)) + 'px';
    }
  });
  
  // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  area.addEventListener('touchstart', (e) => { isMoving = true; e.preventDefault(); });
  area.addEventListener('touchend', () => { isMoving = false; });
  area.addEventListener('touchmove', (e) => {
    if (gameActive) {
      const rect = area.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left;
      catcher.style.left = Math.max(0, Math.min(240, x - 30)) + 'px';
      e.preventDefault();
    }
  });
  
  // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
  const timer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `–í—Ä–µ–º—è: ${timeLeft} —Å–µ–∫`;
    if (timeLeft <= 0) {
      endCoinRainGame();
    }
  }, 1000);
  
  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–¥–∞—é—â–∏—Ö –º–æ–Ω–µ—Ç
  const coinInterval = setInterval(() => {
    if (!gameActive) return;
    
    const coin = document.createElement('div');
    coin.style.position = 'absolute';
    coin.style.top = '0px';
    coin.style.left = Math.random() * 280 + 'px';
    coin.style.width = '20px';
    coin.style.height = '20px';
    coin.style.borderRadius = '50%';
    coin.style.background = '#ffd700';
    coin.style.fontSize = '12px';
    coin.style.display = 'flex';
    coin.style.alignItems = 'center';
    coin.style.justifyContent = 'center';
    coin.textContent = 'üí∞';
    coin.style.transition = 'top 3s linear';
    
    area.appendChild(coin);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
    setTimeout(() => {
      coin.style.top = '180px';
    }, 50);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏–º–∫–∏
    const checkCatch = setInterval(() => {
      if (!gameActive) {
        clearInterval(checkCatch);
        return;
      }
      
      const coinRect = coin.getBoundingClientRect();
      const catcherRect = catcher.getBoundingClientRect();
      
      if (coinRect.bottom >= catcherRect.top && 
          coinRect.right >= catcherRect.left && 
          coinRect.left <= catcherRect.right) {
        caughtCoins++;
        scoreDisplay.textContent = `–ü–æ–π–º–∞–Ω–æ: ${caughtCoins} –º–æ–Ω–µ—Ç`;
        coin.remove();
        clearInterval(checkCatch);
        triggerHaptic();
      }
    }, 50);
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      if (coin.parentNode) coin.remove();
      clearInterval(checkCatch);
    }, 3000);
  }, 400);
  
  window.endCoinRainGame = function() {
    gameActive = false;
    clearInterval(timer);
    clearInterval(coinInterval);
    
    const winAmount = caughtCoins * bet * 0.5; // 0.5x —Å—Ç–∞–≤–∫–∏ –∑–∞ –∫–∞–∂–¥—É—é –º–æ–Ω–µ—Ç—É
    balance += winAmount;
    updateBalance();
    
    content.innerHTML = `
      <h2>üåßÔ∏è –î–æ–∂–¥—å –º–æ–Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
      <div style="font-size: 18px; margin: 20px 0;">
        –ü–æ–π–º–∞–Ω–æ –º–æ–Ω–µ—Ç: ${caughtCoins}<br>
        –í—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(2)} ‚ÇΩ
      </div>
      <button class="close-btn" onclick="document.getElementById('miniGameOverlay').style.display = 'none'">–ó–∞–∫—Ä—ã—Ç—å</button>
    `;
    
    if (winAmount > 0) {
      addBotMessage(`${username} –ø–æ–π–º–∞–ª ${caughtCoins} –º–æ–Ω–µ—Ç –∏ –≤—ã–∏–≥—Ä–∞–ª ${winAmount.toFixed(2)} ‚ÇΩ!`);
    }
  };
}

function startAutoSpin() {
  if (autoSpinActive) return;
  autoSpinActive = true;
  document.getElementById('autoSpinButton').style.display = 'none';
  document.getElementById('stopAutoSpinButton').style.display = 'inline-block';
  autoSpinInterval = setInterval(() => {
    if (!isSpinning && (balance >= bet || freeSpinsManager.getFreeSpins() > 0)) {
      spin();
    } else if (!isSpinning) {
      stopAutoSpin();
      showMessage('–ê–≤—Ç–æ—Å–ø–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
    }
  }, 3000);
}

function stopAutoSpin() {
  autoSpinActive = false;
  if (autoSpinInterval) {
    clearInterval(autoSpinInterval);
    autoSpinInterval = null;
  }
  document.getElementById('autoSpinButton').style.display = 'inline-block';
  document.getElementById('stopAutoSpinButton').style.display = 'none';
}

const botMessages = [
  "–ê–Ω–Ω–∞ –ö. –≤—ã–∏–≥—Ä–∞–ª–∞ 450 ‚ÇΩ!", "–ú–∞–∫—Å–∏–º –†. —Å–æ—Ä–≤–∞–ª –¥–∂–µ–∫–ø–æ—Ç 15,000 ‚ÇΩ!",
  "–ï–ª–µ–Ω–∞ –í. –≤—ã–∏–≥—Ä–∞–ª–∞ 820 ‚ÇΩ!", "–ò–≥–æ—Ä—å –°. –ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å 1,200 ‚ÇΩ!",
  "–ú–∞—Ä–∏—è –ü. –≤—ã–∏–≥—Ä–∞–ª–∞ 650 ‚ÇΩ –≤ –º–∏–Ω–∏-–∏–≥—Ä–µ!", "–ê–ª–µ–∫—Å–µ–π –ö. —Å–æ—Ä–≤–∞–ª –∫—É—à 3,400 ‚ÇΩ!",
  "–û–ª—å–≥–∞ –ù. –≤—ã–∏–≥—Ä–∞–ª–∞ 780 ‚ÇΩ!", "–î–º–∏—Ç—Ä–∏–π –õ. –ø–æ–ª—É—á–∏–ª 2,100 ‚ÇΩ!"
];

function addBotMessage(message) {
  const botChat = document.getElementById('botChat');
  const messageDiv = document.createElement('div');
  messageDiv.className = 'bot-message';
  messageDiv.textContent = `${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})} - ${message}`;
  botChat.appendChild(messageDiv);
  botChat.scrollTop = botChat.scrollHeight;
  while (botChat.children.length > 21) {
    botChat.removeChild(botChat.children[1]);
  }
}

function startBotMessages() {
  setInterval(() => {
    if (Math.random() < 0.3) {
      const randomMessage = botMessages[Math.floor(Math.random() * botMessages.length)];
      addBotMessage(randomMessage);
    }
  }, 8000);
}

// --- Initialize Game ---
function initializeGame() {
  createSlotMachine();
  updateBalance();
  updateJackpot();
  freeSpinsManager.displayFreeSpins();
  initializeWithdrawal();
  startBotMessages();
  document.getElementById('betAmount').textContent = bet;

  // Event listeners
  document.getElementById('spinButton').addEventListener('click', () => {
    triggerHaptic();
    spin();
  });
  document.getElementById('autoSpinButton').addEventListener('click', () => {
    triggerHaptic();
    startAutoSpin();
  });
  document.getElementById('stopAutoSpinButton').addEventListener('click', () => {
    triggerHaptic();
    stopAutoSpin();
  });
  document.getElementById('betMinus').addEventListener('click', () => {
    if (bet > MIN_BET) {
      triggerHaptic();
      bet -= 10;
      document.getElementById('betAmount').textContent = bet;
      localStorage.setItem('slotBet', bet.toString());
    }
  });
  document.getElementById('betPlus').addEventListener('click', () => {
    if (bet < MAX_BET) {
      triggerHaptic();
      bet += 10;
      document.getElementById('betAmount').textContent = bet;
      localStorage.setItem('slotBet', bet.toString());
    }
  });
  document.querySelectorAll('.replenish-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      triggerHaptic();
      const amount = parseInt(btn.dataset.amount);
      initiatePayment(amount);
    });
  });
  document.getElementById('closeMiniGame').addEventListener('click', () => {
    triggerHaptic();
    document.getElementById('miniGameOverlay').style.display = 'none';
  });
  document.getElementById('rulesButton').addEventListener('click', () => {
    triggerHaptic();
    document.getElementById('rulesModal').style.display = 'flex';
  });
  document.getElementById('closeRulesBtn').addEventListener('click', () => {
    triggerHaptic();
    document.getElementById('rulesModal').style.display = 'none';
  });

  setTimeout(() => {
    showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}! –£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã!`);
  }, 1000);
}

// Start the game when page loads
function startGame() {
  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Telegram SDK –µ—Å–ª–∏ –æ–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
  if (typeof window.Telegram === 'undefined') {
    console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Telegram SDK...');
    setTimeout(startGame, 100);
    return;
  }
  console.log('üöÄ –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
  initializeGame();
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', startGame);
} else {
  startGame();
}
</script>
</body>
</html>
