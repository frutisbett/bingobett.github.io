<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ BingoBett</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 500px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 50px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .header p {
            color: #ccc;
            font-size: 16px;
        }
        
        .payment-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #aaa;
            font-weight: 500;
        }
        
        .info-value {
            color: #fff;
            font-weight: bold;
        }
        
        .amount {
            color: #4caf50;
            font-size: 18px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.pending {
            background: #ff9800;
            color: #000;
        }
        
        .status.success {
            background: #4caf50;
            color: white;
        }
        
        .status.error {
            background: #f44336;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .timer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }
        
        .security-badge {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .security-badge span {
            color: #4caf50;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 20px;
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ BingoBett Payments</h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —á–µ—Ä–µ–∑ –¥–∏–ª–µ—Ä–∞</p>
        </div>
        
        <div id="paymentInfo" class="payment-info">
            <div class="info-item">
                <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                <span id="paymentStatus" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
            </div>
            <div class="info-item">
                <span class="info-label">–°—É–º–º–∞:</span>
                <span id="paymentAmount" class="info-value amount">0 ‚ÇΩ</span>
            </div>
            <div class="info-item">
                <span class="info-label">ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</span>
                <span id="transactionId" class="info-value">‚Äî</span>
            </div>
            <div class="info-item">
                <span class="info-label">–ò–≥—Ä–æ–∫:</span>
                <span id="playerId" class="info-value">‚Äî</span>
            </div>
            <div class="info-item">
                <span class="info-label">–í—Ä–µ–º—è:</span>
                <span id="paymentTime" class="info-value">‚Äî</span>
            </div>
        </div>
        
        <div id="actionSection">
            <div class="action-buttons">
                <button id="payButton" class="btn btn-primary" onclick="redirectToPayment()">
                    üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ
                </button>
                <button class="btn btn-secondary" onclick="cancelPayment()">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
        
        <div id="loadingSection" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...</p>
        </div>
        
        <div class="timer">
            <p>–°–µ—Å—Å–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞: <span id="timer">05:00</span></p>
        </div>
        
        <div class="security-badge">
            <p>üîí <span>–ó–∞—â–∏—â–µ–Ω–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º</span> ‚Ä¢ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</p>
        </div>
    </div>

    <script>
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const transactionId = urlParams.get('transaction');
        const paymentId = urlParams.get('payment_id');
        const amount = urlParams.get('amount');
        const userId = urlParams.get('user_id');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const paymentStatus = document.getElementById('paymentStatus');
        const paymentAmount = document.getElementById('paymentAmount');
        const transactionIdElement = document.getElementById('transactionId');
        const playerIdElement = document.getElementById('playerId');
        const paymentTimeElement = document.getElementById('paymentTime');
        const actionSection = document.getElementById('actionSection');
        const loadingSection = document.getElementById('loadingSection');
        const timerElement = document.getElementById('timer');
        
        // –¢–∞–π–º–µ—Ä —Å–µ—Å—Å–∏–∏ (5 –º–∏–Ω—É—Ç)
        let timeLeft = 300; // 5 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        let timerInterval;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function initPage() {
            if (amount) {
                paymentAmount.textContent = parseInt(amount).toLocaleString('ru-RU') + ' ‚ÇΩ';
            }
            
            if (transactionId) {
                transactionIdElement.textContent = transactionId;
            }
            
            if (paymentId) {
                transactionIdElement.textContent = paymentId;
            }
            
            if (userId) {
                playerIdElement.textContent = userId;
            }
            
            paymentTimeElement.textContent = new Date().toLocaleString('ru-RU');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startTimer();
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å transactionId, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
            if (transactionId) {
                checkPaymentStatus();
            }
        }
        
        // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    paymentStatus.textContent = '–ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è';
                    paymentStatus.className = 'status error';
                    actionSection.style.display = 'none';
                }
                
                if (timeLeft <= 60) {
                    timerElement.style.color = '#ff6b6b';
                }
            }, 1000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ iframe (–∏–≥—Ä–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –∏–≥—Ä–µ)
        async function redirectToPayment() {
            showLoading();
            
            try {
                // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ API –¥–∏–ª–µ—Ä–∞
                const paymentData = {
                    amount: amount || '1000',
                    user_id: userId || 'unknown',
                    payment_id: paymentId || `manual_${Date.now()}`,
                    game: 'bingo',
                    return_url: window.location.href
                };
                
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:', paymentData);
                const response = await fetch('https://frutisbett.github.io/bingobett.github.io/api/payment/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(paymentData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // –°–æ–∑–¥–∞–µ–º iframe –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
                    const iframe = document.createElement('iframe');
                    iframe.style.position = 'fixed';
                    iframe.style.top = '0';
                    iframe.style.left = '0';
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.style.border = 'none';
                    iframe.style.zIndex = '9999';
                    iframe.style.backgroundColor = 'rgba(0,0,0,0.8)';
                    document.body.appendChild(iframe);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –æ—Ç –¥–∏–ª–µ—Ä–∞
                    const yoomoneyUrl = data.redirect_url;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –≤ iframe
                    iframe.src = yoomoneyUrl;
                    
                    // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç iframe
                    window.addEventListener('message', function handleIframeMessage(event) {
                        if (event.data === 'payment_completed') {
                            // –ü–ª–∞—Ç–µ–∂ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
                            document.body.removeChild(iframe);
                            window.removeEventListener('message', handleIframeMessage);
                            
                            paymentStatus.textContent = '–û–ø–ª–∞—á–µ–Ω–æ';
                            paymentStatus.className = 'status success';
                            actionSection.style.display = 'none';
                            loadingSection.style.display = 'none';
                            
                            // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
                            if (window.opener) {
                                window.opener.postMessage({
                                    type: 'payment_success',
                                    amount: amount,
                                    payment_id: paymentId
                                }, '*');
                            }
                        } else if (event.data === 'payment_failed') {
                            // –ü–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è
                            document.body.removeChild(iframe);
                            window.removeEventListener('message', handleIframeMessage);
                            
                            hideLoading();
                            alert('‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                        }
                    });
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞:', error);
                hideLoading();
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞: ' + error.message);
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è URL –¥–ª—è YooMoney
        function generateYooMoneyUrl() {
            const baseUrl = 'https://yoomoney.ru/quickpay/confirm.xml';
            const params = new URLSearchParams({
                receiver: '4100118182998706',
                'quickpay-form': 'shop',
                targets: `BingoBett –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (${transactionId || paymentId || 'dealer_' + Date.now()})`,
                'paymentType': 'AC',
                sum: amount || '1000',
                label: transactionId || paymentId,
                successURL: `https://frutisbett.github.io/bingobett.github.io/?payment=success&amount=${amount}`,
                failURL: `https://frutisbett.github.io/bingobett.github.io/?payment=error`
            });
            
            return `${baseUrl}?${params.toString()}`;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API –¥–∏–ª–µ—Ä–∞
        async function checkPaymentStatus() {
            try {
                if (!transactionId && !paymentId) return;
                
                const paymentIdToCheck = paymentId || transactionId;
                
                // –í—ã–∑—ã–≤–∞–µ–º API –¥–∏–ª–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
                const response = await fetch(`https://frutisbett.github.io/bingobett.github.io/api/payment/status/${paymentIdToCheck}`);
                const data = await response.json();
                
                if (data.status === 'completed') {
                    paymentStatus.textContent = '–û–ø–ª–∞—á–µ–Ω–æ';
                    paymentStatus.className = 'status success';
                    actionSection.style.display = 'none';
                    loadingSection.style.display = 'none';
                    
                    // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'payment_success',
                            amount: data.amount,
                            payment_id: paymentIdToCheck
                        }, '*');
                    }
                } else if (data.status === 'failed') {
                    paymentStatus.textContent = '–û—à–∏–±–∫–∞';
                    paymentStatus.className = 'status error';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        // –û—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
        function cancelPayment() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂?')) {
                window.location.href = 'https://frutisbett.github.io/bingobett.github.io/';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading() {
            actionSection.style.display = 'none';
            loadingSection.style.display = 'block';
        }
        
        // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function hideLoading() {
            actionSection.style.display = 'block';
            loadingSection.style.display = 'none';
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initPage);
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
        window.addEventListener('message', (event) => {
            if (event.data.type === 'payment_data') {
                const data = event.data;
                if (data.amount) paymentAmount.textContent = data.amount + ' ‚ÇΩ';
                if (data.userId) playerIdElement.textContent = data.userId;
            }
        });
    </script>
</body>
</html>
