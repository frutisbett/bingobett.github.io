<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BettBoom - –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å–ª–æ—Ç—ã</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .header {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 2px solid gold;
        }
        .header h1 {
            margin: 0;
            font-size: 2rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            to { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.6); }
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 20px;
        }
        .user-info {
            display: flex;
            justify-content: space-around;
            width: 90%;
            max-width: 500px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .info-item {
            text-align: center;
        }
        .info-item span {
            color: var(--tg-theme-accent-text-color, #ffd700);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        .slot-machine {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            width: 90%;
            max-width: 500px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid gold;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        .slot {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .slot.win {
            animation: winAnimation 0.5s ease-in-out;
            background: rgba(255, 215, 0, 0.2);
        }
        @keyframes winAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            width: 90%;
            max-width: 500px;
        }
        button {
            padding: 12px 20px;
            font-size: 14px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .replenish-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        .auto-spin-btn {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }
        .stop-auto-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        .message {
            margin: 15px 0;
            min-height: 2em;
            text-align: center;
            color: #ffeb3b;
            font-size: 14px;
            max-width: 90vw;
            word-wrap: break-word;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #botChat {
            width: 90%;
            max-width: 400px;
            height: 80px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            overflow-y: auto;
            font-size: 11px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .bot-message {
            margin-bottom: 3px;
            color: #bbb;
        }
        .modal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: #333;
            padding: 25px;
            border-radius: 15px;
            color: white;
            min-width: 300px;
            max-width: 90vw;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }
        #paymentIframeContainer {
            width: 100%;
            height: 420px;
            margin-top: 15px;
            border: none;
            overflow: hidden;
        }
        .modal input {
            margin: 15px 0;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #555;
            width: 220px;
            background: #222;
            color: white;
        }
        .modal button.cancel {
            background: #f44336;
        }
        .mini-game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å—Ç–∏–ª–∏ –ø–æ –≤–∞—à–µ–º—É –∫–æ–¥—É (–Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å) */
        @media (max-width: 360px) {
            .slot {
                font-size: 5vw;
            }
            .user-info {
                font-size: 11px;
            }
            button {
                font-size: 11px;
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body class="loading">
    <div class="header">
        <h1>üí• BettBoom</h1>
    </div>
    <div class="game-container">
        <div class="user-info">
            <div class="info-item">–ò–≥—Ä–æ–∫: <span id="usernameDisplay">-</span></div>
            <div class="info-item">–ë–∞–ª–∞–Ω—Å: <span id="balanceDisplay">0.00</span> ‚ÇΩ</div>
            <div class="info-item">–°—Ç–∞–≤–∫–∞: <span id="betAmountDisplay">100</span> ‚ÇΩ</div>
            <div class="info-item">–§—Ä–∏—Å–ø–∏–Ω—ã: <span id="freeSpinsDisplay" class="freespin-info">0</span></div>
            <div class="info-item">–î–∂–µ–∫–ø–æ—Ç: <span id="jackpotDisplay" class="jackpot-info">0.00</span> ‚ÇΩ</div>
        </div>
        <div class="slot-machine" id="slotMachine"></div>
        <div class="message" id="message">üí• –ò–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞! –ù–∞–∂–º–∏—Ç–µ "–ö—Ä—É—Ç–∏—Ç—å"</div>
        <div id="botChat"><b>üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä–æ–∫–∏:</b><br/></div>
        <div class="controls">
            <button id="spinButton">üé∞ –ö—Ä—É—Ç–∏—Ç—å</button>
            <button id="autoSpinButton" class="auto-spin-btn">üîÑ –ê–≤—Ç–æ</button>
            <button id="stopAutoButton" class="stop-auto-btn" style="display: none;">‚èπÔ∏è –°—Ç–æ–ø</button>
            <button id="rulesButton">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
            <button id="withdrawBtn">üí∏ –í—ã–≤–æ–¥</button>
            <button class="replenish-btn" data-amount="500">üí≥ 500 ‚ÇΩ</button>
            <button class="replenish-btn" data-amount="800">üí≥ 800 ‚ÇΩ</button>
            <button class="replenish-btn" data-amount="1000">üí≥ 1000 ‚ÇΩ</button>
            <button class="replenish-btn" data-amount="10000">üí≥ 10000 ‚ÇΩ</button>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button id="decreaseBet">-</button>
            <button id="increaseBet">+</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è c iframe -->
    <div id="inGameReplenishModal" class="modal-bg">
        <div class="modal">
            <h3>üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
            <p>–°—É–º–º–∞: <strong id="modalAmount">0</strong> ‚ÇΩ</p>
            <div style="margin: 15px 0; padding: 10px; background: rgba(255,215,0,0.1); border-radius: 8px; border: 1px solid gold;">
                <p style="font-size: 12px; margin: 0;">
                    <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong><br/>
                    –ü–ª–∞—Ç–µ–∂ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å—É<br/>
                    –í—ã –æ—Å—Ç–∞–Ω–µ—Ç–µ—Å—å –≤ –∏–≥—Ä–µ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
                </p>
            </div>
            <div id="paymentIframeContainer"></div>
            <div style="margin: 15px 0;">
                <button id="cancelPaymentBtn" style="width: 100%; padding: 12px; background: #f44336; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
    <div id="rulesModal" class="modal-bg">
        <div class="modal">
            <h3>üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
            <p>‚Ä¢ <b>–¶–µ–ª—å –∏–≥—Ä—ã:</b> –í—ã–∏–≥—Ä—ã–≤–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –¥–µ–Ω–µ–≥ –≤ —Å–ª–æ—Ç–∞—Ö</p>
            <p>‚Ä¢ <b>–°—Ç–∞–≤–∫–∏:</b> –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 100 ‚ÇΩ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è 10000 ‚ÇΩ</p>
            <p>‚Ä¢ <b>–í—ã–∏–≥—Ä—ã—à–∏:</b> –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–∏–º–≤–æ–ª–æ–≤</p>
            <p>‚Ä¢ <b>–§—Ä–∏—Å–ø–∏–Ω—ã:</b> 55 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–ø–∏–Ω–æ–≤ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞</p>
            <p>‚Ä¢ <b>–î–∂–µ–∫–ø–æ—Ç:</b> –°–ª—É—á–∞–π–Ω—ã–µ –∫—Ä—É–ø–Ω—ã–µ –≤—ã–∏–≥—Ä—ã—à–∏</p>
            <p>‚Ä¢ <b>–ú–∏–Ω–∏-–∏–≥—Ä—ã:</b> –°–ª—É—á–∞–π–Ω—ã–µ –±–æ–Ω—É—Å–Ω—ã–µ –∏–≥—Ä—ã</p>
            <p>‚Ä¢ <b>"–í—ã–±–µ—Ä–∏ –∫–æ—Ä–æ–±–∫—É":</b> –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ 3 –∫–æ—Ä–æ–±–æ–∫ —Å –ø—Ä–∏–∑–æ–º</p>
            <p>‚Ä¢ <b>"–î–æ–∂–¥—å –º–æ–Ω–µ—Ç":</b> –õ–æ–≤–∏—Ç–µ –ø–∞–¥–∞—é—â–∏–µ –º–æ–Ω–µ—Ç—ã –∑–∞ 4 —Å–µ–∫—É–Ω–¥—ã!</p>
            <p>‚Ä¢ <b>–®–∞–Ω—Å –∑–∞–ø—É—Å–∫–∞:</b> 35% –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ +15% –±–µ–∑ –≤—ã–∏–≥—Ä—ã—à–∞ (~50% –≤—Å–µ–≥–æ)</p>
            <p>‚Ä¢ <b>–ß–∞—Å—Ç–æ—Ç–∞:</b> –í —Å—Ä–µ–¥–Ω–µ–º –∫–∞–∂–¥—ã–µ 2-3 —Å–ø–∏–Ω–∞ –º–∏–Ω–∏-–∏–≥—Ä–∞</p>
            <p>‚Ä¢ –ë–æ–Ω—É—Å –æ—Ç 60% –¥–æ 240% —Å—Ç–∞–≤–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ø–µ—Ö–∞</p><br/>
            <p><b>üèÜ –í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –ª–∏–Ω–∏–∏:</b></p>
            <p>‚Ä¢ 4 –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–∏</p>
            <p>‚Ä¢ 2 –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–∏ (‚Üò –∏ ‚Üô)</p>
            <div style="text-align: center; margin-top: 20px;">
                <button id="closeRulesBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—ã–≤–æ–¥–∞ -->
    <div id="withdrawModal" class="modal-bg" style="display:none;">
        <div class="modal">
            <h3>üí∏ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
            <div id="withdrawWarning" style="background: rgba(255, 0, 0, 0.1); border: 1px solid red; border-radius: 5px; padding: 10px; margin: 10px 0; display: none;">
                <div style="font-weight: bold; color: red; margin-bottom: 5px;">üö´ –í–´–í–û–î –ù–ï–î–û–°–¢–£–ü–ï–ù</div>
                <div id="withdrawWarningText"></div>
            </div>
            <div id="withdrawForm">
                <div style="margin: 10px 0;">–ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä):</div>
                <input id="cardNumberInput" maxlength="19" placeholder="1234 5678 9012 3456" />
                <div style="margin: 10px 0;">–í–∞—à –±–∞–ª–∞–Ω—Å: <span id="currentBalanceDisplay">0.00</span> ‚ÇΩ<br/>
                    –ú–∞–∫—Å–∏–º—É–º –≤—ã–≤–æ–¥: <span id="withdrawAmount">0.00</span> ‚ÇΩ
                </div>
                <div id="withdrawError"></div>
                <button id="confirmWithdrawBtn">üì§ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥</button>
            </div>
            <button class="cancel" id="cancelWithdrawBtn">‚ùå –û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>


<script>
    // –û—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    const reels = [
        ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"],
        ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"],
        ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"],
        ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"],
        ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçí","üçã","üçä","üçâ","üçá","üçì","üçç","ü•ù","‚≠ê","üÉè"]
    ];
    const payTable = {
        "üçí": {3:8, 4:15, 5:30},
        "üçã": {3:8, 4:15, 5:30},
        "üçä": {3:8, 4:15, 5:30},
        "üçâ": {3:8, 4:15, 5:30},
        "üçá": {3:8, 4:15, 5:30},
        "üçì": {3:12, 4:20, 5:40},
        "üçç": {3:12, 4:20, 5:40},
        "ü•ù": {3:15, 4:30, 5:60},
        "üçå": {3:15, 4:30, 5:60},
        "ü••": {3:20, 4:40, 5:80},
        "üéÅ": {3:25, 4:50, 5:100},
        "üíé": {3:30, 4:60, 5:120},
        "‚≠ê": {3:40, 4:80, 5:160},
        "üÉè": {3:50, 4:100, 5:200},
        "üëë": {3:80, 4:160, 5:320},
        "üí∞": {3:150, 4:300, 5:800}
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let balance = parseFloat(localStorage.getItem('local_slotBalance')) || 5000;
    let betAmount = 100;
    let isSpinning = false;
    let isAutoSpinning = false;
    let autoSpinInterval;
    let username = localStorage.getItem('username') || '';
    let jackpot = 0;
    let freeSpinsManager = new FreeSpinsManager();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
        createSlots();
        setupEventListeners();
        initializeModals();
        startBotChat();
        updateUI();
        checkPaymentReturn();
    });

    // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã
    function createSlots() {
        const slotMachine = document.getElementById('slotMachine');
        slotMachine.innerHTML = '';
        for (let i = 0; i < 20; i++) {
            const slot = document.createElement('div');
            slot.classList.add('slot');
            slot.textContent = "üçí";
            slotMachine.appendChild(slot);
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    function updateUI() {
        document.getElementById('usernameDisplay').textContent = username || '–ì–æ—Å—Ç—å';
        document.getElementById('balanceDisplay').textContent = balance.toFixed(2);
        document.getElementById('betAmountDisplay').textContent = betAmount;
        document.getElementById('freeSpinsDisplay').textContent = freeSpinsManager.getFreeSpins();
        document.getElementById('jackpotDisplay').textContent = jackpot.toFixed(2);
        document.getElementById('currentBalanceDisplay').textContent = balance.toFixed(2);
        document.getElementById('withdrawAmount').textContent = Math.max(0, balance - 40000).toFixed(2);
        localStorage.setItem('local_slotBalance', balance);
    }

    // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    function showMessage(message) {
        const messageElement = document.getElementById('message');
        messageElement.innerHTML = message;
        setTimeout(() => { messageElement.innerHTML = ''; }, 5000);
    }

    // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π iframe
    function showInGameReplenishModal(amount) {
        document.getElementById('modalAmount').textContent = amount;

        const container = document.getElementById('paymentIframeContainer');
        container.innerHTML = '';

        const paymentId = `bingobett_${Date.now()}_${Math.random().toString(36).substring(7)}`;
        localStorage.setItem('pendingPayment', JSON.stringify({ id: paymentId, amount: amount, timestamp: Date.now(), status: 'pending' }));

        const successURL = `${window.location.origin}${window.location.pathname}?payment=success&amount=${amount}&id=${paymentId}`;

        const yoomoneyUrl = `https://yoomoney.ru/quickpay/confirm.xml?receiver=4100118182998706&quickpay-form=shop&targets=BingoBett%20–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ%20(${paymentId})&paymentType=AC&sum=${amount}&label=${paymentId}&successURL=${encodeURIComponent(successURL)}`;

        const iframe = document.createElement('iframe');
        iframe.src = yoomoneyUrl;
        iframe.style.width = '100%';
        iframe.style.height = '400px';
        iframe.style.border = 'none';

        container.appendChild(iframe);

        const modal = document.getElementById('inGameReplenishModal');
        modal.style.display = 'flex';

        document.getElementById('cancelPaymentBtn').onclick = () => {
            modal.style.display = 'none';
            container.innerHTML = '';
        };

        showMessage(`üí≥ –û—Ç–∫—Ä—ã—Ç–∞ —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã ${amount}‚ÇΩ –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä—ã.`);
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
    function checkPaymentReturn() {
        const urlParams = new URLSearchParams(window.location.search);
        const payment = urlParams.get('payment');
        const amount = urlParams.get('amount');
        const id = urlParams.get('id');

        if (payment === 'success' && amount && id) {
            window.history.replaceState({}, document.title, window.location.pathname);
            const pendingPayment = JSON.parse(localStorage.getItem('pendingPayment') || '{}');
            if (pendingPayment.id === id && pendingPayment.amount == amount) {
                balance += parseInt(amount);
                localStorage.setItem('local_slotBalance', balance);
                updateUI();
                showMessage(`‚úÖ –ü–ª–∞—Ç–µ–∂ –Ω–∞ ${amount} ‚ÇΩ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω! –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω.`);
                localStorage.removeItem('pendingPayment');
            }
        }
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    function setupReplenishButtons() {
        const replenishButtons = document.querySelectorAll('.replenish-btn');
        replenishButtons.forEach(btn => {
            btn.onclick = () => {
                const amount = parseInt(btn.getAttribute('data-amount'));
                showInGameReplenishModal(amount);
            };
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
        setupReplenishButtons();

        document.getElementById('spinButton').onclick = () => {
            if (!isSpinning && !isAutoSpinning) {
                startSpin();
            }
        };

        document.getElementById('autoSpinButton').onclick = () => {
            if (!isAutoSpinning) {
                isAutoSpinning = true;
                document.getElementById('autoSpinButton').style.display = 'none';
                document.getElementById('stopAutoButton').style.display = 'inline-block';
                autoSpinInterval = setInterval(() => {
                    if (!isSpinning) startSpin();
                }, 1500);
            }
        };

        document.getElementById('stopAutoButton').onclick = () => {
            isAutoSpinning = false;
            clearInterval(autoSpinInterval);
            document.getElementById('autoSpinButton').style.display = 'inline-block';
            document.getElementById('stopAutoButton').style.display = 'none';
        };

        document.getElementById('increaseBet').onclick = () => {
            if (betAmount < 10000) {
                betAmount += 100;
                updateUI();
            }
        };

        document.getElementById('decreaseBet').onclick = () => {
            if (betAmount > 100) {
                betAmount -= 100;
                updateUI();
            }
        };

        document.getElementById('rulesButton').onclick = () => {
            document.getElementById('rulesModal').style.display = 'flex';
        };
        document.getElementById('closeRulesBtn').onclick = () => {
            document.getElementById('rulesModal').style.display = 'none';
        };

        document.getElementById('withdrawBtn').onclick = () => {
            document.getElementById('withdrawModal').style.display = 'flex';
        };

        document.getElementById('cancelWithdrawBtn').onclick = () => {
            document.getElementById('withdrawModal').style.display = 'none';
        };

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
        const cardInput = document.getElementById('cardNumberInput');
        if (cardInput) {
            cardInput.addEventListener('input', e => {
                let value = e.target.value.replace(/\D/g, '');
                let formatted = '';
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) formatted += ' ';
                    formatted += value[i];
                }
                e.target.value = formatted;
            });
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ (–ª–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        document.getElementById('confirmWithdrawBtn').onclick = () => {
            const card = document.getElementById('cardNumberInput').value.replace(/\s/g, '');
            const withdrawForm = document.getElementById('withdrawForm');
            const withdrawWarning = document.getElementById('withdrawWarning');
            const withdrawError = document.getElementById('withdrawError');

            withdrawError.textContent = '';

            if (balance <= 40000) {
                const needed = 40001 - balance;
                withdrawWarning.style.display = 'block';
                withdrawForm.style.display = 'none';
                let warningMessage = `<div style="margin-bottom: 10px;"><strong>–í–∞—à –±–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} ‚ÇΩ</strong><br>
                     <strong>–¢—Ä–µ–±—É–µ—Ç—Å—è: 40,001.00 ‚ÇΩ</strong><br>
                     <strong style="color: red;">–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${needed.toFixed(2)} ‚ÇΩ</strong></div>`;

                if (balance < 1000) {
                    warningMessage += `<div style="color: #ff6b6b;">üí° <strong>–°–æ–≤–µ—Ç:</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –∏–ª–∏ –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã—à–µ.</div>`;
                } else if (balance < 10000) {
                    warningMessage += `<div style="color: #ff9500;">üé∞ <strong>–°–æ–≤–µ—Ç:</strong> –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏–≥—Ä–∞—Ç—å! –û—Å—Ç–∞–ª–æ—Å—å –≤—ã–∏–≥—Ä–∞—Ç—å ${needed.toFixed(2)} ‚ÇΩ.</div>`;
                } else if (balance < 30000) {
                    warningMessage += `<div style="color: #ff9500;">üöÄ <strong>–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ!</strong> –û—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º –Ω–µ–º–Ω–æ–≥–æ - ${needed.toFixed(2)} ‚ÇΩ.</div>`;
                } else {
                    warningMessage += `<div style="color: #ff9500;">üéØ <strong>–°–æ–≤—Å–µ–º –±–ª–∏–∑–∫–æ!</strong> –ï—â–µ ${needed.toFixed(2)} ‚ÇΩ –∏ –≤—ã–≤–æ–¥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω!</div>`;
                }
                document.getElementById('withdrawWarningText').innerHTML = warningMessage;
                showMessage(`‚ùå –í—ã–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω! –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: 40,001 ‚ÇΩ. –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${needed.toFixed(2)} ‚ÇΩ`);
            } else {
                withdrawWarning.style.display = 'none';
                withdrawForm.style.display = 'block';
                const maxWithdraw = balance - 40000;
                document.getElementById('withdrawAmount').textContent = maxWithdraw.toFixed(2);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–≤–æ–¥–∞ –Ω–∞ –∫–∞—Ä—Ç—É
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                alert(`–í—ã–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É ${card} –Ω–∞ —Å—É–º–º—É –¥–æ ${maxWithdraw.toFixed(2)} ‚ÇΩ`);
                document.getElementById('withdrawModal').style.display = 'none';
            }
        };
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (–∏–º—è –∏–≥—Ä–æ–∫–∞)
    function initializeModals() {
        const modal = document.getElementById('usernameModal');
        const input = document.getElementById('usernameInput');
        const okBtn = document.getElementById('usernameOkBtn');

        if (!username) {
            modal.style.display = 'flex';
        }

        if (okBtn) {
            okBtn.onclick = () => {
                const name = input.value.trim();
                if (name && name.length <= 20) {
                    username = name;
                    localStorage.setItem('username', username);
                    updateUI();
                    modal.style.display = 'none';
                    showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}! –£–¥–∞—á–∏ –≤ –∏–≥—Ä–µ!`);
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è (–¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤)');
                }
            };
        }
    }

    // –ë–æ—Ç —á–∞—Ç —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    function addBotMessage(message) {
        const chat = document.getElementById('botChat');
        const elem = document.createElement('div');
        elem.className = 'bot-message';
        elem.textContent = message;
        chat.appendChild(elem);
        chat.scrollTop = chat.scrollHeight;
    }

    function startBotChat() {
        const botNames = ["–ê–ª–µ–∫—Å–µ–π", "–ú–∞—Ä–∏—è", "–î–º–∏—Ç—Ä–∏–π", "–ê–Ω–Ω–∞", "–°–µ—Ä–≥–µ–π", "–ï–ª–µ–Ω–∞", "–ú–∞–∫—Å–∏–º", "–û–ª—å–≥–∞", "–ò–≤–∞–Ω", "–¢–∞—Ç—å—è–Ω–∞"];
        const botMessages = [
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–±–µ–¥–æ–π!",
            "–í—ã–∏–≥—Ä–∞–ª 1000 ‚ÇΩ!",
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –¥–∂–µ–∫–ø–æ—Ç–æ–º!",
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!",
            "–í—ã–∏–≥—Ä—ã—à –Ω–∞ 500 ‚ÇΩ!",
            "–°—á–∞—Å—Ç–ª–∏–≤—ã–π –∏–≥—Ä–æ–∫!",
            "–ò–≥—Ä–∞–π—Ç–µ —É—Å–µ—Ä–¥–Ω–µ–µ!",
            "–£–¥–∞—á–∞ –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ!",
            "–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!",
            "–í—ã –º–æ–ª–æ–¥–µ—Ü!"
        ];

        setInterval(() => {
            if (Math.random() > 0.7) {
                const name = botNames[Math.floor(Math.random() * botNames.length)];
                const msg = botMessages[Math.floor(Math.random() * botMessages.length)];
                addBotMessage(`${name}: ${msg}`);
            }
        }, 7000);
    }

    // –ö–ª–∞—Å—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–∏—Å–ø–∏–Ω–∞–º–∏
    class FreeSpinsManager {
        constructor() {
            this.freeSpins = localStorage.getItem('freeSpins') ? parseInt(localStorage.getItem('freeSpins')) : 0;
            this.lastFreeSpinsTime = localStorage.getItem('lastFreeSpinsTime') ? parseInt(localStorage.getItem('lastFreeSpinsTime')) : 0;
        }

        getFreeSpins() {
            const now = Date.now();
            const twentyFourHours = 24 * 60 * 60 * 1000;
            if (now - this.lastFreeSpinsTime > twentyFourHours) {
                this.freeSpins = 0;
                this.lastFreeSpinsTime = now;
                this.save();
            }
            return this.freeSpins;
        }

        useFreeSpins(count) {
            if (this.freeSpins >= count) {
                this.freeSpins -= count;
                this.save();
            }
        }

        addFreeSpins(count) {
            this.freeSpins += count;
            this.lastFreeSpinsTime = Date.now();
            this.save();
        }

        save() {
            localStorage.setItem('freeSpins', this.freeSpins);
            localStorage.setItem('lastFreeSpinsTime', this.lastFreeSpinsTime);
        }
    }

    // –ù–∞—á–∏–Ω–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
    function startSpin() {
        if (isSpinning) return;

        let usingFreeSpin = false;
        const freeSpins = freeSpinsManager.getFreeSpins();

        if (freeSpins > 0) {
            usingFreeSpin = true;
            freeSpinsManager.useFreeSpins(1);
            showMessage('üéÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–∏—Å–ø–∏–Ω!');
        } else if (balance >= betAmount) {
            balance -= betAmount;
            updateUI();
        } else {
            showMessage('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
            return;
        }

        isSpinning = true;
        const spinButton = document.getElementById('spinButton');
        if (spinButton) spinButton.disabled = true;

        const slotElems = document.querySelectorAll('.slot');
        let spinCount = 0;
        const spinDuration = 2000;
        const spinInterval = 50;

        function getRandomSymbol() {
            const symbols = ["üçí","üçì","üçç","ü•ù","üçå","ü••","üéÅ","üíé","üçã","üçä","üçâ","üçá","‚≠ê","üÉè","üëë","üí∞"];
            return symbols[Math.floor(Math.random() * symbols.length)];
        }

        function animateSpin() {
            if (spinCount >= spinDuration / spinInterval) {
                finishSpin();
                return;
            }
            slotElems.forEach(s => {
                s.textContent = getRandomSymbol();
            });
            spinCount++;
            setTimeout(animateSpin, spinInterval);
        }

        function finishSpin() {
            const results = [];
            for (let i = 0; i < 5; i++) {
                const reel = reels[i];
                const result = reel[Math.floor(Math.random() * reel.length)];
                results.push(result);
            }
            slotElems.forEach((s, idx) => {
                s.textContent = results[idx % 5];
            });
            checkWin(results);
            isSpinning = false;
            if (spinButton) spinButton.disabled = false;
            updateUI();
        }

        animateSpin();
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –ª–∏–Ω–∏–∏
    function checkWin(results) {
        let totalWin = 0;
        let slotElems = document.querySelectorAll('.slot');

        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏ –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Äa)
        const lines = [
            [0,1,2,3,4],   // –¥–∏–∞–≥–æ–Ω–∞–ª—å ‚Üò
            [4,3,2,1,0],   // –¥–∏–∞–≥–æ–Ω–∞–ª—å ‚Üô
        ];

        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å: —Ç.–∫. —É –Ω–∞—Å 20 —Å–ª–æ—Ç–æ–≤ - –¥–µ–ª–∏–º –Ω–∞ 4 —Ä—è–¥–∞ –ø–æ 5 —Å–∏–º–≤–æ–ª–æ–≤
        for(let row=0; row<4; row++) {
            const lineIndices = [];
            for(let col=0; col<5; col++) {
                lineIndices.push(row*5+col);
            }
            lines.push(lineIndices);
        }

        for(let line of lines) {
            const symbolsOnLine = line.map(idx => results[idx % 5]);
            const counts = {};
            symbolsOnLine.forEach(sym => counts[sym] = (counts[sym]||0)+1);
            for(let sym in counts) {
                if(counts[sym]>=3 && payTable[sym] && payTable[sym][counts[sym]]) {
                    const win = payTable[sym][counts[sym]] * betAmount;
                    totalWin += win;
                    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Å–ª–æ—Ç—ã
                    line.forEach(idx => {
                        if(slotElems[idx]) slotElems[idx].classList.add('win');
                    });
                    setTimeout(() => {
                        line.forEach(idx => {
                            if(slotElems[idx]) slotElems[idx].classList.remove('win');
                        });
                    }, 1000);
                }
            }
        }

        if(totalWin > 0) {
            balance += totalWin;
            jackpot += totalWin * 0.01;
            showMessage(`üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${totalWin.toFixed(2)} ‚ÇΩ!`);
        } else {
            showMessage("–ù–µ –ø–æ–≤–µ–∑–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!");
        }
        updateUI();
    }
</script>
</body>
</html>
