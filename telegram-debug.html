<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üîß Telegram Mini App Debug</title>
    <script src="https://telegram.org/js/telegram-web-app.js?v=6.9"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 15px;
            line-height: 1.4;
        }
        
        .debug-panel {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #444;
        }
        
        .debug-panel h3 {
            color: #ffd700;
            margin-top: 0;
            font-size: 16px;
        }
        
        .status {
            padding: 8px 12px;
            border-radius: 6px;
            margin: 5px 0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .success { background: #1b5e20; color: #4caf50; }
        .error { background: #b71c1c; color: #f44336; }
        .warning { background: #e65100; color: #ff9800; }
        .info { background: #0d47a1; color: #2196f3; }
        
        .code {
            background: #000;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 8px 0;
            overflow-x: auto;
        }
        
        .btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn:hover { background: #45a049; }
        .btn.danger { background: #f44336; }
        .btn.info { background: #2196f3; }
        
        pre {
            background: #000;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 11px;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <h1>üîß Telegram Mini App Debug</h1>
    
    <div class="debug-panel">
        <h3>üîç –ë–∞–∑–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
        <div id="basicInfo"></div>
    </div>
    
    <div class="debug-panel">
        <h3>üì± Telegram WebApp SDK</h3>
        <div id="telegramInfo"></div>
    </div>
    
    <div class="debug-panel">
        <h3>üåê –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
        <div id="networkInfo"></div>
        <button class="btn" onclick="testGameLoad()">üéÆ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã</button>
        <button class="btn info" onclick="testCORS()">üîó –¢–µ—Å—Ç CORS</button>
    </div>
    
    <div class="debug-panel">
        <h3>üíæ LocalStorage & Cookies</h3>
        <div id="storageInfo"></div>
        <button class="btn" onclick="testStorage()">üíæ –¢–µ—Å—Ç Storage</button>
    </div>
    
    <div class="debug-panel">
        <h3>üéÆ –ò–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
        <div id="gameInfo"></div>
        <button class="btn" onclick="testGameFrame()">üñºÔ∏è –¢–µ—Å—Ç iframe</button>
        <button class="btn danger" onclick="forceReload()">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞</button>
    </div>
    
    <div class="debug-panel">
        <h3>üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥</h3>
        <div id="detailLog" class="code" style="max-height: 300px; overflow-y: auto;"></div>
        <button class="btn info" onclick="exportLog()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
        <button class="btn danger" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div class="debug-panel">
        <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
        <button class="btn" onclick="fixTelegramInit()">üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å Telegram Init</button>
        <button class="btn" onclick="enableDebugMode()">üêõ Debug Mode ON</button>
        <button class="btn info" onclick="simulateTelegram()">üì± –°–∏–º—É–ª—è—Ü–∏—è Telegram</button>
        <button class="btn danger" onclick="resetAll()">üîÑ –°–±—Ä–æ—Å –≤—Å–µ–≥–æ</button>
    </div>

    <script>
        let debugLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
            debugLog.push(logEntry);
            
            const logElement = document.getElementById('detailLog');
            const colors = { info: '#2196f3', success: '#4caf50', error: '#f44336', warning: '#ff9800' };
            logElement.innerHTML += `<span style="color: ${colors[type] || '#fff'}">${logEntry}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function addStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML += `<div class="status ${type}">${message}</div>`;
        }
        
        function runBasicDiagnostics() {
            log('üîç –ó–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...', 'info');
            
            // User Agent
            const userAgent = navigator.userAgent;
            const isTelegram = userAgent.includes('Telegram');
            addStatus('basicInfo', `üì± User Agent: ${isTelegram ? '‚úÖ Telegram' : '‚ùå ' + userAgent.substring(0, 50) + '...'}`, isTelegram ? 'success' : 'error');
            log(`User Agent: ${userAgent}`, isTelegram ? 'success' : 'error');
            
            // Viewport
            const viewport = `${window.innerWidth}√ó${window.innerHeight}`;
            addStatus('basicInfo', `üìè Viewport: ${viewport}`, 'info');
            
            // Touch support
            const hasTouch = 'ontouchstart' in window;
            addStatus('basicInfo', `üëÜ Touch: ${hasTouch ? '‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}`, hasTouch ? 'success' : 'warning');
            
            // Protocol
            const isHTTPS = location.protocol === 'https:';
            addStatus('basicInfo', `üîí HTTPS: ${isHTTPS ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}`, isHTTPS ? 'success' : 'error');
            
            // JavaScript features
            const features = {
                'localStorage': typeof localStorage !== 'undefined',
                'fetch': typeof fetch !== 'undefined',
                'WebSocket': typeof WebSocket !== 'undefined',
                'Canvas': !!document.createElement('canvas').getContext,
                'Audio': typeof Audio !== 'undefined'
            };
            
            for (const [feature, supported] of Object.entries(features)) {
                addStatus('basicInfo', `üîß ${feature}: ${supported ? '‚úÖ' : '‚ùå'}`, supported ? 'success' : 'error');
                log(`${feature}: ${supported ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '–ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}`, supported ? 'success' : 'error');
            }
        }
        
        function diagnoseTelegram() {
            log('üì± –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Telegram WebApp...', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SDK
            const sdkLoaded = typeof window.Telegram !== 'undefined';
            addStatus('telegramInfo', `üì¶ SDK –∑–∞–≥—Ä—É–∂–µ–Ω: ${sdkLoaded ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}`, sdkLoaded ? 'success' : 'error');
            
            if (!sdkLoaded) {
                addStatus('telegramInfo', 'üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: Telegram SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'error');
                addStatus('telegramInfo', 'üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: CORS, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤, –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ', 'warning');
                log('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: Telegram SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebApp
            const webAppAvailable = window.Telegram.WebApp;
            addStatus('telegramInfo', `üéÆ WebApp –¥–æ—Å—Ç—É–ø–µ–Ω: ${webAppAvailable ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}`, webAppAvailable ? 'success' : 'error');
            
            if (webAppAvailable) {
                const tg = window.Telegram.WebApp;
                
                // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                addStatus('telegramInfo', `üì± –í–µ—Ä—Å–∏—è: ${tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}`, 'info');
                addStatus('telegramInfo', `üé® –¢–µ–º–∞: ${tg.colorScheme || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}`, 'info');
                addStatus('telegramInfo', `üìê –í—ã—Å–æ—Ç–∞: ${tg.viewportHeight || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}px`, 'info');
                addStatus('telegramInfo', `üë§ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}`, 'info');
                
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    addStatus('telegramInfo', `üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}`, 'success');
                    log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: ${user.first_name} (ID: ${user.id})`, 'success');
                } else {
                    addStatus('telegramInfo', 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'warning');
                    log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'warning');
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–µ—Ç–æ–¥—ã
                try {
                    if (typeof tg.ready === 'function') {
                        tg.ready();
                        addStatus('telegramInfo', '‚úÖ tg.ready() –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                        log('tg.ready() –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    }
                    
                    if (typeof tg.expand === 'function') {
                        tg.expand();
                        addStatus('telegramInfo', '‚úÖ tg.expand() –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                        log('tg.expand() –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    }
                    
                    if (tg.HapticFeedback && typeof tg.HapticFeedback.impactOccurred === 'function') {
                        tg.HapticFeedback.impactOccurred('light');
                        addStatus('telegramInfo', '‚úÖ Haptic feedback —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                        log('Haptic feedback –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
                    }
                    
                } catch (error) {
                    addStatus('telegramInfo', `‚ùå –û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–æ–≤: ${error.message}`, 'error');
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤: ${error.message}`, 'error');
                }
            }
        }
        
        async function testGameLoad() {
            log('üéÆ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã...', 'info');
            addStatus('networkInfo', '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...', 'info');
            
            try {
                const response = await fetch('https://frutisbett.github.io/bingobett.github.io', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const html = await response.text();
                    const gameSize = (html.length / 1024).toFixed(1);
                    addStatus('networkInfo', `‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${gameSize}KB`, 'success');
                    log(`–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä: ${gameSize}KB`, 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    const hasSpinButton = html.includes('id="spinButton"');
                    const hasCoinRain = html.includes('startCoinRainGame');
                    const hasYellowColors = html.includes('#ffd700');
                    
                    addStatus('networkInfo', `üé∞ –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞: ${hasSpinButton ? '‚úÖ' : '‚ùå'}`, hasSpinButton ? 'success' : 'error');
                    addStatus('networkInfo', `üí∞ –î–æ–∂–¥—å –º–æ–Ω–µ—Ç: ${hasCoinRain ? '‚úÖ' : '‚ùå'}`, hasCoinRain ? 'success' : 'error');
                    addStatus('networkInfo', `üé® –ñ–µ–ª—Ç—ã–µ —Ü–≤–µ—Ç–∞: ${hasYellowColors ? '‚úÖ' : '‚ùå'}`, hasYellowColors ? 'success' : 'error');
                    
                } else {
                    addStatus('networkInfo', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`, 'error');
                    log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã: ${response.status} ${response.statusText}`, 'error');
                }
                
            } catch (error) {
                addStatus('networkInfo', `‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                if (error.message.includes('CORS')) {
                    addStatus('networkInfo', 'üö® –ü—Ä–æ–±–ª–µ–º–∞ —Å CORS! Telegram –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã', 'error');
                    log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å CORS', 'error');
                }
                
                if (error.message.includes('network')) {
                    addStatus('networkInfo', 'üåê –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é –∏–ª–∏ DNS', 'error');
                    log('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç–µ–≤—ã–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º', 'error');
                }
            }
        }
        
        async function testCORS() {
            log('üîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS...', 'info');
            
            const testUrls = [
                'https://frutisbett.github.io/bingobett.github.io',
                'https://api.github.com',
                'https://httpbin.org/headers'
            ];
            
            for (const url of testUrls) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    addStatus('networkInfo', `‚úÖ CORS OK: ${url}`, 'success');
                    log(`CORS —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω: ${url}`, 'success');
                } catch (error) {
                    addStatus('networkInfo', `‚ùå CORS FAIL: ${url}`, 'error');
                    log(`CORS —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: ${url} - ${error.message}`, 'error');
                }
            }
        }
        
        function testStorage() {
            log('üíæ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Storage...', 'info');
            
            try {
                // localStorage
                localStorage.setItem('telegram_debug_test', 'test_value');
                const retrieved = localStorage.getItem('telegram_debug_test');
                if (retrieved === 'test_value') {
                    addStatus('storageInfo', '‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    localStorage.removeItem('telegram_debug_test');
                } else {
                    addStatus('storageInfo', '‚ùå localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                }
                
                // sessionStorage
                sessionStorage.setItem('telegram_debug_test', 'test_value');
                const sessionRetrieved = sessionStorage.getItem('telegram_debug_test');
                if (sessionRetrieved === 'test_value') {
                    addStatus('storageInfo', '‚úÖ sessionStorage —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    sessionStorage.removeItem('telegram_debug_test');
                } else {
                    addStatus('storageInfo', '‚ùå sessionStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                }
                
                // cookies
                document.cookie = 'telegram_debug_test=test_value';
                const hasCookie = document.cookie.includes('telegram_debug_test');
                addStatus('storageInfo', `${hasCookie ? '‚úÖ' : '‚ùå'} Cookies ${hasCookie ? '—Ä–∞–±–æ—Ç–∞—é—Ç' : '–Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç'}`, hasCookie ? 'success' : 'error');
                
                log('Storage —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                
            } catch (error) {
                addStatus('storageInfo', `‚ùå –û—à–∏–±–∫–∞ Storage: ${error.message}`, 'error');
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ Storage: ${error.message}`, 'error');
            }
        }
        
        function testGameFrame() {
            log('üñºÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ iframe –∑–∞–≥—Ä—É–∑–∫–∏...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = '2px solid #ffd700';
            iframe.style.borderRadius = '8px';
            iframe.src = 'https://frutisbett.github.io/bingobett.github.io';
            
            iframe.onload = () => {
                addStatus('gameInfo', '‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ iframe', 'success');
                log('–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ iframe', 'success');
                
                try {
                    const gameWindow = iframe.contentWindow;
                    const gameDocument = iframe.contentDocument;
                    
                    if (gameDocument) {
                        const spinButton = gameDocument.getElementById('spinButton');
                        addStatus('gameInfo', `üé∞ –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞: ${spinButton ? '‚úÖ –ù–∞–π–¥–µ–Ω–∞' : '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–∞'}`, spinButton ? 'success' : 'error');
                        
                        const balanceDisplay = gameDocument.getElementById('balanceDisplay');
                        addStatus('gameInfo', `üí∞ –ë–∞–ª–∞–Ω—Å: ${balanceDisplay ? '‚úÖ –ù–∞–π–¥–µ–Ω' : '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω'}`, balanceDisplay ? 'success' : 'error');
                    } else {
                        addStatus('gameInfo', '‚ùå –î–æ—Å—Ç—É–ø –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É iframe –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (CORS)', 'error');
                        log('CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É iframe', 'error');
                    }
                } catch (error) {
                    addStatus('gameInfo', `‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ iframe: ${error.message}`, 'error');
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ iframe: ${error.message}`, 'error');
                }
            };
            
            iframe.onerror = () => {
                addStatus('gameInfo', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ iframe', 'error');
                log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã –≤ iframe', 'error');
            };
            
            document.getElementById('gameInfo').appendChild(iframe);
        }
        
        function fixTelegramInit() {
            log('üîß –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'info');
            
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                    tg.ready();
                    tg.expand();
                    tg.enableClosingConfirmation();
                    
                    if (tg.setHeaderColor) {
                        tg.setHeaderColor('#1a1a1a');
                    }
                    
                    if (tg.MainButton) {
                        tg.MainButton.hide();
                    }
                    
                    addStatus('gameInfo', '‚úÖ Telegram –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'success');
                    log('Telegram –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É
                    setTimeout(() => {
                        window.location.href = 'https://frutisbett.github.io/bingobett.github.io';
                    }, 1000);
                    
                } else {
                    addStatus('gameInfo', '‚ùå Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è', 'error');
                    log('–ù–µ —É–¥–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å - Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                addStatus('gameInfo', `‚ùå –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${error.message}`, 'error');
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: ${error.message}`, 'error');
            }
        }
        
        function enableDebugMode() {
            log('üêõ –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏...', 'info');
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            window.onerror = function(msg, url, line, col, error) {
                const errorMsg = `JS Error: ${msg} at ${url}:${line}:${col}`;
                addStatus('gameInfo', `üö® ${errorMsg}`, 'error');
                log(errorMsg, 'error');
                return false;
            };
            
            window.addEventListener('unhandledrejection', function(event) {
                const errorMsg = `Unhandled Promise: ${event.reason}`;
                addStatus('gameInfo', `üö® ${errorMsg}`, 'error');
                log(errorMsg, 'error');
            });
            
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç console
            const originalLog = console.log;
            const originalError = console.error;
            
            console.log = function(...args) {
                log(`Console: ${args.join(' ')}`, 'info');
                originalLog.apply(console, args);
            };
            
            console.error = function(...args) {
                log(`Console Error: ${args.join(' ')}`, 'error');
                originalError.apply(console, args);
            };
            
            addStatus('gameInfo', '‚úÖ –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω', 'success');
            log('Debug mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'success');
        }
        
        function simulateTelegram() {
            log('üì± –°–∏–º—É–ª—è—Ü–∏—è Telegram —Å—Ä–µ–¥—ã...', 'info');
            
            if (!window.Telegram) {
                window.Telegram = {
                    WebApp: {
                        version: '6.9',
                        platform: 'android',
                        colorScheme: 'dark',
                        viewportHeight: window.innerHeight,
                        ready: () => log('Mock: Telegram.WebApp.ready() –≤—ã–∑–≤–∞–Ω', 'success'),
                        expand: () => log('Mock: Telegram.WebApp.expand() –≤—ã–∑–≤–∞–Ω', 'success'),
                        enableClosingConfirmation: () => log('Mock: enableClosingConfirmation() –≤—ã–∑–≤–∞–Ω', 'success'),
                        setHeaderColor: (color) => log(`Mock: setHeaderColor(${color}) –≤—ã–∑–≤–∞–Ω`, 'success'),
                        HapticFeedback: {
                            impactOccurred: (type) => log(`Mock: Haptic ${type}`, 'success'),
                            notificationOccurred: (type) => log(`Mock: Notification ${type}`, 'success')
                        },
                        MainButton: {
                            show: () => log('Mock: MainButton.show()', 'success'),
                            hide: () => log('Mock: MainButton.hide()', 'success'),
                            setText: (text) => log(`Mock: MainButton.setText("${text}")`, 'success')
                        },
                        openLink: (url) => {
                            log(`Mock: openLink(${url})`, 'success');
                            window.open(url, '_blank');
                        },
                        initDataUnsafe: {
                            user: {
                                id: 123456789,
                                first_name: 'Debug',
                                last_name: 'User',
                                username: 'debuguser'
                            }
                        }
                    }
                };
                
                addStatus('gameInfo', '‚úÖ Mock Telegram WebApp —Å–æ–∑–¥–∞–Ω', 'success');
                log('Mock Telegram WebApp —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é', 'success');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ
                setTimeout(() => {
                    if (confirm('Mock —Å—Ä–µ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞. –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ?')) {
                        window.location.href = 'https://frutisbett.github.io/bingobett.github.io';
                    }
                }, 1000);
                
            } else {
                addStatus('gameInfo', '‚ÑπÔ∏è Telegram WebApp —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'info');
                log('Telegram WebApp —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'info');
            }
        }
        
        function forceReload() {
            log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...', 'info');
            
            // –û—á–∏—â–∞–µ–º –∫–µ—à
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å –æ—á–∏—Å—Ç–∫–æ–π –∫–µ—à–∞
            window.location.reload(true);
        }
        
        function resetAll() {
            log('üîÑ –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å...', 'info');
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ
            localStorage.clear();
            sessionStorage.clear();
            
            // –£–¥–∞–ª—è–µ–º cookies
            document.cookie.split(";").forEach(cookie => {
                const eqPos = cookie.indexOf("=");
                const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
            });
            
            addStatus('gameInfo', '‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
            log('–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
            
            setTimeout(() => {
                window.location.href = 'https://frutisbett.github.io/bingobett.github.io';
            }, 1000);
        }
        
        function exportLog() {
            const logText = debugLog.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `telegram-debug-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            log('–õ–æ–≥ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
        }
        
        function clearLog() {
            debugLog = [];
            document.getElementById('detailLog').innerHTML = '';
            log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        window.onload = function() {
            log('üöÄ –ó–∞–ø—É—Å–∫ Telegram Debug Tool', 'success');
            
            setTimeout(() => {
                runBasicDiagnostics();
                diagnoseTelegram();
                testStorage();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–≥—Ä—ã
                setTimeout(() => {
                    testGameLoad();
                }, 2000);
                
            }, 500);
        };
    </script>
</body>
</html>